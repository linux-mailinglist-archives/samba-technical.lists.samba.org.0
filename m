Return-Path: <samba-technical-bounces@lists.samba.org>
X-Original-To: lists+samba-technical@lfdr.de
Delivered-To: lists+samba-technical@lfdr.de
Received: from hr1.samba.org (hr1.samba.org [IPv6:2a01:4f8:192:486::1:0])
	by mail.lfdr.de (Postfix) with ESMTPS id EB5FA193622
	for <lists+samba-technical@lfdr.de>; Thu, 26 Mar 2020 03:44:37 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.samba.org; s=2954282; h=Cc:From:List-Id:Date:Subject:To;
	bh=No4rc9QygUWXm7doiPhwQpKT39n8cbEX39oBm26qQwY=; b=poMxKM8q3EgJMPIeuM5kU6odED
	3AhzzOsuUu2DTS3Cb/0K0FZIeDdaqBmVcYx99VrTruGF2eesVj7vNlYe5eT4TDlGuAlEHIYoXaksS
	leaBRKZ+GvgYQr/OKlj5l3Vi8nmPFogy3sF61q6ogPYIxT7X/P5krR6xNJmsvlYu6/5blQ0XzdHRc
	KolHx6hKodSyVHMZRqUgFtvUsE0SPZewuFBQtmUMXxPDz1/ChXSFhET1MQt/tAjE4UpLMLNt4Ybns
	9S7o1tt6TtnCU7eTHeZt+ufoRLLj83eVNg04/7VhjrPiv601GjnVlsayRBEKplYZcRLg8H0u8AQk/
	e/M3nlNw==;
Received: from localhost ([::1]:58386 helo=hr1.samba.org) 
	by hr1.samba.org with esmtp (Exim)
	id 1jHIUp-000kBi-7V; Thu, 26 Mar 2020 02:43:51 +0000
Received: from mail-eopbgr770120.outbound.protection.outlook.com
 ([40.107.77.120]:25676 helo=NAM02-SN1-obe.outbound.protection.outlook.com) 
 by hr1.samba.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim) id 1jHIUj-000kBY-S6
 for samba-technical@lists.samba.org; Thu, 26 Mar 2020 02:43:48 +0000
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=OqafUjsHF8xIG8x5aobA2tsCfQ0vDOOK4MUbFpRC0rTEBa0eHNePjVu0v4bnK3d0E/qTirEBUQKFyAPqyJBBNNiYYTopXcvWNgU+XwuVC4Q8ZjPbm67aoyxW3ZwJXbesyJRWqhYa2hKFg9QpGO97KGlSE009ShJo4XrbjpOU8muJn51xnE8l5XEFNZJOrWObhRZIkGdsMgH4UZ/e6IVkueSo0+jE5mcUO4FHd1NhwL+DdTdYzyZ3VX7MRByUwbjF4YzVuyfAsfyr8PZhMapJb/jkpQBwt8spi5sn/vw/uUJLA6aal4LVwH2IJhtcwBc645VIoZh71GWwzXfOj0KkYw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=No4rc9QygUWXm7doiPhwQpKT39n8cbEX39oBm26qQwY=;
 b=dIQxvM/vdQ9wGNkLIBtySET17aZw4P8YAEM1sG/NM5h7GWbuRT4pt9vm/yf150HV2sy1muqe6qRV1Vw7YhQydARppuNrrJAJiYx4TklchhPWi1Q3bxQr5kJrvG27T9D6EbzY6YYeR0Kg0jlKdIab5oxmm6gZI4fxSQNI/QHr53gjU1sgALK3JvsghZFriYayjlUM8K4d9ZH0BNkkJorR2GVgMJ2yGpEtZKxf3yOdRFW0WsOOXQ6GburJUIhYKh+23gurUfx5I8WP0MOtGpeoYc+AXXe51wdlO0UqfqO7212VMSYeHKklWgqvDDPlhAW5Qdxqt6dwp8WkdeIy+Tdc9A==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=microsoft.com; dmarc=pass action=none
 header.from=microsoft.com; dkim=pass header.d=microsoft.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=No4rc9QygUWXm7doiPhwQpKT39n8cbEX39oBm26qQwY=;
 b=id0X6EgOnXOJ9473TS0FmnSTc+wS5TBf42FDALGuRmt29vkQQPKihjJaXh7CzRFQ2E5SXRx1U1aEg+GDsTESc6wVDLI61mGzXE9PwE0vn7s2aw/bFnx0vIlHR54Pz0xPUQaM1/zgBex7+h1d4EUtGy2atskF9r96t73CLB0+NG0=
Received: from BN8PR21MB1155.namprd21.prod.outlook.com (2603:10b6:408:73::10)
 by BN8PR21MB1218.namprd21.prod.outlook.com (2603:10b6:408:77::10)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2878.7; Thu, 26 Mar
 2020 02:43:29 +0000
Received: from BN8PR21MB1155.namprd21.prod.outlook.com
 ([fe80::d11:18b7:289c:ea17]) by BN8PR21MB1155.namprd21.prod.outlook.com
 ([fe80::d11:18b7:289c:ea17%7]) with mapi id 15.20.2878.000; Thu, 26 Mar 2020
 02:43:29 +0000
To: ronnie sahlberg <ronniesahlberg@gmail.com>
Subject: RE: [PATCH] cifs: smbd: Calculate the correct maximum packet size for
 segmented SMBDirect send/receive
Thread-Topic: [PATCH] cifs: smbd: Calculate the correct maximum packet size
 for segmented SMBDirect send/receive
Thread-Index: AQHWAtvYNY3DmDmGG0eYPROAwhxW46haH2CAgAAJY1A=
Date: Thu, 26 Mar 2020 02:43:29 +0000
Message-ID: <BN8PR21MB1155CECE3C53742CC389E5F9CECF0@BN8PR21MB1155.namprd21.prod.outlook.com>
References: <1585164614-123696-1-git-send-email-longli@linuxonhyperv.com>
 <CAN05THTH8-pK9uw77COWSUQ_knztT1o1Ms0b=2PPvmBJd=ovUw@mail.gmail.com>
In-Reply-To: <CAN05THTH8-pK9uw77COWSUQ_knztT1o1Ms0b=2PPvmBJd=ovUw@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: spf=none (sender IP is )
 smtp.mailfrom=longli@microsoft.com; 
x-originating-ip: [2001:4898:80e8:2:edec:db5c:c6fe:798]
x-ms-publictraffictype: Email
x-ms-office365-filtering-ht: Tenant
x-ms-office365-filtering-correlation-id: 0f95960e-ddf3-4c1a-8655-08d7d12f77bb
x-ms-traffictypediagnostic: BN8PR21MB1218:
x-ms-oob-tlc-oobclassifiers: OLM:7691;
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: BY5y9EsEszcdCqFJd5oHTCsH8yV7bA+y/J5D7nz0ICWmifUN1ModF8Tgz/yBPzzGjuDR80QErGWv6f6wQrxzZ21PXQkJCAWgA6J4H/7rqlQ/DXMCPxHmr1gXHv57lexp58L6QnMwf9SN54EejGYp6Lw+5T7UnUr5Rf4IXEhe7/WSCgxDoyz1rW49QTHHj4R51HZrmEtY4JamC/mduw2L9XkDpPAx9zmPIppVWP4tHBykiSWP8nu5jZ8G3eIkfY8l/Bx/6EEJlXO9+2d+JZHEk4Kz2zcPLyc8cfec4uU9OVkzQ1O/vl3cspLbOWWi1G68R4y89kc7Jy8qfs4EtXV5payMAtGziuGDh+h7ODHVwdHlbNqcomNhQWHrkYekDKBlscbJJ8wBSRZ1GP2kK/ksmzjsdWBZg+uTsFkBucvjRJRfzr8TGYowSmRpZYhIPvKs
x-ms-exchange-antispam-messagedata: Z/faKDjQLW01HVc3D2BnshstEqT78MB+w9YPPNa5zZp3Qlu8eEpeOn7WyThjeSS/ZND417tqsq+GDIyUywSh++Zo4AI1UN17KfH2UmfO0DIF3dn2PN/NW23c4k4m5BwAVkCfajyF1Z4Er5J8ZAqPEfEVhiSTodaBawzDgB+JkItRRve2Nxb/byTJ2aBNGTZyrEUfgbf+GP9E3aUFOvMuSA==
x-ms-exchange-transport-forked: True
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginatorOrg: microsoft.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 0f95960e-ddf3-4c1a-8655-08d7d12f77bb
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 72f988bf-86f1-41af-91ab-2d7cd011db47
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: IT163s9B9QEJvRqlKHmxz6sEta6jCtNqZswSogY05wkVZlcDcby7d7HrDSMTIX47oJMFBL5pLdoxeHA/u3zERQ==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN8PR21MB1218
X-Warn: EHLO/HELO not verified: Remote host 40.107.77.120
 (mail-eopbgr770120.outbound.protection.outlook.com) incorrectly presented
 itself as NAM02-SN1-obe.outbound.protection.outlook.com
X-BeenThere: samba-technical@lists.samba.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Discussions on Samba internals. For general questions please
 subscribe to the list samba@lists.samba.org"
 <samba-technical.lists.samba.org>
List-Unsubscribe: <https://lists.samba.org/mailman/options/samba-technical>,
 <mailto:samba-technical-request@lists.samba.org?subject=unsubscribe>
List-Archive: <http://lists.samba.org/pipermail/samba-technical/>
List-Post: <mailto:samba-technical@lists.samba.org>
List-Help: <mailto:samba-technical-request@lists.samba.org?subject=help>
List-Subscribe: <https://lists.samba.org/mailman/listinfo/samba-technical>,
 <mailto:samba-technical-request@lists.samba.org?subject=subscribe>
From: Long Li via samba-technical <samba-technical@lists.samba.org>
Reply-To: Long Li <longli@microsoft.com>
Cc: Steve French <sfrench@samba.org>, linux-cifs <linux-cifs@vger.kernel.org>,
 "samba-technical@lists.samba.org" <samba-technical@lists.samba.org>,
 LKML <linux-kernel@vger.kernel.org>,
 "longli@linuxonhyperv.com" <longli@linuxonhyperv.com>
Errors-To: samba-technical-bounces@lists.samba.org
Sender: "samba-technical" <samba-technical-bounces@lists.samba.org>

PlN1YmplY3Q6IFJlOiBbUEFUQ0hdIGNpZnM6IHNtYmQ6IENhbGN1bGF0ZSB0aGUgY29ycmVjdCBt
YXhpbXVtIHBhY2tldCBzaXplDQo+Zm9yIHNlZ21lbnRlZCBTTUJEaXJlY3Qgc2VuZC9yZWNlaXZl
DQo+DQo+TG9uZyBMaSwNCj4NCj5Nb3N0bHkgbG9va3MgZ29vZCAgYnV0IHRoZSBtYWdpYyBjb25z
dGFudCA0OSBJIHRoaW5rIGlzIHdyb25nLg0KPjQ5IGlzIHRoZSBzdHJ1Y3R1cmUgc2l6ZSBvZiB0
aGUgcmVhZC93cml0ZSByZXF1ZXN0IGhlYWRlciBidXQgZm9yIHRoZXNlIHNpemVzLCBpZg0KPnRo
ZXkgYXJlIG9kZCBpdCBqdXN0IG1lYW5zIHRoYXQgdGhlIGhlYWRlciBjb250YWluIGEgdmFyaWFi
bGUgc2l6ZWQgYmxvYi4NCj5JLmUuIHRoZSBzaXplIGlzIDQ4IGJ5dGVzIChmb3IgdGhlIGZpeGVk
IHBhcnQgb2YgdGhlIGhlYWRlcikgKyBhIHZhcmlhYmxlIHBhcnQNCj53aGljaCBpbiB0aGlzIGNh
c2UgYXJlIHRoZSBDaGFubmVsSW5mbyBibG9icy4NCg0KQWdyZWVkLiBVc2luZyBhIG1hZ2ljIG51
bWJlciBpcyBub3QgYSBnb29kIGlkZWEuDQoNCkkgd2FzIGxvb2tpbmcgYXQgcmVxdWVzdCBzaXpl
IGRlZmluaXRpb25zIGluIA0KImZzL2NpZnMvc21iMnBkdS5jIiwgIHRoZXkgYXJlIGRlZmluZWQg
YXQNCnN0YXRpYyBjb25zdCBpbnQgc21iMl9yZXFfc3RydWN0X3NpemVzW05VTUJFUl9PRl9TTUIy
X0NPTU1BTkRTXQ0KDQpmb3IgcmVhZCBhbmQgd3JpdGUsIHRoZSBzaXplcyBhcmU6DQogICAgICAg
IC8qIFNNQjJfUkVBRCAqLyA0OSwNCiAgICAgICAgLyogU01CMl9XUklURSAqLyA0OSwNCg0KVGhl
eSBhcmUgdXNlZCB0byBjYWxjdWxhdGUgY29tbWFuZCBoZWFkZXIgc2l6ZXMsIGFuZCBmaWxsIGlu
IHRoZSByZXF1ZXN0IGhlYWRlcnMuIE1heWJlIEkgc2hvdWxkIHVzZSB0aGlzIHZhcmlhYmxlIHRv
IGdldCB0aGUgc2l6ZT8NCg0KPg0KPlNvIHdlIHNob3VsZCBwcm9iYWJseSBhZGQgdG8gc21iMnBk
dS5oIGEgI2RlZmluZQ0KPk1BWF9TTUIyX1JFQURXUklURV9SRVNQT05TRV9TSVpFIDQ4IGFuZCB1
c2UgdGhpcyBpbiB0aGUgY2FsY3VsYXRpb25zLg0KPlRoZW4gd2UgbmVlZCB0byBhZGQgdGhlIG1h
eGltdW0gc2l6ZSB3ZSB3aWxsIHVzZSBmb3IgQ2hhbm5lbEluZm8uDQo+DQo+TWF5YmUgd2Ugc2hv
dWxkIGhhdmUgYSBkZWZpbmUgYWxzbyBmb3IgdGhlDQo+TUFYX1NNQjJfQ0hBTk5FTF9JTkZPX1NJ
WkUNCj4NCj5yZWdhcmRzDQo+cm9ubmllIHNhaGxiZXJnDQo+DQo+T24gVGh1LCBNYXIgMjYsIDIw
MjAgYXQgNTozMSBBTSBsb25nbGktLS0gdmlhIHNhbWJhLXRlY2huaWNhbCA8c2FtYmEtDQo+dGVj
aG5pY2FsQGxpc3RzLnNhbWJhLm9yZz4gd3JvdGU6DQo+Pg0KPj4gRnJvbTogTG9uZyBMaSA8bG9u
Z2xpQG1pY3Jvc29mdC5jb20+DQo+Pg0KPj4gVGhlIHBhY2tldCBzaXplIG5lZWRzIHRvIHRha2Ug
YWNjb3VudCBvZiBTTUIyIGhlYWRlciBzaXplIGFuZCBwb3NzaWJsZQ0KPj4gZW5jcnlwdGlvbiBo
ZWFkZXIgc2l6ZS4gVGhpcyBpcyBvbmx5IGRvbmUgd2hlbiBzaWduaW5nIGlzIHVzZWQgYW5kIGl0
DQo+PiBpcyBmb3IgUkRNQSBzZW5kL3JlY2VpdmUsIG5vdCByZWFkL3dyaXRlLg0KPj4NCj4+IEFs
c28gcmVtb3ZlIHRoZSBkZWFkIFNNQkQgY29kZSBpbiBzbWIyX25lZ290aWF0ZV9yKHcpc2l6ZS4N
Cj4+DQo+PiBTaWduZWQtb2ZmLWJ5OiBMb25nIExpIDxsb25nbGlAbWljcm9zb2Z0LmNvbT4NCj4+
IC0tLQ0KPj4gIGZzL2NpZnMvc21iMm9wcy5jICAgfCAzOCArKysrKysrKysrKysrKysrLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLQ0KPj4gIGZzL2NpZnMvc21iZGlyZWN0LmMgfCAgMyArLS0NCj4+ICAy
IGZpbGVzIGNoYW5nZWQsIDE3IGluc2VydGlvbnMoKyksIDI0IGRlbGV0aW9ucygtKQ0KPj4NCj4+
IGRpZmYgLS1naXQgYS9mcy9jaWZzL3NtYjJvcHMuYyBiL2ZzL2NpZnMvc21iMm9wcy5jIGluZGV4
DQo+PiA0YzA5MjI1OTY0NjcuLjkwNDNkMzRlZWY0MyAxMDA2NDQNCj4+IC0tLSBhL2ZzL2NpZnMv
c21iMm9wcy5jDQo+PiArKysgYi9mcy9jaWZzL3NtYjJvcHMuYw0KPj4gQEAgLTMzMiwxNiArMzMy
LDYgQEAgc21iMl9uZWdvdGlhdGVfd3NpemUoc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwNCj5zdHJ1
Y3Qgc21iX3ZvbCAqdm9sdW1lX2luZm8pDQo+PiAgICAgICAgIC8qIHN0YXJ0IHdpdGggc3BlY2lm
aWVkIHdzaXplLCBvciBkZWZhdWx0ICovDQo+PiAgICAgICAgIHdzaXplID0gdm9sdW1lX2luZm8t
PndzaXplID8gdm9sdW1lX2luZm8tPndzaXplIDoNCj5DSUZTX0RFRkFVTFRfSU9TSVpFOw0KPj4g
ICAgICAgICB3c2l6ZSA9IG1pbl90KHVuc2lnbmVkIGludCwgd3NpemUsIHNlcnZlci0+bWF4X3dy
aXRlKTsgLSNpZmRlZg0KPj4gQ09ORklHX0NJRlNfU01CX0RJUkVDVA0KPj4gLSAgICAgICBpZiAo
c2VydmVyLT5yZG1hKSB7DQo+PiAtICAgICAgICAgICAgICAgaWYgKHNlcnZlci0+c2lnbikNCj4+
IC0gICAgICAgICAgICAgICAgICAgICAgIHdzaXplID0gbWluX3QodW5zaWduZWQgaW50LA0KPj4g
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3c2l6ZSwgc2VydmVyLT5zbWJkX2Nvbm4t
Pm1heF9mcmFnbWVudGVkX3NlbmRfc2l6ZSk7DQo+PiAtICAgICAgICAgICAgICAgZWxzZQ0KPj4g
LSAgICAgICAgICAgICAgICAgICAgICAgd3NpemUgPSBtaW5fdCh1bnNpZ25lZCBpbnQsDQo+PiAt
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdzaXplLCBzZXJ2ZXItPnNtYmRfY29ubi0+
bWF4X3JlYWR3cml0ZV9zaXplKTsNCj4+IC0gICAgICAgfQ0KPj4gLSNlbmRpZg0KPj4gICAgICAg
ICBpZiAoIShzZXJ2ZXItPmNhcGFiaWxpdGllcyAmIFNNQjJfR0xPQkFMX0NBUF9MQVJHRV9NVFUp
KQ0KPj4gICAgICAgICAgICAgICAgIHdzaXplID0gbWluX3QodW5zaWduZWQgaW50LCB3c2l6ZSwN
Cj4+IFNNQjJfTUFYX0JVRkZFUl9TSVpFKTsNCj4+DQo+PiBAQCAtMzYwLDggKzM1MCwxNSBAQCBz
bWIzX25lZ290aWF0ZV93c2l6ZShzdHJ1Y3QgY2lmc190Y29uICp0Y29uLA0KPj4gc3RydWN0IHNt
Yl92b2wgKnZvbHVtZV9pbmZvKSAgI2lmZGVmIENPTkZJR19DSUZTX1NNQl9ESVJFQ1QNCj4+ICAg
ICAgICAgaWYgKHNlcnZlci0+cmRtYSkgew0KPj4gICAgICAgICAgICAgICAgIGlmIChzZXJ2ZXIt
PnNpZ24pDQo+PiArICAgICAgICAgICAgICAgICAgICAgICAvKg0KPj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICogQWNjb3VudCBmb3IgU01CMiBkYXRhIHRyYW5zZmVyIHBhY2tldCBoZWFkZXIN
Cj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAqIFNNQjJfUkVBRC9TTUIyX1dSSVRFICg0OSkg
YW5kIHBvc3NpYmxlIGVuY3J5cHRpb24NCj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAqIGhl
YWRlcnMNCj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAqLw0KPj4gICAgICAgICAgICAgICAg
ICAgICAgICAgd3NpemUgPSBtaW5fdCh1bnNpZ25lZCBpbnQsDQo+PiAtICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHdzaXplLCBzZXJ2ZXItPnNtYmRfY29ubi0+bWF4X2ZyYWdtZW50ZWRf
c2VuZF9zaXplKTsNCj4+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3NpemUsDQo+
PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlci0+c21iZF9jb25uLT5tYXhf
ZnJhZ21lbnRlZF9zZW5kX3NpemUgLQ0KPj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIDQ5IC0gc2l6ZW9mKHN0cnVjdA0KPj4gKyBzbWIyX3RyYW5zZm9ybV9oZHIpKTsN
Cj4+ICAgICAgICAgICAgICAgICBlbHNlDQo+PiAgICAgICAgICAgICAgICAgICAgICAgICB3c2l6
ZSA9IG1pbl90KHVuc2lnbmVkIGludCwNCj4+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgd3NpemUsDQo+PiBzZXJ2ZXItPnNtYmRfY29ubi0+bWF4X3JlYWR3cml0ZV9zaXplKTsNCj4+
IEBAIC0zODIsMTYgKzM3OSw2IEBAIHNtYjJfbmVnb3RpYXRlX3JzaXplKHN0cnVjdCBjaWZzX3Rj
b24gKnRjb24sIHN0cnVjdA0KPnNtYl92b2wgKnZvbHVtZV9pbmZvKQ0KPj4gICAgICAgICAvKiBz
dGFydCB3aXRoIHNwZWNpZmllZCByc2l6ZSwgb3IgZGVmYXVsdCAqLw0KPj4gICAgICAgICByc2l6
ZSA9IHZvbHVtZV9pbmZvLT5yc2l6ZSA/IHZvbHVtZV9pbmZvLT5yc2l6ZSA6IENJRlNfREVGQVVM
VF9JT1NJWkU7DQo+PiAgICAgICAgIHJzaXplID0gbWluX3QodW5zaWduZWQgaW50LCByc2l6ZSwg
c2VydmVyLT5tYXhfcmVhZCk7IC0jaWZkZWYNCj4+IENPTkZJR19DSUZTX1NNQl9ESVJFQ1QNCj4+
IC0gICAgICAgaWYgKHNlcnZlci0+cmRtYSkgew0KPj4gLSAgICAgICAgICAgICAgIGlmIChzZXJ2
ZXItPnNpZ24pDQo+PiAtICAgICAgICAgICAgICAgICAgICAgICByc2l6ZSA9IG1pbl90KHVuc2ln
bmVkIGludCwNCj4+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnNpemUsIHNlcnZl
ci0+c21iZF9jb25uLT5tYXhfZnJhZ21lbnRlZF9yZWN2X3NpemUpOw0KPj4gLSAgICAgICAgICAg
ICAgIGVsc2UNCj4+IC0gICAgICAgICAgICAgICAgICAgICAgIHJzaXplID0gbWluX3QodW5zaWdu
ZWQgaW50LA0KPj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByc2l6ZSwgc2VydmVy
LT5zbWJkX2Nvbm4tPm1heF9yZWFkd3JpdGVfc2l6ZSk7DQo+PiAtICAgICAgIH0NCj4+IC0jZW5k
aWYNCj4+DQo+PiAgICAgICAgIGlmICghKHNlcnZlci0+Y2FwYWJpbGl0aWVzICYgU01CMl9HTE9C
QUxfQ0FQX0xBUkdFX01UVSkpDQo+PiAgICAgICAgICAgICAgICAgcnNpemUgPSBtaW5fdCh1bnNp
Z25lZCBpbnQsIHJzaXplLA0KPj4gU01CMl9NQVhfQlVGRkVSX1NJWkUpOyBAQCAtNDExLDggKzM5
OCwxNSBAQA0KPj4gc21iM19uZWdvdGlhdGVfcnNpemUoc3RydWN0IGNpZnNfdGNvbiAqdGNvbiwg
c3RydWN0IHNtYl92b2wgKnZvbHVtZV9pbmZvKQ0KPiNpZmRlZiBDT05GSUdfQ0lGU19TTUJfRElS
RUNUDQo+PiAgICAgICAgIGlmIChzZXJ2ZXItPnJkbWEpIHsNCj4+ICAgICAgICAgICAgICAgICBp
ZiAoc2VydmVyLT5zaWduKQ0KPj4gKyAgICAgICAgICAgICAgICAgICAgICAgLyoNCj4+ICsgICAg
ICAgICAgICAgICAgICAgICAgICAqIEFjY291bnQgZm9yIFNNQjIgZGF0YSB0cmFuc2ZlciBwYWNr
ZXQgaGVhZGVyDQo+PiArICAgICAgICAgICAgICAgICAgICAgICAgKiBTTUIyX1JFQUQvU01CMl9X
UklURSAoNDkpIGFuZCBwb3NzaWJsZSBlbmNyeXB0aW9uDQo+PiArICAgICAgICAgICAgICAgICAg
ICAgICAgKiBoZWFkZXJzDQo+PiArICAgICAgICAgICAgICAgICAgICAgICAgKi8NCj4+ICAgICAg
ICAgICAgICAgICAgICAgICAgIHJzaXplID0gbWluX3QodW5zaWduZWQgaW50LA0KPj4gLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICByc2l6ZSwgc2VydmVyLT5zbWJkX2Nvbm4tPm1heF9m
cmFnbWVudGVkX3JlY3Zfc2l6ZSk7DQo+PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHJzaXplLA0KPj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXItPnNtYmRf
Y29ubi0+bWF4X2ZyYWdtZW50ZWRfcmVjdl9zaXplIC0NCj4+ICsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICA0OSAtIHNpemVvZihzdHJ1Y3QNCj4+ICsgc21iMl90cmFuc2Zv
cm1faGRyKSk7DQo+PiAgICAgICAgICAgICAgICAgZWxzZQ0KPj4gICAgICAgICAgICAgICAgICAg
ICAgICAgcnNpemUgPSBtaW5fdCh1bnNpZ25lZCBpbnQsDQo+PiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHJzaXplLA0KPj4gc2VydmVyLT5zbWJkX2Nvbm4tPm1heF9yZWFkd3JpdGVf
c2l6ZSk7DQo+PiBkaWZmIC0tZ2l0IGEvZnMvY2lmcy9zbWJkaXJlY3QuYyBiL2ZzL2NpZnMvc21i
ZGlyZWN0LmMgaW5kZXgNCj4+IGViMWU0MGFmOWYzYS4uMDMyN2I1NzVhYjg3IDEwMDY0NA0KPj4g
LS0tIGEvZnMvY2lmcy9zbWJkaXJlY3QuYw0KPj4gKysrIGIvZnMvY2lmcy9zbWJkaXJlY3QuYw0K
Pj4gQEAgLTIwOTcsOCArMjA5Nyw3IEBAIGludCBzbWJkX3NlbmQoc3RydWN0IFRDUF9TZXJ2ZXJf
SW5mbyAqc2VydmVyLA0KPj4gICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtX3Jxc3Q7IGkrKykN
Cj4+ICAgICAgICAgICAgICAgICByZW1haW5pbmdfZGF0YV9sZW5ndGggKz0gc21iX3Jxc3RfbGVu
KHNlcnZlciwNCj4+ICZycXN0X2FycmF5W2ldKTsNCj4+DQo+PiAtICAgICAgIGlmIChyZW1haW5p
bmdfZGF0YV9sZW5ndGggKyBzaXplb2Yoc3RydWN0IHNtYmRfZGF0YV90cmFuc2ZlcikgPg0KPj4g
LSAgICAgICAgICAgICAgIGluZm8tPm1heF9mcmFnbWVudGVkX3NlbmRfc2l6ZSkgew0KPj4gKyAg
ICAgICBpZiAocmVtYWluaW5nX2RhdGFfbGVuZ3RoID4gaW5mby0+bWF4X2ZyYWdtZW50ZWRfc2Vu
ZF9zaXplKSB7DQo+PiAgICAgICAgICAgICAgICAgbG9nX3dyaXRlKEVSUiwgInBheWxvYWQgc2l6
ZSAlZCA+IG1heCBzaXplICVkXG4iLA0KPj4gICAgICAgICAgICAgICAgICAgICAgICAgcmVtYWlu
aW5nX2RhdGFfbGVuZ3RoLCBpbmZvLT5tYXhfZnJhZ21lbnRlZF9zZW5kX3NpemUpOw0KPj4gICAg
ICAgICAgICAgICAgIHJjID0gLUVJTlZBTDsNCj4+IC0tDQo+PiAyLjE3LjENCj4+DQo+Pg0K

