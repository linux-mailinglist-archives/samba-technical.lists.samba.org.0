Return-Path: <samba-technical-bounces@lists.samba.org>
X-Original-To: lists+samba-technical@lfdr.de
Delivered-To: lists+samba-technical@lfdr.de
Received: from hr1.samba.org (hr1.samba.org [IPv6:2a01:4f8:192:486::1:0])
	by mail.lfdr.de (Postfix) with ESMTPS id 5E190923A6
	for <lists+samba-technical@lfdr.de>; Mon, 19 Aug 2019 14:41:00 +0200 (CEST)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.samba.org; s=2954282; h=Cc:From:List-Id:Date:To:Subject;
	bh=Hv0tEQ+n3PhcD1Q4p9vaDPh+o7sL+oAWHTp98cqedCY=; b=Em0Bc0M9DuV1wKNAt0ha8OBkEF
	lz5G/pecsCqLlsAUgXk590DQ6BB3M8x3kSUz3bdO/ZKj/lk34EDcm8lQXBYqmDjAyTEpMySljtTC+
	rW/74wvPnUg9qz53SoXr3fdNBDXr8kC5pTxY/PHjrQXaRKfIaIvx/4zEqvKMOgfZ6gB6R6whnFDeX
	XGIl7uTkk3Fwg01dCkCkfthWGN6ehiGubHUZ8c1wJIRcYBi4Q6HReWIQJs1W3qDwvEFja36ZS/xNS
	dharXUR7KuUfIEyhdT/YrPRfxjxUtF5IrYiONEX5gBrnVyvocSHTnQMNrMXXhSZuhnUcY5bn5zLui
	0+Z0d07g==;
Received: from localhost ([::1]:34254 helo=hr1.samba.org) 
	by hr1.samba.org with esmtp (Exim)
	id 1hzgxf-007179-Aa; Mon, 19 Aug 2019 12:40:35 +0000
Received: from devianza.investici.org ([198.167.222.108]:57721) 
 by hr1.samba.org with esmtps (TLS1.2:ECDHE_RSA_CHACHA20_POLY1305:256)
 (Exim) id 1hzgxV-007172-N7
 for samba-technical@lists.samba.org; Mon, 19 Aug 2019 12:40:27 +0000
Received: from mx2.investici.org (localhost [127.0.0.1])
 by devianza.investici.org (Postfix) with ESMTP id D69C2E0737;
 Mon, 19 Aug 2019 12:19:16 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=cryptolab.net;
 s=stigmate; t=1566217156;
 bh=Hv0tEQ+n3PhcD1Q4p9vaDPh+o7sL+oAWHTp98cqedCY=;
 h=Subject:From:To:Cc:Date:From;
 b=jIxE0AdSDsU5UQTF+BOcQ68PThfsZVrVNxDWw1umm8HJRtcXbjAhz7S6FwhOrEi2H
 1jG8jHaulB8PepH0x93+ikttAdjVYW8w4Aim/JH3I5gow/yvJI8JJ4odyaOzSOyd9H
 pc8Df9HuY+xwOtN1fSQ6SqmCNoI8NfOQqUt9FhCI=
Received: from [198.167.222.108] (mx2.investici.org [198.167.222.108])
 (Authenticated sender: anoopcs@autistici.org) by localhost (Postfix) with
 ESMTPSA id 0FCD4E06B6; Mon, 19 Aug 2019 12:19:13 +0000 (UTC)
Message-ID: <8d9bfc615b93514eeb14f9f5c028ee54f05b37d0.camel@cryptolab.net>
Subject: [PATCH] Add profiling to vfs_glusterfs
To: samba-technical <samba-technical@lists.samba.org>
Date: Mon, 19 Aug 2019 17:49:10 +0530
Content-Type: multipart/mixed; boundary="=-DsnFmpeQK/9++WO68LHE"
User-Agent: Evolution 3.32.4 (3.32.4-1.fc30) 
MIME-Version: 1.0
X-BeenThere: samba-technical@lists.samba.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Discussions on Samba internals. For general questions please
 subscribe to the list samba@lists.samba.org"
 <samba-technical.lists.samba.org>
List-Unsubscribe: <https://lists.samba.org/mailman/options/samba-technical>,
 <mailto:samba-technical-request@lists.samba.org?subject=unsubscribe>
List-Archive: <http://lists.samba.org/pipermail/samba-technical/>
List-Post: <mailto:samba-technical@lists.samba.org>
List-Help: <mailto:samba-technical-request@lists.samba.org?subject=help>
List-Subscribe: <https://lists.samba.org/mailman/listinfo/samba-technical>,
 <mailto:samba-technical-request@lists.samba.org?subject=subscribe>
From: Anoop C S via samba-technical <samba-technical@lists.samba.org>
Reply-To: Anoop C S <anoopcs@cryptolab.net>
Cc: gd <gd@samba.org>, obnox@samba.org
Errors-To: samba-technical-bounces@lists.samba.org
Sender: "samba-technical" <samba-technical-bounces@lists.samba.org>


--=-DsnFmpeQK/9++WO68LHE
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 7bit

Hi,

Please find the attached patch to retrieve profiling metrics from
vfs_glusterfs.

Reviews are appreciated.

-Anoop C S

--=-DsnFmpeQK/9++WO68LHE
Content-Disposition: attachment;
	filename*0=0001-vfs_glusterfs-Enable-profiling-for-file-system-opera.pat;
	filename*1=ch
Content-Type: text/x-patch;
	name="0001-vfs_glusterfs-Enable-profiling-for-file-system-opera.patch";
	charset="UTF-8"
Content-Transfer-Encoding: base64

RnJvbSA3NTRiZjM3Njc5ZTZmMWE4Y2Q1ZTdiZjBiYmE1NGRiMDdlNDNiNTY4IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBBbm9vcCBDIFMgPGFub29wY3NAcmVkaGF0LmNvbT4KRGF0ZTog
TW9uLCA1IEF1ZyAyMDE5IDEwOjQ1OjAxICswNTMwClN1YmplY3Q6IFtQQVRDSF0gdmZzX2dsdXN0
ZXJmczogRW5hYmxlIHByb2ZpbGluZyBmb3IgZmlsZSBzeXN0ZW0gb3BlcmF0aW9ucwoKU2lnbmVk
LW9mZi1ieTogQW5vb3AgQyBTIDxhbm9vcGNzQHJlZGhhdC5jb20+Ci0tLQogc291cmNlMy9tb2R1
bGVzL3Zmc19nbHVzdGVyZnMuYyB8IDI3MSArKysrKysrKysrKysrKysrKysrKysrKysrKystLS0t
LQogMSBmaWxlIGNoYW5nZWQsIDIzNCBpbnNlcnRpb25zKCspLCAzNyBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9zb3VyY2UzL21vZHVsZXMvdmZzX2dsdXN0ZXJmcy5jIGIvc291cmNlMy9tb2R1
bGVzL3Zmc19nbHVzdGVyZnMuYwppbmRleCA5YThlMzJjOGZhOS4uNGNjMDE3YTkxMGQgMTAwNjQ0
Ci0tLSBhL3NvdXJjZTMvbW9kdWxlcy92ZnNfZ2x1c3RlcmZzLmMKKysrIGIvc291cmNlMy9tb2R1
bGVzL3Zmc19nbHVzdGVyZnMuYwpAQCAtNDkyLDEyICs0OTIsMTUgQEAgc3RhdGljIERJUiAqdmZz
X2dsdXN0ZXJfb3BlbmRpcihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIHsKIAln
bGZzX2ZkX3QgKmZkOwogCisJU1RBUlRfUFJPRklMRShzeXNjYWxsX29wZW5kaXIpOwogCWZkID0g
Z2xmc19vcGVuZGlyKGhhbmRsZS0+ZGF0YSwgc21iX2ZuYW1lLT5iYXNlX25hbWUpOwogCWlmIChm
ZCA9PSBOVUxMKSB7CiAJCURFQlVHKDAsICgiZ2xmc19vcGVuZGlyKCVzKSBmYWlsZWQ6ICVzXG4i
LAogCQkJICBzbWJfZm5hbWUtPmJhc2VfbmFtZSwgc3RyZXJyb3IoZXJybm8pKSk7CiAJfQogCisJ
RU5EX1BST0ZJTEUoc3lzY2FsbF9vcGVuZGlyKTsKKwogCXJldHVybiAoRElSICopIGZkOwogfQog
CkBAIC01MzIsNyArNTM1LDEzIEBAIHN0YXRpYyBESVIgKnZmc19nbHVzdGVyX2Zkb3BlbmRpcihz
dHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAogc3RhdGljIGludCB2ZnNfZ2x1c3Rl
cl9jbG9zZWRpcihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwgRElSICpkaXJwKQog
ewotCXJldHVybiBnbGZzX2Nsb3NlZGlyKCh2b2lkICopZGlycCk7CisJaW50IHJldDsKKworCVNU
QVJUX1BST0ZJTEUoc3lzY2FsbF9jbG9zZWRpcik7CisJcmV0ID0gZ2xmc19jbG9zZWRpcigodm9p
ZCAqKWRpcnApOworCUVORF9QUk9GSUxFKHN5c2NhbGxfY2xvc2VkaXIpOworCisJcmV0dXJuIHJl
dDsKIH0KIAogc3RhdGljIHN0cnVjdCBkaXJlbnQgKnZmc19nbHVzdGVyX3JlYWRkaXIoc3RydWN0
IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCkBAIC01NDMsNiArNTUyLDcgQEAgc3RhdGljIHN0
cnVjdCBkaXJlbnQgKnZmc19nbHVzdGVyX3JlYWRkaXIoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0
ICpoYW5kbGUsCiAJc3RydWN0IHN0YXQgc3RhdDsKIAlzdHJ1Y3QgZGlyZW50ICpkaXJlbnQgPSAw
OwogCisJU1RBUlRfUFJPRklMRShzeXNjYWxsX3JlYWRkaXIpOwogCWlmIChzYnVmICE9IE5VTEwp
IHsKIAkJcmV0ID0gZ2xmc19yZWFkZGlycGx1c19yKCh2b2lkICopZGlycCwgJnN0YXQsICh2b2lk
ICopZGlyZW50YnVmLAogCQkJCQkgJmRpcmVudCk7CkBAIC01NTEsNiArNTYxLDcgQEAgc3RhdGlj
IHN0cnVjdCBkaXJlbnQgKnZmc19nbHVzdGVyX3JlYWRkaXIoc3RydWN0IHZmc19oYW5kbGVfc3Ry
dWN0ICpoYW5kbGUsCiAJfQogCiAJaWYgKChyZXQgPCAwKSB8fCAoZGlyZW50ID09IE5VTEwpKSB7
CisJCUVORF9QUk9GSUxFKHN5c2NhbGxfcmVhZGRpcik7CiAJCXJldHVybiBOVUxMOwogCX0KIApA
QCAtNTU4LDM2ICs1NjksNTkgQEAgc3RhdGljIHN0cnVjdCBkaXJlbnQgKnZmc19nbHVzdGVyX3Jl
YWRkaXIoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJCXNtYl9zdGF0X2V4X2Zy
b21fc3RhdChzYnVmLCAmc3RhdCk7CiAJfQogCisJRU5EX1BST0ZJTEUoc3lzY2FsbF9yZWFkZGly
KTsKIAlyZXR1cm4gZGlyZW50OwogfQogCiBzdGF0aWMgbG9uZyB2ZnNfZ2x1c3Rlcl90ZWxsZGly
KHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLCBESVIgKmRpcnApCiB7Ci0JcmV0dXJu
IGdsZnNfdGVsbGRpcigodm9pZCAqKWRpcnApOworCWxvbmcgcmV0OworCisJU1RBUlRfUFJPRklM
RShzeXNjYWxsX3RlbGxkaXIpOworCXJldCA9IGdsZnNfdGVsbGRpcigodm9pZCAqKWRpcnApOwor
CUVORF9QUk9GSUxFKHN5c2NhbGxfdGVsbGRpcik7CisKKwlyZXR1cm4gcmV0OwogfQogCiBzdGF0
aWMgdm9pZCB2ZnNfZ2x1c3Rlcl9zZWVrZGlyKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFu
ZGxlLCBESVIgKmRpcnAsCiAJCQkJbG9uZyBvZmZzZXQpCiB7CisJU1RBUlRfUFJPRklMRShzeXNj
YWxsX3NlZWtkaXIpOwogCWdsZnNfc2Vla2Rpcigodm9pZCAqKWRpcnAsIG9mZnNldCk7CisJRU5E
X1BST0ZJTEUoc3lzY2FsbF9zZWVrZGlyKTsKIH0KIAogc3RhdGljIHZvaWQgdmZzX2dsdXN0ZXJf
cmV3aW5kZGlyKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLCBESVIgKmRpcnApCiB7
CisJU1RBUlRfUFJPRklMRShzeXNjYWxsX3Jld2luZGRpcik7CiAJZ2xmc19zZWVrZGlyKCh2b2lk
ICopZGlycCwgMCk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9yZXdpbmRkaXIpOwogfQogCiBzdGF0
aWMgaW50IHZmc19nbHVzdGVyX21rZGlyKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxl
LAogCQkJICAgICBjb25zdCBzdHJ1Y3Qgc21iX2ZpbGVuYW1lICpzbWJfZm5hbWUsCiAJCQkgICAg
IG1vZGVfdCBtb2RlKQogewotCXJldHVybiBnbGZzX21rZGlyKGhhbmRsZS0+ZGF0YSwgc21iX2Zu
YW1lLT5iYXNlX25hbWUsIG1vZGUpOworCWludCByZXQ7CisKKwlTVEFSVF9QUk9GSUxFKHN5c2Nh
bGxfbWtkaXIpOworCXJldCA9IGdsZnNfbWtkaXIoaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWUtPmJh
c2VfbmFtZSwgbW9kZSk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9ta2Rpcik7CisKKwlyZXR1cm4g
cmV0OwogfQogCiBzdGF0aWMgaW50IHZmc19nbHVzdGVyX3JtZGlyKHN0cnVjdCB2ZnNfaGFuZGxl
X3N0cnVjdCAqaGFuZGxlLAogCQkJY29uc3Qgc3RydWN0IHNtYl9maWxlbmFtZSAqc21iX2ZuYW1l
KQogewotCXJldHVybiBnbGZzX3JtZGlyKGhhbmRsZS0+ZGF0YSwgc21iX2ZuYW1lLT5iYXNlX25h
bWUpOworCWludCByZXQ7CisKKwlTVEFSVF9QUk9GSUxFKHN5c2NhbGxfcm1kaXIpOworCXJldCA9
IGdsZnNfcm1kaXIoaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWUtPmJhc2VfbmFtZSk7CisJRU5EX1BS
T0ZJTEUoc3lzY2FsbF9ybWRpcik7CisKKwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHZm
c19nbHVzdGVyX29wZW4oc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCkBAIC02MDMs
NiArNjM3LDcgQEAgc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9vcGVuKHN0cnVjdCB2ZnNfaGFuZGxl
X3N0cnVjdCAqaGFuZGxlLAogCQlyZXR1cm4gLTE7CiAJfQogCisJU1RBUlRfUFJPRklMRShzeXNj
YWxsX29wZW4pOwogCWlmIChmbGFncyAmIE9fRElSRUNUT1JZKSB7CiAJCWdsZmQgPSBnbGZzX29w
ZW5kaXIoaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWUtPmJhc2VfbmFtZSk7CiAJfSBlbHNlIGlmIChm
bGFncyAmIE9fQ1JFQVQpIHsKQEAgLTYxMywxMiArNjQ4LDE1IEBAIHN0YXRpYyBpbnQgdmZzX2ds
dXN0ZXJfb3BlbihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAl9CiAKIAlpZiAo
Z2xmZCA9PSBOVUxMKSB7CisJCUVORF9QUk9GSUxFKHN5c2NhbGxfb3Blbik7CiAJCS8qIG5vIGV4
dGVuc2lvbiBkZXN0cm95X2ZuLCBzbyBubyBuZWVkIHRvIHNhdmUgZXJybm8gKi8KIAkJVkZTX1JF
TU9WRV9GU1BfRVhURU5TSU9OKGhhbmRsZSwgZnNwKTsKIAkJcmV0dXJuIC0xOwogCX0KIAogCSpw
X3RtcCA9IGdsZmQ7CisKKwlFTkRfUFJPRklMRShzeXNjYWxsX29wZW4pOwogCS8qIEFuIGFyYml0
cmFyeSB2YWx1ZSBmb3IgZXJyb3IgcmVwb3J0aW5nLCBzbyB5b3Uga25vdyBpdHMgdXMuICovCiAJ
cmV0dXJuIDEzMzcxMzM3OwogfQpAQCAtNjI2LDYgKzY2NCw4IEBAIHN0YXRpYyBpbnQgdmZzX2ds
dXN0ZXJfb3BlbihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIHN0YXRpYyBpbnQg
dmZzX2dsdXN0ZXJfY2xvc2Uoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJCQkg
ICAgIGZpbGVzX3N0cnVjdCAqZnNwKQogeworCWludCByZXQ7CisKIAlnbGZzX2ZkX3QgKmdsZmQg
PSB2ZnNfZ2x1c3Rlcl9mZXRjaF9nbGZkKGhhbmRsZSwgZnNwKTsKIAlpZiAoZ2xmZCA9PSBOVUxM
KSB7CiAJCURCR19FUlIoIkZhaWxlZCB0byBmZXRjaCBnbHVzdGVyIGZkXG4iKTsKQEAgLTYzMywy
NCArNjczLDM1IEBAIHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJfY2xvc2Uoc3RydWN0IHZmc19oYW5k
bGVfc3RydWN0ICpoYW5kbGUsCiAJfQogCiAJVkZTX1JFTU9WRV9GU1BfRVhURU5TSU9OKGhhbmRs
ZSwgZnNwKTsKLQlyZXR1cm4gZ2xmc19jbG9zZShnbGZkKTsKKworCVNUQVJUX1BST0ZJTEUoc3lz
Y2FsbF9jbG9zZSk7CisJcmV0ID0gZ2xmc19jbG9zZShnbGZkKTsKKwlFTkRfUFJPRklMRShzeXNj
YWxsX2Nsb3NlKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBzc2l6ZV90IHZmc19nbHVz
dGVyX3ByZWFkKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJCSBmaWxlc19z
dHJ1Y3QgKmZzcCwgdm9pZCAqZGF0YSwgc2l6ZV90IG4sCiAJCQkJIG9mZl90IG9mZnNldCkKIHsK
Kwlzc2l6ZV90IHJldDsKKwogCWdsZnNfZmRfdCAqZ2xmZCA9IHZmc19nbHVzdGVyX2ZldGNoX2ds
ZmQoaGFuZGxlLCBmc3ApOwogCWlmIChnbGZkID09IE5VTEwpIHsKIAkJREJHX0VSUigiRmFpbGVk
IHRvIGZldGNoIGdsdXN0ZXIgZmRcbiIpOwogCQlyZXR1cm4gLTE7CiAJfQogCisJU1RBUlRfUFJP
RklMRV9CWVRFUyhzeXNjYWxsX3ByZWFkLCBuKTsKICNpZmRlZiBIQVZFX0dGQVBJX1ZFUl83XzYK
LQlyZXR1cm4gZ2xmc19wcmVhZChnbGZkLCBkYXRhLCBuLCBvZmZzZXQsIDAsIE5VTEwpOworCXJl
dCA9IGdsZnNfcHJlYWQoZ2xmZCwgZGF0YSwgbiwgb2Zmc2V0LCAwLCBOVUxMKTsKICNlbHNlCi0J
cmV0dXJuIGdsZnNfcHJlYWQoZ2xmZCwgZGF0YSwgbiwgb2Zmc2V0LCAwKTsKKwlyZXQgPSBnbGZz
X3ByZWFkKGdsZmQsIGRhdGEsIG4sIG9mZnNldCwgMCk7CiAjZW5kaWYKKwlFTkRfUFJPRklMRV9C
WVRFUyhzeXNjYWxsX3ByZWFkKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0cnVjdCBnbHVzdGVy
ZnNfYWlvX3N0YXRlOwpAQCAtNjY1LDYgKzcxNiw3IEBAIHN0cnVjdCBnbHVzdGVyZnNfYWlvX3N0
YXRlIHsKIAlib29sIGNhbmNlbGxlZDsKIAlzdHJ1Y3QgdmZzX2Fpb19zdGF0ZSB2ZnNfYWlvX3N0
YXRlOwogCXN0cnVjdCB0aW1lc3BlYyBzdGFydDsKKwlTTUJQUk9GSUxFX0JZVEVTX0FTWU5DX1NU
QVRFKHByb2ZpbGVfYnl0ZXMpOwogfTsKIAogc3RhdGljIGludCBhaW9fd3JhcHBlcl9kZXN0cnVj
dG9yKHN0cnVjdCBnbHVzdGVyZnNfYWlvX3dyYXBwZXIgKndyYXApCkBAIC03MDYsNiArNzU4LDgg
QEAgc3RhdGljIHZvaWQgYWlvX2dsdXN0ZXJmc19kb25lKGdsZnNfZmRfdCAqZmQsIHNzaXplX3Qg
cmV0LCB2b2lkICpkYXRhKQogCX0KIAlzdGF0ZS0+dmZzX2Fpb19zdGF0ZS5kdXJhdGlvbiA9IG5z
ZWNfdGltZV9kaWZmKCZlbmQsICZzdGF0ZS0+c3RhcnQpOwogCisJU01CUFJPRklMRV9CWVRFU19B
U1lOQ19FTkQoc3RhdGUtPnByb2ZpbGVfYnl0ZXMpOworCiAJLyoKIAkgKiBXcml0ZSB0aGUgc3Rh
dGUgcG9pbnRlciB0byBnbHVzdGVyZnNfYWlvX3N0YXRlIHRvIHRoZQogCSAqIHBpcGUsIHNvIHdl
IGNhbiBjYWxsIHRldmVudF9yZXFfZG9uZSgpIGZyb20gdGhlIG1haW4gdGhyZWFkLApAQCAtODc4
LDYgKzkzMiw4IEBAIHN0YXRpYyBzdHJ1Y3QgdGV2ZW50X3JlcSAqdmZzX2dsdXN0ZXJfcHJlYWRf
c2VuZChzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QKIAkgKi8KIAl0ZXZlbnRfcmVxX2RlZmVyX2Nh
bGxiYWNrKHJlcSwgZXYpOwogCisJU01CUFJPRklMRV9CWVRFU19BU1lOQ19TVEFSVChzeXNjYWxs
X2FzeXNfcHJlYWQsIHByb2ZpbGVfcCwKKwkJCQkgICAgIHN0YXRlLT5wcm9maWxlX2J5dGVzLCBu
KTsKIAlQUk9GSUxFX1RJTUVTVEFNUCgmc3RhdGUtPnN0YXJ0KTsKIAlyZXQgPSBnbGZzX3ByZWFk
X2FzeW5jKGdsZmQsIGRhdGEsIG4sIG9mZnNldCwgMCwgYWlvX2dsdXN0ZXJmc19kb25lLAogCQkJ
CXN0YXRlKTsKQEAgLTkyNyw2ICs5ODMsOCBAQCBzdGF0aWMgc3RydWN0IHRldmVudF9yZXEgKnZm
c19nbHVzdGVyX3B3cml0ZV9zZW5kKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdAogCSAqLwogCXRl
dmVudF9yZXFfZGVmZXJfY2FsbGJhY2socmVxLCBldik7CiAKKwlTTUJQUk9GSUxFX0JZVEVTX0FT
WU5DX1NUQVJUKHN5c2NhbGxfYXN5c19wd3JpdGUsIHByb2ZpbGVfcCwKKwkJCQkgICAgIHN0YXRl
LT5wcm9maWxlX2J5dGVzLCBuKTsKIAlQUk9GSUxFX1RJTUVTVEFNUCgmc3RhdGUtPnN0YXJ0KTsK
IAlyZXQgPSBnbGZzX3B3cml0ZV9hc3luYyhnbGZkLCBkYXRhLCBuLCBvZmZzZXQsIDAsIGFpb19n
bHVzdGVyZnNfZG9uZSwKIAkJCQlzdGF0ZSk7CkBAIC05NzIsMjkgKzEwMzAsNDEgQEAgc3RhdGlj
IHNzaXplX3QgdmZzX2dsdXN0ZXJfcHdyaXRlKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFu
ZGxlLAogCQkJCSAgZmlsZXNfc3RydWN0ICpmc3AsIGNvbnN0IHZvaWQgKmRhdGEsCiAJCQkJICBz
aXplX3Qgbiwgb2ZmX3Qgb2Zmc2V0KQogeworCXNzaXplX3QgcmV0OworCiAJZ2xmc19mZF90ICpn
bGZkID0gdmZzX2dsdXN0ZXJfZmV0Y2hfZ2xmZChoYW5kbGUsIGZzcCk7CiAJaWYgKGdsZmQgPT0g
TlVMTCkgewogCQlEQkdfRVJSKCJGYWlsZWQgdG8gZmV0Y2ggZ2x1c3RlciBmZFxuIik7CiAJCXJl
dHVybiAtMTsKIAl9CiAKKwlTVEFSVF9QUk9GSUxFX0JZVEVTKHN5c2NhbGxfcHdyaXRlLCBuKTsK
ICNpZmRlZiBIQVZFX0dGQVBJX1ZFUl83XzYKLQlyZXR1cm4gZ2xmc19wd3JpdGUoZ2xmZCwgZGF0
YSwgbiwgb2Zmc2V0LCAwLCBOVUxMLCBOVUxMKTsKKwlyZXQgPSBnbGZzX3B3cml0ZShnbGZkLCBk
YXRhLCBuLCBvZmZzZXQsIDAsIE5VTEwsIE5VTEwpOwogI2Vsc2UKLQlyZXR1cm4gZ2xmc19wd3Jp
dGUoZ2xmZCwgZGF0YSwgbiwgb2Zmc2V0LCAwKTsKKwlyZXQgPSBnbGZzX3B3cml0ZShnbGZkLCBk
YXRhLCBuLCBvZmZzZXQsIDApOwogI2VuZGlmCisJRU5EX1BST0ZJTEVfQllURVMoc3lzY2FsbF9w
d3JpdGUpOworCisJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIG9mZl90IHZmc19nbHVzdGVyX2xz
ZWVrKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJICAgICAgIGZpbGVzX3N0
cnVjdCAqZnNwLCBvZmZfdCBvZmZzZXQsIGludCB3aGVuY2UpCiB7CisJb2ZmX3QgcmV0ID0gMDsK
KwogCWdsZnNfZmRfdCAqZ2xmZCA9IHZmc19nbHVzdGVyX2ZldGNoX2dsZmQoaGFuZGxlLCBmc3Ap
OwogCWlmIChnbGZkID09IE5VTEwpIHsKIAkJREJHX0VSUigiRmFpbGVkIHRvIGZldGNoIGdsdXN0
ZXIgZmRcbiIpOwogCQlyZXR1cm4gLTE7CiAJfQogCi0JcmV0dXJuIGdsZnNfbHNlZWsoZ2xmZCwg
b2Zmc2V0LCB3aGVuY2UpOworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9sc2Vlayk7CisJcmV0ID0g
Z2xmc19sc2VlayhnbGZkLCBvZmZzZXQsIHdoZW5jZSk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9s
c2Vlayk7CisKKwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgc3NpemVfdCB2ZnNfZ2x1c3Rlcl9z
ZW5kZmlsZShzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwgaW50IHRvZmQsCkBAIC0x
MDIwLDggKzEwOTAsMTQgQEAgc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9yZW5hbWVhdChzdHJ1Y3Qg
dmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCWZpbGVzX3N0cnVjdCAqZHN0ZnNwLAogCQkJ
Y29uc3Qgc3RydWN0IHNtYl9maWxlbmFtZSAqc21iX2ZuYW1lX2RzdCkKIHsKLQlyZXR1cm4gZ2xm
c19yZW5hbWUoaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWVfc3JjLT5iYXNlX25hbWUsCi0JCQkgICBz
bWJfZm5hbWVfZHN0LT5iYXNlX25hbWUpOworCWludCByZXQ7CisKKwlTVEFSVF9QUk9GSUxFKHN5
c2NhbGxfcmVuYW1lYXQpOworCXJldCA9IGdsZnNfcmVuYW1lKGhhbmRsZS0+ZGF0YSwgc21iX2Zu
YW1lX3NyYy0+YmFzZV9uYW1lLAorCQkJICBzbWJfZm5hbWVfZHN0LT5iYXNlX25hbWUpOworCUVO
RF9QUk9GSUxFKHN5c2NhbGxfcmVuYW1lYXQpOworCisJcmV0dXJuIHJldDsKIH0KIAogc3RhdGlj
IHN0cnVjdCB0ZXZlbnRfcmVxICp2ZnNfZ2x1c3Rlcl9mc3luY19zZW5kKHN0cnVjdCB2ZnNfaGFu
ZGxlX3N0cnVjdApAQCAtMTA2MCw2ICsxMTM2LDggQEAgc3RhdGljIHN0cnVjdCB0ZXZlbnRfcmVx
ICp2ZnNfZ2x1c3Rlcl9mc3luY19zZW5kKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdAogCSAqLwog
CXRldmVudF9yZXFfZGVmZXJfY2FsbGJhY2socmVxLCBldik7CiAKKwlTTUJQUk9GSUxFX0JZVEVT
X0FTWU5DX1NUQVJUKHN5c2NhbGxfYXN5c19mc3luYywgcHJvZmlsZV9wLAorCQkJCSAgICAgc3Rh
dGUtPnByb2ZpbGVfYnl0ZXMsIDApOwogCVBST0ZJTEVfVElNRVNUQU1QKCZzdGF0ZS0+c3RhcnQp
OwogCXJldCA9IGdsZnNfZnN5bmNfYXN5bmMoZ2xmZCwgYWlvX2dsdXN0ZXJmc19kb25lLCBzdGF0
ZSk7CiAJaWYgKHJldCA8IDApIHsKQEAgLTEwODQsNiArMTE2Miw3IEBAIHN0YXRpYyBpbnQgdmZz
X2dsdXN0ZXJfc3RhdChzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAlzdHJ1Y3Qg
c3RhdCBzdDsKIAlpbnQgcmV0OwogCisJU1RBUlRfUFJPRklMRShzeXNjYWxsX3N0YXQpOwogCXJl
dCA9IGdsZnNfc3RhdChoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFzZV9uYW1lLCAmc3QpOwog
CWlmIChyZXQgPT0gMCkgewogCQlzbWJfc3RhdF9leF9mcm9tX3N0YXQoJnNtYl9mbmFtZS0+c3Qs
ICZzdCk7CkBAIC0xMDkyLDYgKzExNzEsOCBAQCBzdGF0aWMgaW50IHZmc19nbHVzdGVyX3N0YXQo
c3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJCURFQlVHKDAsICgiZ2xmc19zdGF0
KCVzKSBmYWlsZWQ6ICVzXG4iLAogCQkJICBzbWJfZm5hbWUtPmJhc2VfbmFtZSwgc3RyZXJyb3Io
ZXJybm8pKSk7CiAJfQorCUVORF9QUk9GSUxFKHN5c2NhbGxfc3RhdCk7CisKIAlyZXR1cm4gcmV0
OwogfQogCkBAIC0xMTA3LDYgKzExODgsNyBAQCBzdGF0aWMgaW50IHZmc19nbHVzdGVyX2ZzdGF0
KHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQlyZXR1cm4gLTE7CiAJfQogCisJ
U1RBUlRfUFJPRklMRShzeXNjYWxsX2ZzdGF0KTsKIAlyZXQgPSBnbGZzX2ZzdGF0KGdsZmQsICZz
dCk7CiAJaWYgKHJldCA9PSAwKSB7CiAJCXNtYl9zdGF0X2V4X2Zyb21fc3RhdChzYnVmLCAmc3Qp
OwpAQCAtMTExNSw2ICsxMTk3LDggQEAgc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9mc3RhdChzdHJ1
Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJREVCVUcoMCwgKCJnbGZzX2ZzdGF0KCVk
KSBmYWlsZWQ6ICVzXG4iLAogCQkJICBmc3AtPmZoLT5mZCwgc3RyZXJyb3IoZXJybm8pKSk7CiAJ
fQorCUVORF9QUk9GSUxFKHN5c2NhbGxfZnN0YXQpOworCiAJcmV0dXJuIHJldDsKIH0KIApAQCAt
MTEyNCw2ICsxMjA4LDcgQEAgc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9sc3RhdChzdHJ1Y3QgdmZz
X2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAlzdHJ1Y3Qgc3RhdCBzdDsKIAlpbnQgcmV0OwogCisJ
U1RBUlRfUFJPRklMRShzeXNjYWxsX2xzdGF0KTsKIAlyZXQgPSBnbGZzX2xzdGF0KGhhbmRsZS0+
ZGF0YSwgc21iX2ZuYW1lLT5iYXNlX25hbWUsICZzdCk7CiAJaWYgKHJldCA9PSAwKSB7CiAJCXNt
Yl9zdGF0X2V4X2Zyb21fc3RhdCgmc21iX2ZuYW1lLT5zdCwgJnN0KTsKQEAgLTExMzIsNiArMTIx
Nyw4IEBAIHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJfbHN0YXQoc3RydWN0IHZmc19oYW5kbGVfc3Ry
dWN0ICpoYW5kbGUsCiAJCURFQlVHKDAsICgiZ2xmc19sc3RhdCglcykgZmFpbGVkOiAlc1xuIiwK
IAkJCSAgc21iX2ZuYW1lLT5iYXNlX25hbWUsIHN0cmVycm9yKGVycm5vKSkpOwogCX0KKwlFTkRf
UFJPRklMRShzeXNjYWxsX2xzdGF0KTsKKwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTExMzksMjUg
KzEyMjYsNDUgQEAgc3RhdGljIHVpbnQ2NF90IHZmc19nbHVzdGVyX2dldF9hbGxvY19zaXplKHN0
cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJCQkgICBmaWxlc19zdHJ1Y3QgKmZz
cCwKIAkJCQkJICAgY29uc3QgU01CX1NUUlVDVF9TVEFUICpzYnVmKQogewotCXJldHVybiBzYnVm
LT5zdF9leF9ibG9ja3MgKiA1MTI7CisJdWludDY0X3QgcmV0OworCisJU1RBUlRfUFJPRklMRShz
eXNjYWxsX2dldF9hbGxvY19zaXplKTsKKwlyZXQgPSBzYnVmLT5zdF9leF9ibG9ja3MgKiA1MTI7
CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9nZXRfYWxsb2Nfc2l6ZSk7CisKKwlyZXR1cm4gcmV0Owog
fQogCiBzdGF0aWMgaW50IHZmc19nbHVzdGVyX3VubGluayhzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1
Y3QgKmhhbmRsZSwKIAkJCSAgICAgIGNvbnN0IHN0cnVjdCBzbWJfZmlsZW5hbWUgKnNtYl9mbmFt
ZSkKIHsKLQlyZXR1cm4gZ2xmc191bmxpbmsoaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWUtPmJhc2Vf
bmFtZSk7CisJaW50IHJldDsKKworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF91bmxpbmspOworCXJl
dCA9IGdsZnNfdW5saW5rKGhhbmRsZS0+ZGF0YSwgc21iX2ZuYW1lLT5iYXNlX25hbWUpOworCUVO
RF9QUk9GSUxFKHN5c2NhbGxfdW5saW5rKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBp
bnQgdmZzX2dsdXN0ZXJfY2htb2Qoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJ
CQkJY29uc3Qgc3RydWN0IHNtYl9maWxlbmFtZSAqc21iX2ZuYW1lLAogCQkJCW1vZGVfdCBtb2Rl
KQogewotCXJldHVybiBnbGZzX2NobW9kKGhhbmRsZS0+ZGF0YSwgc21iX2ZuYW1lLT5iYXNlX25h
bWUsIG1vZGUpOworCWludCByZXQ7CisKKwlTVEFSVF9QUk9GSUxFKHN5c2NhbGxfY2htb2QpOwor
CXJldCA9IGdsZnNfY2htb2QoaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWUtPmJhc2VfbmFtZSwgbW9k
ZSk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9jaG1vZCk7CisKKwlyZXR1cm4gcmV0OwogfQogCiBz
dGF0aWMgaW50IHZmc19nbHVzdGVyX2ZjaG1vZChzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhh
bmRsZSwKIAkJCSAgICAgIGZpbGVzX3N0cnVjdCAqZnNwLCBtb2RlX3QgbW9kZSkKIHsKKwlpbnQg
cmV0OworCiAJZ2xmc19mZF90ICpnbGZkID0gdmZzX2dsdXN0ZXJfZmV0Y2hfZ2xmZChoYW5kbGUs
IGZzcCk7CiAKIAlpZiAoZ2xmZCA9PSBOVUxMKSB7CkBAIC0xMTY1LDcgKzEyNzIsMTEgQEAgc3Rh
dGljIGludCB2ZnNfZ2x1c3Rlcl9mY2htb2Qoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5k
bGUsCiAJCXJldHVybiAtMTsKIAl9CiAKLQlyZXR1cm4gZ2xmc19mY2htb2QoZ2xmZCwgbW9kZSk7
CisJU1RBUlRfUFJPRklMRShzeXNjYWxsX2ZjaG1vZCk7CisJcmV0ID0gZ2xmc19mY2htb2QoZ2xm
ZCwgbW9kZSk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9mY2htb2QpOworCisJcmV0dXJuIHJldDsK
IH0KIAogc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9jaG93bihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1
Y3QgKmhhbmRsZSwKQEAgLTExNzMsMTkgKzEyODQsMzEgQEAgc3RhdGljIGludCB2ZnNfZ2x1c3Rl
cl9jaG93bihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCXVpZF90IHVpZCwK
IAkJCWdpZF90IGdpZCkKIHsKLQlyZXR1cm4gZ2xmc19jaG93bihoYW5kbGUtPmRhdGEsIHNtYl9m
bmFtZS0+YmFzZV9uYW1lLCB1aWQsIGdpZCk7CisJaW50IHJldDsKKworCVNUQVJUX1BST0ZJTEUo
c3lzY2FsbF9jaG93bik7CisJcmV0ID0gZ2xmc19jaG93bihoYW5kbGUtPmRhdGEsIHNtYl9mbmFt
ZS0+YmFzZV9uYW1lLCB1aWQsIGdpZCk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9jaG93bik7CisK
KwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHZmc19nbHVzdGVyX2ZjaG93bihzdHJ1Y3Qg
dmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCSAgICAgIGZpbGVzX3N0cnVjdCAqZnNwLCB1
aWRfdCB1aWQsIGdpZF90IGdpZCkKIHsKKwlpbnQgcmV0OworCiAJZ2xmc19mZF90ICpnbGZkID0g
dmZzX2dsdXN0ZXJfZmV0Y2hfZ2xmZChoYW5kbGUsIGZzcCk7CiAJaWYgKGdsZmQgPT0gTlVMTCkg
ewogCQlEQkdfRVJSKCJGYWlsZWQgdG8gZmV0Y2ggZ2x1c3RlciBmZFxuIik7CiAJCXJldHVybiAt
MTsKIAl9CiAKLQlyZXR1cm4gZ2xmc19mY2hvd24oZ2xmZCwgdWlkLCBnaWQpOworCVNUQVJUX1BS
T0ZJTEUoc3lzY2FsbF9mY2hvd24pOworCXJldCA9IGdsZnNfZmNob3duKGdsZmQsIHVpZCwgZ2lk
KTsKKwlFTkRfUFJPRklMRShzeXNjYWxsX2ZjaG93bik7CisKKwlyZXR1cm4gcmV0OwogfQogCiBz
dGF0aWMgaW50IHZmc19nbHVzdGVyX2xjaG93bihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhh
bmRsZSwKQEAgLTExOTMsMTMgKzEzMTYsMjUgQEAgc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9sY2hv
d24oc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJCQl1aWRfdCB1aWQsCiAJCQln
aWRfdCBnaWQpCiB7Ci0JcmV0dXJuIGdsZnNfbGNob3duKGhhbmRsZS0+ZGF0YSwgc21iX2ZuYW1l
LT5iYXNlX25hbWUsIHVpZCwgZ2lkKTsKKwlpbnQgcmV0OworCisJU1RBUlRfUFJPRklMRShzeXNj
YWxsX2xjaG93bik7CisJcmV0ID0gZ2xmc19sY2hvd24oaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWUt
PmJhc2VfbmFtZSwgdWlkLCBnaWQpOworCUVORF9QUk9GSUxFKHN5c2NhbGxfbGNob3duKTsKKwor
CXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJfY2hkaXIoc3RydWN0IHZm
c19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJCQljb25zdCBzdHJ1Y3Qgc21iX2ZpbGVuYW1lICpz
bWJfZm5hbWUpCiB7Ci0JcmV0dXJuIGdsZnNfY2hkaXIoaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWUt
PmJhc2VfbmFtZSk7CisJaW50IHJldDsKKworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9jaGRpcik7
CisJcmV0ID0gZ2xmc19jaGRpcihoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFzZV9uYW1lKTsK
KwlFTkRfUFJPRklMRShzeXNjYWxsX2NoZGlyKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRp
YyBzdHJ1Y3Qgc21iX2ZpbGVuYW1lICp2ZnNfZ2x1c3Rlcl9nZXR3ZChzdHJ1Y3QgdmZzX2hhbmRs
ZV9zdHJ1Y3QgKmhhbmRsZSwKQEAgLTEyMTQsNyArMTM0OSwxMCBAQCBzdGF0aWMgc3RydWN0IHNt
Yl9maWxlbmFtZSAqdmZzX2dsdXN0ZXJfZ2V0d2Qoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpo
YW5kbGUsCiAJCXJldHVybiBOVUxMOwogCX0KIAorCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9nZXR3
ZCk7CiAJcmV0ID0gZ2xmc19nZXRjd2QoaGFuZGxlLT5kYXRhLCBjd2QsIFBBVEhfTUFYIC0gMSk7
CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9nZXR3ZCk7CisKIAlpZiAocmV0ID09IE5VTEwpIHsKIAkJ
U0FGRV9GUkVFKGN3ZCk7CiAJCXJldHVybiBOVUxMOwpAQCAtMTIzMiw4ICsxMzcwLDExIEBAIHN0
YXRpYyBpbnQgdmZzX2dsdXN0ZXJfbnRpbWVzKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFu
ZGxlLAogCQkJICAgICAgY29uc3Qgc3RydWN0IHNtYl9maWxlbmFtZSAqc21iX2ZuYW1lLAogCQkJ
ICAgICAgc3RydWN0IHNtYl9maWxlX3RpbWUgKmZ0KQogeworCWludCByZXQgPSAtMTsKIAlzdHJ1
Y3QgdGltZXNwZWMgdGltZXNbMl07CiAKKwlTVEFSVF9QUk9GSUxFKHN5c2NhbGxfbnRpbWVzKTsK
KwogCWlmIChudWxsX3RpbWVzcGVjKGZ0LT5hdGltZSkpIHsKIAkJdGltZXNbMF0udHZfc2VjID0g
c21iX2ZuYW1lLT5zdC5zdF9leF9hdGltZS50dl9zZWM7CiAJCXRpbWVzWzBdLnR2X25zZWMgPSBz
bWJfZm5hbWUtPnN0LnN0X2V4X2F0aW1lLnR2X25zZWM7CkBAIC0xMjU0LDI2ICsxMzk1LDM2IEBA
IHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJfbnRpbWVzKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAq
aGFuZGxlLAogCQkJICAgICAgJnNtYl9mbmFtZS0+c3Quc3RfZXhfYXRpbWUpID09IDApICYmCiAJ
ICAgICh0aW1lc3BlY19jb21wYXJlKCZ0aW1lc1sxXSwKIAkJCSAgICAgICZzbWJfZm5hbWUtPnN0
LnN0X2V4X210aW1lKSA9PSAwKSkgeworCQlFTkRfUFJPRklMRShzeXNjYWxsX250aW1lcyk7CiAJ
CXJldHVybiAwOwogCX0KIAotCXJldHVybiBnbGZzX3V0aW1lbnMoaGFuZGxlLT5kYXRhLCBzbWJf
Zm5hbWUtPmJhc2VfbmFtZSwgdGltZXMpOworCXJldCA9IGdsZnNfdXRpbWVucyhoYW5kbGUtPmRh
dGEsIHNtYl9mbmFtZS0+YmFzZV9uYW1lLCB0aW1lcyk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9u
dGltZXMpOworCisJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9mdHJ1
bmNhdGUoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJCQkJIGZpbGVzX3N0cnVj
dCAqZnNwLCBvZmZfdCBvZmZzZXQpCiB7CisJaW50IHJldDsKKwogCWdsZnNfZmRfdCAqZ2xmZCA9
IHZmc19nbHVzdGVyX2ZldGNoX2dsZmQoaGFuZGxlLCBmc3ApOwogCWlmIChnbGZkID09IE5VTEwp
IHsKIAkJREJHX0VSUigiRmFpbGVkIHRvIGZldGNoIGdsdXN0ZXIgZmRcbiIpOwogCQlyZXR1cm4g
LTE7CiAJfQogCisJU1RBUlRfUFJPRklMRShzeXNjYWxsX2Z0cnVuY2F0ZSk7CiAjaWZkZWYgSEFW
RV9HRkFQSV9WRVJfN182Ci0JcmV0dXJuIGdsZnNfZnRydW5jYXRlKGdsZmQsIG9mZnNldCwgTlVM
TCwgTlVMTCk7CisJcmV0ID0gZ2xmc19mdHJ1bmNhdGUoZ2xmZCwgb2Zmc2V0LCBOVUxMLCBOVUxM
KTsKICNlbHNlCi0JcmV0dXJuIGdsZnNfZnRydW5jYXRlKGdsZmQsIG9mZnNldCk7CisJcmV0ID0g
Z2xmc19mdHJ1bmNhdGUoZ2xmZCwgb2Zmc2V0KTsKICNlbmRpZgorCUVORF9QUk9GSUxFKHN5c2Nh
bGxfZnRydW5jYXRlKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdmZzX2dsdXN0
ZXJfZmFsbG9jYXRlKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLApAQCAtMTI4MSw2
ICsxNDMyLDggQEAgc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9mYWxsb2NhdGUoc3RydWN0IHZmc19o
YW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJCQkJIHVpbnQzMl90IG1vZGUsCiAJCQkJIG9mZl90IG9m
ZnNldCwgb2ZmX3QgbGVuKQogeworCWludCByZXQ7CisKICNpZmRlZiBIQVZFX0dGQVBJX1ZFUl82
CiAJaW50IGtlZXBfc2l6ZSwgcHVuY2hfaG9sZTsKIAlnbGZzX2ZkX3QgKmdsZmQgPSB2ZnNfZ2x1
c3Rlcl9mZXRjaF9nbGZkKGhhbmRsZSwgZnNwKTsKQEAgLTEyOTgsMTUgKzE0NTEsMTkgQEAgc3Rh
dGljIGludCB2ZnNfZ2x1c3Rlcl9mYWxsb2NhdGUoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpo
YW5kbGUsCiAJCXJldHVybiAtMTsKIAl9CiAKKwlTVEFSVF9QUk9GSUxFKHN5c2NhbGxfZmFsbG9j
YXRlKTsKIAlpZiAocHVuY2hfaG9sZSkgewotCQlyZXR1cm4gZ2xmc19kaXNjYXJkKGdsZmQsIG9m
ZnNldCwgbGVuKTsKKwkJcmV0ID0gZ2xmc19kaXNjYXJkKGdsZmQsIG9mZnNldCwgbGVuKTsKIAl9
CiAKLQlyZXR1cm4gZ2xmc19mYWxsb2NhdGUoZ2xmZCwga2VlcF9zaXplLCBvZmZzZXQsIGxlbik7
CisJcmV0ID0gZ2xmc19mYWxsb2NhdGUoZ2xmZCwga2VlcF9zaXplLCBvZmZzZXQsIGxlbik7CiAj
ZWxzZQogCWVycm5vID0gRU5PVFNVUDsKLQlyZXR1cm4gLTE7CisJcmV0ID0gLTE7CiAjZW5kaWYK
KwlFTkRfUFJPRklMRShzeXNjYWxsX2ZhbGxvY2F0ZSk7CisKKwlyZXR1cm4gcmV0OwogfQogCiBz
dGF0aWMgc3RydWN0IHNtYl9maWxlbmFtZSAqdmZzX2dsdXN0ZXJfcmVhbHBhdGgoc3RydWN0IHZm
c19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCkBAIC0xMzIyLDYgKzE0NzksNyBAQCBzdGF0aWMgc3Ry
dWN0IHNtYl9maWxlbmFtZSAqdmZzX2dsdXN0ZXJfcmVhbHBhdGgoc3RydWN0IHZmc19oYW5kbGVf
c3RydWN0ICpoYW5kbAogCQlyZXR1cm4gTlVMTDsKIAl9CiAKKwlTVEFSVF9QUk9GSUxFKHN5c2Nh
bGxfcmVhbHBhdGgpOwogCXJlc3VsdCA9IGdsZnNfcmVhbHBhdGgoaGFuZGxlLT5kYXRhLAogCQkJ
c21iX2ZuYW1lLT5iYXNlX25hbWUsCiAJCQlyZXNvbHZlZF9wYXRoKTsKQEAgLTEzMzAsNiArMTQ4
OCw4IEBAIHN0YXRpYyBzdHJ1Y3Qgc21iX2ZpbGVuYW1lICp2ZnNfZ2x1c3Rlcl9yZWFscGF0aChz
dHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsCiAJfQogCiAJU0FGRV9GUkVFKHJlc29sdmVk
X3BhdGgpOworCUVORF9QUk9GSUxFKHN5c2NhbGxfcmVhbHBhdGgpOworCiAJcmV0dXJuIHJlc3Vs
dF9mbmFtZTsKIH0KIApAQCAtMTMzNyw4ICsxNDk3LDkgQEAgc3RhdGljIGJvb2wgdmZzX2dsdXN0
ZXJfbG9jayhzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCSAgICAgZmlsZXNf
c3RydWN0ICpmc3AsIGludCBvcCwgb2ZmX3Qgb2Zmc2V0LAogCQkJICAgICBvZmZfdCBjb3VudCwg
aW50IHR5cGUpCiB7CisJYm9vbCByZXQ7CiAJc3RydWN0IGZsb2NrIGZsb2NrID0geyAwLCB9Owot
CWludCByZXQ7CisKIAlnbGZzX2ZkX3QgKmdsZmQgPSB2ZnNfZ2x1c3Rlcl9mZXRjaF9nbGZkKGhh
bmRsZSwgZnNwKTsKIAlpZiAoZ2xmZCA9PSBOVUxMKSB7CiAJCURCR19FUlIoIkZhaWxlZCB0byBm
ZXRjaCBnbHVzdGVyIGZkXG4iKTsKQEAgLTEzNTEsMjMgKzE1MTIsMzIgQEAgc3RhdGljIGJvb2wg
dmZzX2dsdXN0ZXJfbG9jayhzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAlmbG9j
ay5sX2xlbiA9IGNvdW50OwogCWZsb2NrLmxfcGlkID0gMDsKIAorCVNUQVJUX1BST0ZJTEUoc3lz
Y2FsbF9mY250bF9sb2NrKTsKIAlyZXQgPSBnbGZzX3Bvc2l4X2xvY2soZ2xmZCwgb3AsICZmbG9j
ayk7CiAKIAlpZiAob3AgPT0gRl9HRVRMSykgewogCQkvKiBsb2NrIHF1ZXJ5LCB0cnVlIGlmIHNv
bWVvbmUgZWxzZSBoYXMgbG9ja2VkICovCiAJCWlmICgocmV0ICE9IC0xKSAmJgogCQkgICAgKGZs
b2NrLmxfdHlwZSAhPSBGX1VOTENLKSAmJgotCQkgICAgKGZsb2NrLmxfcGlkICE9IDApICYmIChm
bG9jay5sX3BpZCAhPSBnZXRwaWQoKSkpCi0JCQlyZXR1cm4gdHJ1ZTsKKwkJICAgIChmbG9jay5s
X3BpZCAhPSAwKSAmJiAoZmxvY2subF9waWQgIT0gZ2V0cGlkKCkpKSB7CisJCQlyZXQgPSB0cnVl
OworCQkJZ290byBvdXQ7CisJCX0KIAkJLyogbm90IG1lICovCi0JCXJldHVybiBmYWxzZTsKKwkJ
cmV0ID0gZmFsc2U7CisJCWdvdG8gb3V0OwogCX0KIAogCWlmIChyZXQgPT0gLTEpIHsKLQkJcmV0
dXJuIGZhbHNlOworCQlyZXQgPSBmYWxzZTsKKwkJZ290byBvdXQ7CiAJfQogCi0JcmV0dXJuIHRy
dWU7CisJcmV0ID0gdHJ1ZTsKK291dDoKKwlFTkRfUFJPRklMRShzeXNjYWxsX2ZjbnRsX2xvY2sp
OworCisJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9rZXJuZWxfZmxv
Y2soc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCkBAIC0xNDAzLDkgKzE1NzMsMTEg
QEAgc3RhdGljIGJvb2wgdmZzX2dsdXN0ZXJfZ2V0bG9jayhzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1
Y3QgKmhhbmRsZSwKIAlmbG9jay5sX2xlbiA9ICpwY291bnQ7CiAJZmxvY2subF9waWQgPSAwOwog
CisJU1RBUlRfUFJPRklMRShzeXNjYWxsX2ZjbnRsX2dldGxvY2spOwogCXJldCA9IGdsZnNfcG9z
aXhfbG9jayhnbGZkLCBGX0dFVExLLCAmZmxvY2spOwogCiAJaWYgKHJldCA9PSAtMSkgeworCQlF
TkRfUFJPRklMRShzeXNjYWxsX2ZjbnRsX2dldGxvY2spOwogCQlyZXR1cm4gZmFsc2U7CiAJfQog
CkBAIC0xNDEzLDYgKzE1ODUsNyBAQCBzdGF0aWMgYm9vbCB2ZnNfZ2x1c3Rlcl9nZXRsb2NrKHN0
cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCSpwb2Zmc2V0ID0gZmxvY2subF9zdGFy
dDsKIAkqcGNvdW50ID0gZmxvY2subF9sZW47CiAJKnBwaWQgPSBmbG9jay5sX3BpZDsKKwlFTkRf
UFJPRklMRShzeXNjYWxsX2ZjbnRsX2dldGxvY2spOwogCiAJcmV0dXJuIHRydWU7CiB9CkBAIC0x
NDIxLDkgKzE1OTQsMTUgQEAgc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9zeW1saW5rKHN0cnVjdCB2
ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJCWNvbnN0IGNoYXIgKmxpbmtfdGFyZ2V0LAog
CQkJCWNvbnN0IHN0cnVjdCBzbWJfZmlsZW5hbWUgKm5ld19zbWJfZm5hbWUpCiB7Ci0JcmV0dXJu
IGdsZnNfc3ltbGluayhoYW5kbGUtPmRhdGEsCisJaW50IHJldDsKKworCVNUQVJUX1BST0ZJTEUo
c3lzY2FsbF9zeW1saW5rKTsKKwlyZXQgPSBnbGZzX3N5bWxpbmsoaGFuZGxlLT5kYXRhLAogCQkJ
bGlua190YXJnZXQsCiAJCQluZXdfc21iX2ZuYW1lLT5iYXNlX25hbWUpOworCUVORF9QUk9GSUxF
KHN5c2NhbGxfc3ltbGluayk7CisKKwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHZmc19n
bHVzdGVyX3JlYWRsaW5rKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLApAQCAtMTQz
MSwxNiArMTYxMCwyOCBAQCBzdGF0aWMgaW50IHZmc19nbHVzdGVyX3JlYWRsaW5rKHN0cnVjdCB2
ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJCWNoYXIgKmJ1ZiwKIAkJCQlzaXplX3QgYnVm
c2l6KQogewotCXJldHVybiBnbGZzX3JlYWRsaW5rKGhhbmRsZS0+ZGF0YSwgc21iX2ZuYW1lLT5i
YXNlX25hbWUsIGJ1ZiwgYnVmc2l6KTsKKwlpbnQgcmV0OworCisJU1RBUlRfUFJPRklMRShzeXNj
YWxsX3JlYWRsaW5rKTsKKwlyZXQgPSBnbGZzX3JlYWRsaW5rKGhhbmRsZS0+ZGF0YSwgc21iX2Zu
YW1lLT5iYXNlX25hbWUsIGJ1ZiwgYnVmc2l6KTsKKwlFTkRfUFJPRklMRShzeXNjYWxsX3JlYWRs
aW5rKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJfbGluayhz
dHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCQljb25zdCBzdHJ1Y3Qgc21iX2Zp
bGVuYW1lICpvbGRfc21iX2ZuYW1lLAogCQkJCWNvbnN0IHN0cnVjdCBzbWJfZmlsZW5hbWUgKm5l
d19zbWJfZm5hbWUpCiB7Ci0JcmV0dXJuIGdsZnNfbGluayhoYW5kbGUtPmRhdGEsCisJaW50IHJl
dDsKKworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9saW5rKTsKKwlyZXQgPSBnbGZzX2xpbmsoaGFu
ZGxlLT5kYXRhLAogCQkJb2xkX3NtYl9mbmFtZS0+YmFzZV9uYW1lLAogCQkJbmV3X3NtYl9mbmFt
ZS0+YmFzZV9uYW1lKTsKKwlFTkRfUFJPRklMRShzeXNjYWxsX2xpbmspOworCisJcmV0dXJuIHJl
dDsKIH0KIAogc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9ta25vZChzdHJ1Y3QgdmZzX2hhbmRsZV9z
dHJ1Y3QgKmhhbmRsZSwKQEAgLTE0NDgsNyArMTYzOSwxMyBAQCBzdGF0aWMgaW50IHZmc19nbHVz
dGVyX21rbm9kKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJCW1vZGVfdCBt
b2RlLAogCQkJCVNNQl9ERVZfVCBkZXYpCiB7Ci0JcmV0dXJuIGdsZnNfbWtub2QoaGFuZGxlLT5k
YXRhLCBzbWJfZm5hbWUtPmJhc2VfbmFtZSwgbW9kZSwgZGV2KTsKKwlpbnQgcmV0OworCisJU1RB
UlRfUFJPRklMRShzeXNjYWxsX21rbm9kKTsKKwlyZXQgPSBnbGZzX21rbm9kKGhhbmRsZS0+ZGF0
YSwgc21iX2ZuYW1lLT5iYXNlX25hbWUsIG1vZGUsIGRldik7CisJRU5EX1BST0ZJTEUoc3lzY2Fs
bF9ta25vZCk7CisKKwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHZmc19nbHVzdGVyX2No
ZmxhZ3Moc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCkBAIC0xNTA3LDcgKzE3MDQs
NyBAQCBzdGF0aWMgc3NpemVfdCB2ZnNfZ2x1c3Rlcl9nZXR4YXR0cihzdHJ1Y3QgdmZzX2hhbmRs
ZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCQlzaXplX3Qgc2l6ZSkKIHsKIAlyZXR1cm4gZ2xmc19nZXR4
YXR0cihoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFzZV9uYW1lLAotCQkJbmFtZSwgdmFsdWUs
IHNpemUpOworCQkJICAgICBuYW1lLCB2YWx1ZSwgc2l6ZSk7CiB9CiAKIHN0YXRpYyBzc2l6ZV90
IHZmc19nbHVzdGVyX2ZnZXR4YXR0cihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwK
LS0gCjIuMjEuMAoK


--=-DsnFmpeQK/9++WO68LHE--


