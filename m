Return-Path: <samba-technical-bounces@lists.samba.org>
X-Original-To: lists+samba-technical@lfdr.de
Delivered-To: lists+samba-technical@lfdr.de
Received: from hr1.samba.org (hr1.samba.org [IPv6:2a01:4f8:192:486::1:0])
	by mail.lfdr.de (Postfix) with ESMTPS id B536EC9F47
	for <lists+samba-technical@lfdr.de>; Thu,  3 Oct 2019 15:20:38 +0200 (CEST)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.samba.org; s=2954282; h=Cc:From:List-Id:Date:To:Subject;
	bh=qhGtKM2YYD7fVGW6nHxS6+ml+PLqagqCcoCFTtkTako=; b=jdIE8SkJzbOzm0vX6QDvZY/Q4T
	1jehSAtv0B16wzzKQZytXQHTOqMv6s5gkX/rPDITAvVEeUq2awamjgNZLntr90Bs0CVYXG1yAEOZ0
	Nujks2RKNposeTJLBHuwpVtqHoP7WzQ8jTDK2s503DZQbBrmW7xtoK4GDdozaQKyJvQBIiw519sh4
	zdElCSC892iEvM3DRk3ouvtEbKsh4EDxxbFyMjIfIuFFhwDZGDJQNTq20WevdfpWKXCcG8sxm1FWV
	yaDnMr6Kpy7dN/50ymuZ5dUR7SeZTlk4o79YT47DcqReoMzuwpaQIMWxoQINen35skKIDGKlS/ALu
	lLBAqNjw==;
Received: from localhost ([::1]:23008 helo=hr1.samba.org) 
	by hr1.samba.org with esmtp (Exim)
	id 1iG11y-000kAC-Rr; Thu, 03 Oct 2019 13:20:30 +0000
Received: from latitanza.investici.org ([82.94.249.234]:28233) 
 by hr1.samba.org with esmtps (TLS1.2:ECDHE_RSA_CHACHA20_POLY1305:256)
 (Exim) id 1iG11t-000k9t-Bk
 for samba-technical@lists.samba.org; Thu, 03 Oct 2019 13:20:28 +0000
Received: from mx3.investici.org (localhost [127.0.0.1])
 by latitanza.investici.org (Postfix) with ESMTP id C1A5B1201A0;
 Thu,  3 Oct 2019 13:20:15 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=cryptolab.net;
 s=stigmate; t=1570108815;
 bh=qhGtKM2YYD7fVGW6nHxS6+ml+PLqagqCcoCFTtkTako=;
 h=Subject:From:To:Cc:Date:In-Reply-To:References:From;
 b=BpDeFGC23hJEhe+LC6rxsaoTwwcQBinxqUVfMh7EsEYSz+RHXM8rgGGv7uFe+x1Mv
 +0pPCd6SpuNet+pXea6u3jeeeDIUpHvq+J5Z9Ln8SoTabmpDPCpTD4o/eniFmzkTY7
 UV8idu9JHKy/ErQz3jZ+wsiDQbX/dGkBDoeil6dk=
Received: from [82.94.249.234] (mx3.investici.org [82.94.249.234])
 (Authenticated sender: anoopcs@autistici.org) by localhost (Postfix) with
 ESMTPSA id 1943312019D; Thu,  3 Oct 2019 13:20:12 +0000 (UTC)
Message-ID: <cb57dbab50e84cd24fdccd75530d11d5dbd002ed.camel@cryptolab.net>
Subject: Re: Implementing SMB_VFS_FCNTL in Samba
To: samba-technical@lists.samba.org
Date: Thu, 03 Oct 2019 18:50:07 +0530
In-Reply-To: <a71d6def280a3c6125009f3d1eafff54f8f059b4.camel@cryptolab.net>
References: <7024afc6236a656134f867288cdb37579425e3ee.camel@cryptolab.net>
 <20190923153107.GA4325@jeremy-ThinkPad-X1>
 <98add807a4ac55e5f401522fbdfd47ddf2358d16.camel@cryptolab.net>
 <e9469e1d026b34cf46c0012a463a2fbe610ffd17.camel@cryptolab.net>
 <a71d6def280a3c6125009f3d1eafff54f8f059b4.camel@cryptolab.net>
Content-Type: multipart/mixed; boundary="=-DD+aQEOCanZQ1RZ89T4q"
User-Agent: Evolution 3.32.4 (3.32.4-1.fc30) 
MIME-Version: 1.0
X-BeenThere: samba-technical@lists.samba.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Discussions on Samba internals. For general questions please
 subscribe to the list samba@lists.samba.org"
 <samba-technical.lists.samba.org>
List-Unsubscribe: <https://lists.samba.org/mailman/options/samba-technical>,
 <mailto:samba-technical-request@lists.samba.org?subject=unsubscribe>
List-Archive: <http://lists.samba.org/pipermail/samba-technical/>
List-Post: <mailto:samba-technical@lists.samba.org>
List-Help: <mailto:samba-technical-request@lists.samba.org?subject=help>
List-Subscribe: <https://lists.samba.org/mailman/listinfo/samba-technical>,
 <mailto:samba-technical-request@lists.samba.org?subject=subscribe>
From: Anoop C S via samba-technical <samba-technical@lists.samba.org>
Reply-To: Anoop C S <anoopcs@cryptolab.net>
Cc: Jeremy Allison <jra@samba.org>
Errors-To: samba-technical-bounces@lists.samba.org
Sender: "samba-technical" <samba-technical-bounces@lists.samba.org>


--=-DD+aQEOCanZQ1RZ89T4q
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 7bit

On Thu, 2019-10-03 at 18:43 +0530, Anoop C S via samba-technical wrote:
> On Sun, 2019-09-29 at 08:26 +0530, Anoop C S via samba-technical
> wrote:
> > On Thu, 2019-09-26 at 00:09 +0530, Anoop C S via samba-technical
> > wrote:
> > > On Mon, 2019-09-23 at 08:31 -0700, Jeremy Allison via samba-
> > > technical
> > > wrote:
> > > > On Mon, Sep 23, 2019 at 02:51:24PM +0530, Anoop C S wrote:
> > > > > Hi all,
> > > > > 
> > > > > I am attaching a patch as an attempt to implement
> > > > > SMB_VFS_FCNTL(for
> > > > > a
> > > > > background see 
> > > > > https://bugzilla.samba.org/show_bug.cgi?id=14060
> > > > > ).
> > > > > But I
> > > > > have the following question.
> > > > > 
> > > > > int fcntl(int fd, int cmd, ... /* arg */ );
> > > > > 
> > > > > As per man page, fcntl(2) system call can accept a third
> > > > > optional
> > > > > argument. If present it can be of type int, struct flock *,
> > > > > struct
> > > > > f_owner_ex * or uint64_t *. Our current SMB_VFS_LOCK and
> > > > > SMB_VFS_GETLOCK takes care of "Advisory record locking" and
> > > > > "Open
> > > > > file
> > > > > description locks" commands which requires third argument of
> > > > > type
> > > > > struct flock *. Other important fact here to notice is that
> > > > > in
> > > > > most
> > > > > cases the required third argument type is int. The patch I
> > > > > have
> > > > > prepared right now assumes third argument type to be int. 
> > > > > 
> > > > > So should we rename the call to something else(keeping third
> > > > > argument
> > > > > as int) or change the implementation to consider optional
> > > > > third
> > > > > argument as variable?
> > > > 
> > > > I think we need a varargs argument here like the real fcntl
> > > > definition.
> > > 
> > > Please find the attached patch in the above suggested direction.
> > > For
> > > now it is compile tested only. I will respond back afterwards
> > > with
> > > some basic testing results.
> > 
> > An unexpected crash(during runtime) had to be resolved and Gitlab
> > CI
> > pipeline revealed some missing changes. Attaching the patch
> > set(near-
> > to-final) which successfully completed the following pipeline:
> > 
> > https://gitlab.com/samba-team/devel/samba/pipelines/85180275
> > 
> > Few recent fcntl() cmd flags needs to be conditionally checked
> > inside
> > vfs_default which should be the only missing here.
> 
> OK. This should be it. I hope attached patch covers the missing part
> where recent fcntl() commands are detected during configure. A
> pipeline
> has been completed successfully for the attached patches.
> 
> https://gitlab.com/samba-team/devel/samba/pipelines/86263033
> 
> Reviews are appreciated.

Please ignore the previous version which had a typo in checking
HAVE_XX_XX inside vfs_default. Attaching the patches after correction.

--=-DD+aQEOCanZQ1RZ89T4q
Content-Disposition: attachment; filename="0001-s3-VFS-Add-SMB_VFS_FCNTL.patch"
Content-Transfer-Encoding: base64
Content-Type: text/x-patch; name="0001-s3-VFS-Add-SMB_VFS_FCNTL.patch"; charset="UTF-8"

RnJvbSA4ZTlhODRkYzNjMTRkMWQ2NjY5MzAwMDQwYzM5Njc2NzY1YjA5NWY2IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBBbm9vcCBDIFMgPGFub29wY3NAcmVkaGF0LmNvbT4KRGF0ZTog
RnJpLCAyNyBTZXAgMjAxOSAxMToxOTozNyArMDUzMApTdWJqZWN0OiBbUEFUQ0ggMS8yXSBzMzog
VkZTOiBBZGQgU01CX1ZGU19GQ05UTAoKU2lnbmVkLW9mZi1ieTogQW5vb3AgQyBTIDxhbm9vcGNz
QHJlZGhhdC5jb20+Ci0tLQogZXhhbXBsZXMvVkZTL3NrZWxfb3BhcXVlLmMgICAgICAgICAgICB8
ICAgOCArKwogZXhhbXBsZXMvVkZTL3NrZWxfdHJhbnNwYXJlbnQuYyAgICAgICB8ICAxNiArKysr
CiBzb3VyY2UzL2luY2x1ZGUvcHJvdG8uaCAgICAgICAgICAgICAgIHwgICAxICsKIHNvdXJjZTMv
aW5jbHVkZS9zbWJwcm9maWxlLmggICAgICAgICAgfCAgIDEgKwogc291cmNlMy9pbmNsdWRlL3Zm
cy5oICAgICAgICAgICAgICAgICB8ICAgNyArKwogc291cmNlMy9pbmNsdWRlL3Zmc19tYWNyb3Mu
aCAgICAgICAgICB8ICAgNSArKwogc291cmNlMy9saWIvc3lzdGVtLmMgICAgICAgICAgICAgICAg
ICB8ICAxNCArKysrCiBzb3VyY2UzL21vZHVsZXMvdmZzX2RlZmF1bHQuYyAgICAgICAgIHwgIDQ2
ICsrKysrKysrKysrCiBzb3VyY2UzL21vZHVsZXMvdmZzX2Z1bGxfYXVkaXQuYyAgICAgIHwgIDIx
ICsrKysrCiBzb3VyY2UzL21vZHVsZXMvdmZzX25vdF9pbXBsZW1lbnRlZC5jIHwgICA5ICsrKwog
c291cmNlMy9tb2R1bGVzL3Zmc190aW1lX2F1ZGl0LmMgICAgICB8ICAyNiArKysrKysKIHNvdXJj
ZTMvc21iZC92ZnMuYyAgICAgICAgICAgICAgICAgICAgfCAgMTUgKysrKwogc291cmNlMy93c2Ny
aXB0ICAgICAgICAgICAgICAgICAgICAgICB8IDEwOSArKysrKysrKysrKysrKysrKysrKysrKysr
KwogMTMgZmlsZXMgY2hhbmdlZCwgMjc4IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9leGFt
cGxlcy9WRlMvc2tlbF9vcGFxdWUuYyBiL2V4YW1wbGVzL1ZGUy9za2VsX29wYXF1ZS5jCmluZGV4
IDU5ODA0Njc1YzhlLi5iZTM3NzM5NjVlNyAxMDA2NDQKLS0tIGEvZXhhbXBsZXMvVkZTL3NrZWxf
b3BhcXVlLmMKKysrIGIvZXhhbXBsZXMvVkZTL3NrZWxfb3BhcXVlLmMKQEAgLTQ0NCw2ICs0NDQs
MTMgQEAgc3RhdGljIGludCBza2VsX2tlcm5lbF9mbG9jayhzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1
Y3QgKmhhbmRsZSwKIAlyZXR1cm4gLTE7CiB9CiAKK3N0YXRpYyBpbnQgc2tlbF9mY250bChzdHJ1
Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKKwkJICAgICAgc3RydWN0IGZpbGVzX3N0cnVj
dCAqZnNwLCBpbnQgY21kLCB2YV9saXN0IGNtZF9hcmcpCit7CisJZXJybm8gPSBFTk9TWVM7CisJ
cmV0dXJuIC0xOworfQorCiBzdGF0aWMgaW50IHNrZWxfbGludXhfc2V0bGVhc2Uoc3RydWN0IHZm
c19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJCQkgICAgICAgc3RydWN0IGZpbGVzX3N0cnVjdCAq
ZnNwLCBpbnQgbGVhc2V0eXBlKQogewpAQCAtMTA5MSw2ICsxMDk4LDcgQEAgc3RhdGljIHN0cnVj
dCB2ZnNfZm5fcG9pbnRlcnMgc2tlbF9vcGFxdWVfZm5zID0gewogCS5mYWxsb2NhdGVfZm4gPSBz
a2VsX2ZhbGxvY2F0ZSwKIAkubG9ja19mbiA9IHNrZWxfbG9jaywKIAkua2VybmVsX2Zsb2NrX2Zu
ID0gc2tlbF9rZXJuZWxfZmxvY2ssCisJLmZjbnRsX2ZuID0gc2tlbF9mY250bCwKIAkubGludXhf
c2V0bGVhc2VfZm4gPSBza2VsX2xpbnV4X3NldGxlYXNlLAogCS5nZXRsb2NrX2ZuID0gc2tlbF9n
ZXRsb2NrLAogCS5zeW1saW5rYXRfZm4gPSBza2VsX3N5bWxpbmthdCwKZGlmZiAtLWdpdCBhL2V4
YW1wbGVzL1ZGUy9za2VsX3RyYW5zcGFyZW50LmMgYi9leGFtcGxlcy9WRlMvc2tlbF90cmFuc3Bh
cmVudC5jCmluZGV4IGM3M2MyYTI2OTJiLi4wNjNhZjhmM2FlZCAxMDA2NDQKLS0tIGEvZXhhbXBs
ZXMvVkZTL3NrZWxfdHJhbnNwYXJlbnQuYworKysgYi9leGFtcGxlcy9WRlMvc2tlbF90cmFuc3Bh
cmVudC5jCkBAIC01NTIsNiArNTUyLDIxIEBAIHN0YXRpYyBpbnQgc2tlbF9rZXJuZWxfZmxvY2so
c3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJcmV0dXJuIFNNQl9WRlNfTkVYVF9L
RVJORUxfRkxPQ0soaGFuZGxlLCBmc3AsIHNoYXJlX21vZGUsIGFjY2Vzc19tYXNrKTsKIH0KIAor
c3RhdGljIGludCBza2VsX2ZjbnRsKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAor
CQkgICAgICBzdHJ1Y3QgZmlsZXNfc3RydWN0ICpmc3AsIGludCBjbWQsIHZhX2xpc3QgY21kX2Fy
ZykKK3sKKwl2b2lkICphcmc7CisJdmFfbGlzdCBkdXBfY21kX2FyZzsKKwlpbnQgcmVzdWx0Owor
CisJdmFfY29weShkdXBfY21kX2FyZywgY21kX2FyZyk7CisJYXJnID0gdmFfYXJnKGR1cF9jbWRf
YXJnLCB2b2lkICopOworCXJlc3VsdCA9IFNNQl9WRlNfTkVYVF9GQ05UTChoYW5kbGUsIGZzcCwg
Y21kLCBhcmcpOworCXZhX2VuZChkdXBfY21kX2FyZyk7CisKKwlyZXR1cm4gcmVzdWx0OworfQor
CiBzdGF0aWMgaW50IHNrZWxfbGludXhfc2V0bGVhc2Uoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0
ICpoYW5kbGUsCiAJCQkgICAgICAgc3RydWN0IGZpbGVzX3N0cnVjdCAqZnNwLCBpbnQgbGVhc2V0
eXBlKQogewpAQCAtMTM3OSw2ICsxMzk0LDcgQEAgc3RhdGljIHN0cnVjdCB2ZnNfZm5fcG9pbnRl
cnMgc2tlbF90cmFuc3BhcmVudF9mbnMgPSB7CiAJLmZhbGxvY2F0ZV9mbiA9IHNrZWxfZmFsbG9j
YXRlLAogCS5sb2NrX2ZuID0gc2tlbF9sb2NrLAogCS5rZXJuZWxfZmxvY2tfZm4gPSBza2VsX2tl
cm5lbF9mbG9jaywKKwkuZmNudGxfZm4gPSBza2VsX2ZjbnRsLAogCS5saW51eF9zZXRsZWFzZV9m
biA9IHNrZWxfbGludXhfc2V0bGVhc2UsCiAJLmdldGxvY2tfZm4gPSBza2VsX2dldGxvY2ssCiAJ
LnN5bWxpbmthdF9mbiA9IHNrZWxfc3ltbGlua2F0LApkaWZmIC0tZ2l0IGEvc291cmNlMy9pbmNs
dWRlL3Byb3RvLmggYi9zb3VyY2UzL2luY2x1ZGUvcHJvdG8uaAppbmRleCA5MWE3YzAwZmVmMi4u
Yzk4ZjdjZmEzNTEgMTAwNjQ0Ci0tLSBhL3NvdXJjZTMvaW5jbHVkZS9wcm90by5oCisrKyBiL3Nv
dXJjZTMvaW5jbHVkZS9wcm90by5oCkBAIC0yMTksNiArMjE5LDcgQEAgc3NpemVfdCBzeXNfc2Vu
ZChpbnQgcywgY29uc3Qgdm9pZCAqbXNnLCBzaXplX3QgbGVuLCBpbnQgZmxhZ3MpOwogc3NpemVf
dCBzeXNfcmVjdmZyb20oaW50IHMsIHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbiwgaW50IGZsYWdzLCBz
dHJ1Y3Qgc29ja2FkZHIgKmZyb20sIHNvY2tsZW5fdCAqZnJvbWxlbik7CiBpbnQgc3lzX2ZjbnRs
X3B0cihpbnQgZmQsIGludCBjbWQsIHZvaWQgKmFyZyk7CiBpbnQgc3lzX2ZjbnRsX2xvbmcoaW50
IGZkLCBpbnQgY21kLCBsb25nIGFyZyk7CitpbnQgc3lzX2ZjbnRsX2ludChpbnQgZmQsIGludCBj
bWQsIGludCBhcmcpOwogdm9pZCB1cGRhdGVfc3RhdF9leF9tdGltZShzdHJ1Y3Qgc3RhdF9leCAq
ZHN0LCBzdHJ1Y3QgdGltZXNwZWMgd3JpdGVfdHMpOwogdm9pZCB1cGRhdGVfc3RhdF9leF9pdGlt
ZShzdHJ1Y3Qgc3RhdF9leCAqZHN0LCBzdHJ1Y3QgdGltZXNwZWMgaXRpbWUpOwogdm9pZCB1cGRh
dGVfc3RhdF9leF9jcmVhdGVfdGltZShzdHJ1Y3Qgc3RhdF9leCAqZHN0LCBzdHJ1Y3QgdGltZXNw
ZWMgY3JlYXRlX3RpbWUpOwpkaWZmIC0tZ2l0IGEvc291cmNlMy9pbmNsdWRlL3NtYnByb2ZpbGUu
aCBiL3NvdXJjZTMvaW5jbHVkZS9zbWJwcm9maWxlLmgKaW5kZXggY2M1NGRlYTI3MTAuLmVhMmEy
OWEwNzU4IDEwMDY0NAotLS0gYS9zb3VyY2UzL2luY2x1ZGUvc21icHJvZmlsZS5oCisrKyBiL3Nv
dXJjZTMvaW5jbHVkZS9zbWJwcm9maWxlLmgKQEAgLTgwLDYgKzgwLDcgQEAgc3RydWN0IHRldmVu
dF9jb250ZXh0OwogCVNNQlBST0ZJTEVfU1RBVFNfQkFTSUMoc3lzY2FsbF9mYWxsb2NhdGUpIFwK
IAlTTUJQUk9GSUxFX1NUQVRTX0JBU0lDKHN5c2NhbGxfZmNudGxfbG9jaykgXAogCVNNQlBST0ZJ
TEVfU1RBVFNfQkFTSUMoc3lzY2FsbF9rZXJuZWxfZmxvY2spIFwKKwlTTUJQUk9GSUxFX1NUQVRT
X0JBU0lDKHN5c2NhbGxfZmNudGwpIFwKIAlTTUJQUk9GSUxFX1NUQVRTX0JBU0lDKHN5c2NhbGxf
bGludXhfc2V0bGVhc2UpIFwKIAlTTUJQUk9GSUxFX1NUQVRTX0JBU0lDKHN5c2NhbGxfZmNudGxf
Z2V0bG9jaykgXAogCVNNQlBST0ZJTEVfU1RBVFNfQkFTSUMoc3lzY2FsbF9yZWFkbGlua2F0KSBc
CmRpZmYgLS1naXQgYS9zb3VyY2UzL2luY2x1ZGUvdmZzLmggYi9zb3VyY2UzL2luY2x1ZGUvdmZz
LmgKaW5kZXggNmJhNjUzZjU2YzcuLjMyNjY4N2Y1ZWUxIDEwMDY0NAotLS0gYS9zb3VyY2UzL2lu
Y2x1ZGUvdmZzLmgKKysrIGIvc291cmNlMy9pbmNsdWRlL3Zmcy5oCkBAIC0yODIsNiArMjgyLDcg
QEAKIC8qIFZlcnNpb24gNDIgLSBNb3ZlIGNoYW5nZV90b191c2VyX2J5X2ZzcCgpIC0+IGNoYW5n
ZV90b191c2VyX2FuZF9zZXJ2aWNlX2J5X2ZzcCgpICovCiAvKiBWZXJzaW9uIDQyIC0gTW92ZSBb
dW5dYmVjb21lX3VzZXIqKCkgLT4gW3VuXWJlY29tZV91c2VyX3dpdGhvdXRfc2VydmljZSooKSAq
LwogLyogVmVyc2lvbiA0MiAtIE1vdmUgU01CX1ZGU19VTkxJTksgLT4gU01CX1ZGU19VTkxJTktB
VC4gKi8KKy8qIFZlcnNpb24gNDIgLSBBZGQgU01CX1ZGU19GQ05UTCAqLwogCiAjZGVmaW5lIFNN
Ql9WRlNfSU5URVJGQUNFX1ZFUlNJT04gNDIKIApAQCAtODEwLDYgKzgxMSw4IEBAIHN0cnVjdCB2
ZnNfZm5fcG9pbnRlcnMgewogCWJvb2wgKCpsb2NrX2ZuKShzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1
Y3QgKmhhbmRsZSwgc3RydWN0IGZpbGVzX3N0cnVjdCAqZnNwLCBpbnQgb3AsIG9mZl90IG9mZnNl
dCwgb2ZmX3QgY291bnQsIGludCB0eXBlKTsKIAlpbnQgKCprZXJuZWxfZmxvY2tfZm4pKHN0cnVj
dCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLCBzdHJ1Y3QgZmlsZXNfc3RydWN0ICpmc3AsCiAJ
CQkgICAgICAgdWludDMyX3Qgc2hhcmVfbW9kZSwgdWludDMyX3QgYWNjZXNzX21hc2spOworCWlu
dCAoKmZjbnRsX2ZuKShzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKKwkJCXN0cnVj
dCBmaWxlc19zdHJ1Y3QgKmZzcCwgaW50IGNtZCwgdmFfbGlzdCBjbWRfYXJnKTsKIAlpbnQgKCps
aW51eF9zZXRsZWFzZV9mbikoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsIHN0cnVj
dCBmaWxlc19zdHJ1Y3QgKmZzcCwgaW50IGxlYXNldHlwZSk7CiAJYm9vbCAoKmdldGxvY2tfZm4p
KHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLCBzdHJ1Y3QgZmlsZXNfc3RydWN0ICpm
c3AsIG9mZl90ICpwb2Zmc2V0LCBvZmZfdCAqcGNvdW50LCBpbnQgKnB0eXBlLCBwaWRfdCAqcHBp
ZCk7CiAJaW50ICgqc3ltbGlua2F0X2ZuKShzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRs
ZSwKQEAgLTEzNDUsNiArMTM0OCw4IEBAIGJvb2wgc21iX3Zmc19jYWxsX2xvY2soc3RydWN0IHZm
c19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiBpbnQgc21iX3Zmc19jYWxsX2tlcm5lbF9mbG9jayhz
dHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCSAgICAgIHN0cnVjdCBmaWxlc19z
dHJ1Y3QgKmZzcCwgdWludDMyX3Qgc2hhcmVfbW9kZSwKIAkJCSAgICAgIHVpbnQzMl90IGFjY2Vz
c19tYXNrKTsKK2ludCBzbWJfdmZzX2NhbGxfZmNudGwoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0
ICpoYW5kbGUsCisJCSAgICAgICBzdHJ1Y3QgZmlsZXNfc3RydWN0ICpmc3AsIGludCBjbWQsIC4u
Lik7CiBpbnQgc21iX3Zmc19jYWxsX2xpbnV4X3NldGxlYXNlKHN0cnVjdCB2ZnNfaGFuZGxlX3N0
cnVjdCAqaGFuZGxlLAogCQkJCXN0cnVjdCBmaWxlc19zdHJ1Y3QgKmZzcCwgaW50IGxlYXNldHlw
ZSk7CiBib29sIHNtYl92ZnNfY2FsbF9nZXRsb2NrKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAq
aGFuZGxlLApAQCAtMTc4MCw2ICsxNzg1LDggQEAgYm9vbCB2ZnNfbm90X2ltcGxlbWVudGVkX2xv
Y2sodmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwgZmlsZXNfc3RydWN0ICpmc3AsIGludAogaW50
IHZmc19ub3RfaW1wbGVtZW50ZWRfa2VybmVsX2Zsb2NrKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVj
dCAqaGFuZGxlLAogCQkJCSAgICAgc3RydWN0IGZpbGVzX3N0cnVjdCAqZnNwLAogCQkJCSAgICAg
dWludDMyX3Qgc2hhcmVfbW9kZSwgdWludDMyX3QgYWNjZXNzX21hc2spOworaW50IHZmc19ub3Rf
aW1wbGVtZW50ZWRfZmNudGwoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCisJCQkg
ICAgICBzdHJ1Y3QgZmlsZXNfc3RydWN0ICpmc3AsIGludCBjbWQsIHZhX2xpc3QgY21kX2FyZyk7
CiBpbnQgdmZzX25vdF9pbXBsZW1lbnRlZF9saW51eF9zZXRsZWFzZShzdHJ1Y3QgdmZzX2hhbmRs
ZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCQkgICAgICAgc3RydWN0IGZpbGVzX3N0cnVjdCAqZnNwLCBp
bnQgbGVhc2V0eXBlKTsKIGJvb2wgdmZzX25vdF9pbXBsZW1lbnRlZF9nZXRsb2NrKHZmc19oYW5k
bGVfc3RydWN0ICpoYW5kbGUsIGZpbGVzX3N0cnVjdCAqZnNwLApkaWZmIC0tZ2l0IGEvc291cmNl
My9pbmNsdWRlL3Zmc19tYWNyb3MuaCBiL3NvdXJjZTMvaW5jbHVkZS92ZnNfbWFjcm9zLmgKaW5k
ZXggMjk3OTc2OWU3ZDUuLjJkZDU5NzExZTE5IDEwMDY0NAotLS0gYS9zb3VyY2UzL2luY2x1ZGUv
dmZzX21hY3Jvcy5oCisrKyBiL3NvdXJjZTMvaW5jbHVkZS92ZnNfbWFjcm9zLmgKQEAgLTI4Niw2
ICsyODYsMTEgQEAKICNkZWZpbmUgU01CX1ZGU19ORVhUX0tFUk5FTF9GTE9DSyhoYW5kbGUsIGZz
cCwgc2hhcmVfbW9kZSwgYWNjZXNzX21hc2spCVwKIAlzbWJfdmZzX2NhbGxfa2VybmVsX2Zsb2Nr
KChoYW5kbGUpLT5uZXh0LCAoZnNwKSwgKHNoYXJlX21vZGUpLCAoYWNjZXNzX21hc2spKQogCisj
ZGVmaW5lIFNNQl9WRlNfRkNOVEwoZnNwLCBjbWQsIC4uLikgXAorCXNtYl92ZnNfY2FsbF9mY250
bCgoZnNwKS0+Y29ubi0+dmZzX2hhbmRsZXMsIChmc3ApLCAoY21kKSwgKF9fVkFfQVJHU19fKSkK
KyNkZWZpbmUgU01CX1ZGU19ORVhUX0ZDTlRMKGhhbmRsZSwgZnNwLCBjbWQsIC4uLikgXAorCXNt
Yl92ZnNfY2FsbF9mY250bCgoaGFuZGxlKS0+bmV4dCwgKGZzcCksIChjbWQpLCAoX19WQV9BUkdT
X18pKQorCiAjZGVmaW5lIFNNQl9WRlNfTElOVVhfU0VUTEVBU0UoZnNwLCBsZWFzZXR5cGUpIFwK
IAlzbWJfdmZzX2NhbGxfbGludXhfc2V0bGVhc2UoKGZzcCktPmNvbm4tPnZmc19oYW5kbGVzLCAo
ZnNwKSwgKGxlYXNldHlwZSkpCiAjZGVmaW5lIFNNQl9WRlNfTkVYVF9MSU5VWF9TRVRMRUFTRSho
YW5kbGUsIGZzcCwgbGVhc2V0eXBlKSBcCmRpZmYgLS1naXQgYS9zb3VyY2UzL2xpYi9zeXN0ZW0u
YyBiL3NvdXJjZTMvbGliL3N5c3RlbS5jCmluZGV4IGRlZjgyODFmYzQzLi42NzkzMzIyNTVjMCAx
MDA2NDQKLS0tIGEvc291cmNlMy9saWIvc3lzdGVtLmMKKysrIGIvc291cmNlMy9saWIvc3lzdGVt
LmMKQEAgLTEwOCw2ICsxMDgsMjAgQEAgaW50IHN5c19mY250bF9sb25nKGludCBmZCwgaW50IGNt
ZCwgbG9uZyBhcmcpCiAJcmV0dXJuIHJldDsKIH0KIAorLyoqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKK0EgZmNudGwgd3Jh
cHBlciB0aGF0IHdpbGwgZGVhbCB3aXRoIEVJTlRSLgorKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCisKK2ludCBzeXNf
ZmNudGxfaW50KGludCBmZCwgaW50IGNtZCwgaW50IGFyZykKK3sKKwlpbnQgcmV0OworCisJZG8g
eworCQlyZXQgPSBmY250bChmZCwgY21kLCBhcmcpOworCX0gd2hpbGUgKHJldCA9PSAtMSAmJiBl
cnJubyA9PSBFSU5UUik7CisJcmV0dXJuIHJldDsKK30KKwogLyoqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioK
ICBHZXQvU2V0IGFsbCB0aGUgcG9zc2libGUgdGltZSBmaWVsZHMgZnJvbSBhIHN0YXQgc3RydWN0
IGFzIGEgdGltZXNwZWMuCiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwpkaWZmIC0tZ2l0IGEvc291cmNl
My9tb2R1bGVzL3Zmc19kZWZhdWx0LmMgYi9zb3VyY2UzL21vZHVsZXMvdmZzX2RlZmF1bHQuYwpp
bmRleCA3MzhiZTNiZjJkNi4uOWJmODAwNWJjZDcgMTAwNjQ0Ci0tLSBhL3NvdXJjZTMvbW9kdWxl
cy92ZnNfZGVmYXVsdC5jCisrKyBiL3NvdXJjZTMvbW9kdWxlcy92ZnNfZGVmYXVsdC5jCkBAIC0y
NjE1LDYgKzI2MTUsNTEgQEAgc3RhdGljIGludCB2ZnN3cmFwX2tlcm5lbF9mbG9jayh2ZnNfaGFu
ZGxlX3N0cnVjdCAqaGFuZGxlLCBmaWxlc19zdHJ1Y3QgKmZzcCwKIAlyZXR1cm4gMDsKIH0KIAor
c3RhdGljIGludCB2ZnN3cmFwX2ZjbnRsKHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsIGZpbGVz
X3N0cnVjdCAqZnNwLCBpbnQgY21kLAorCQkJIHZhX2xpc3QgY21kX2FyZykKK3sKKwl2b2lkICph
cmdwOworCXZhX2xpc3QgZHVwX2NtZF9hcmc7CisJaW50IHJlc3VsdDsKKwlpbnQgdmFsOworCisJ
U1RBUlRfUFJPRklMRShzeXNjYWxsX2ZjbnRsKTsKKworCXZhX2NvcHkoZHVwX2NtZF9hcmcsIGNt
ZF9hcmcpOworCisJc3dpdGNoKGNtZCkgeworCWNhc2UgRl9TRVRMSzoKKwljYXNlIEZfU0VUTEtX
OgorCWNhc2UgRl9HRVRMSzoKKyNpZiBkZWZpbmVkKEhBVkVfT0ZEX0xPQ0tTKQorCWNhc2UgRl9P
RkRfU0VUTEs6CisJY2FzZSBGX09GRF9TRVRMS1c6CisJY2FzZSBGX09GRF9HRVRMSzoKKyNlbmRp
ZgorI2lmIGRlZmluZWQoSEFWRV9GX09XTkVSX0VYKQorCWNhc2UgRl9HRVRPV05fRVg6CisJY2Fz
ZSBGX1NFVE9XTl9FWDoKKyNlbmRpZgorI2lmIGRlZmluZWQoSEFWRV9SV19ISU5UUykKKwljYXNl
IEZfR0VUX1JXX0hJTlQ6CisJY2FzZSBGX1NFVF9SV19ISU5UOgorCWNhc2UgRl9HRVRfRklMRV9S
V19ISU5UOgorCWNhc2UgRl9TRVRfRklMRV9SV19ISU5UOgorI2VuZGlmCisJCWFyZ3AgPSB2YV9h
cmcoZHVwX2NtZF9hcmcsIHZvaWQgKik7CisJCXJlc3VsdCA9IHN5c19mY250bF9wdHIoZnNwLT5m
aC0+ZmQsIGNtZCwgYXJncCk7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXZhbCA9IHZhX2FyZyhk
dXBfY21kX2FyZywgaW50KTsKKwkJcmVzdWx0ID0gc3lzX2ZjbnRsX2ludChmc3AtPmZoLT5mZCwg
Y21kLCB2YWwpOworCX0KKworCXZhX2VuZChkdXBfY21kX2FyZyk7CisKKwlFTkRfUFJPRklMRShz
eXNjYWxsX2ZjbnRsKTsKKwlyZXR1cm4gcmVzdWx0OworfQorCiBzdGF0aWMgYm9vbCB2ZnN3cmFw
X2dldGxvY2sodmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwgZmlsZXNfc3RydWN0ICpmc3AsIG9m
Zl90ICpwb2Zmc2V0LCBvZmZfdCAqcGNvdW50LCBpbnQgKnB0eXBlLCBwaWRfdCAqcHBpZCkKIHsK
IAlib29sIHJlc3VsdDsKQEAgLTM1MDYsNiArMzU1MSw3IEBAIHN0YXRpYyBzdHJ1Y3QgdmZzX2Zu
X3BvaW50ZXJzIHZmc19kZWZhdWx0X2ZucyA9IHsKIAkuZmFsbG9jYXRlX2ZuID0gdmZzd3JhcF9m
YWxsb2NhdGUsCiAJLmxvY2tfZm4gPSB2ZnN3cmFwX2xvY2ssCiAJLmtlcm5lbF9mbG9ja19mbiA9
IHZmc3dyYXBfa2VybmVsX2Zsb2NrLAorCS5mY250bF9mbiA9IHZmc3dyYXBfZmNudGwsCiAJLmxp
bnV4X3NldGxlYXNlX2ZuID0gdmZzd3JhcF9saW51eF9zZXRsZWFzZSwKIAkuZ2V0bG9ja19mbiA9
IHZmc3dyYXBfZ2V0bG9jaywKIAkuc3ltbGlua2F0X2ZuID0gdmZzd3JhcF9zeW1saW5rYXQsCmRp
ZmYgLS1naXQgYS9zb3VyY2UzL21vZHVsZXMvdmZzX2Z1bGxfYXVkaXQuYyBiL3NvdXJjZTMvbW9k
dWxlcy92ZnNfZnVsbF9hdWRpdC5jCmluZGV4IGRlNTkxZWIyMTM2Li43NTdjZDI2ZDNmMSAxMDA2
NDQKLS0tIGEvc291cmNlMy9tb2R1bGVzL3Zmc19mdWxsX2F1ZGl0LmMKKysrIGIvc291cmNlMy9t
b2R1bGVzL3Zmc19mdWxsX2F1ZGl0LmMKQEAgLTE1MSw2ICsxNTEsNyBAQCB0eXBlZGVmIGVudW0g
X3Zmc19vcF90eXBlIHsKIAlTTUJfVkZTX09QX0ZBTExPQ0FURSwKIAlTTUJfVkZTX09QX0xPQ0ss
CiAJU01CX1ZGU19PUF9LRVJORUxfRkxPQ0ssCisJU01CX1ZGU19PUF9GQ05UTCwKIAlTTUJfVkZT
X09QX0xJTlVYX1NFVExFQVNFLAogCVNNQl9WRlNfT1BfR0VUTE9DSywKIAlTTUJfVkZTX09QX1NZ
TUxJTktBVCwKQEAgLTE3MzQsNiArMTczNSwyNSBAQCBzdGF0aWMgaW50IHNtYl9mdWxsX2F1ZGl0
X2tlcm5lbF9mbG9jayhzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAlyZXR1cm4g
cmVzdWx0OwogfQogCitzdGF0aWMgaW50IHNtYl9mdWxsX2F1ZGl0X2ZjbnRsKHN0cnVjdCB2ZnNf
aGFuZGxlX3N0cnVjdCAqaGFuZGxlLAorCQkJCXN0cnVjdCBmaWxlc19zdHJ1Y3QgKmZzcCwKKwkJ
CQlpbnQgY21kLCB2YV9saXN0IGNtZF9hcmcpCit7CisJdm9pZCAqYXJnOworCXZhX2xpc3QgZHVw
X2NtZF9hcmc7CisJaW50IHJlc3VsdDsKKworCXZhX2NvcHkoZHVwX2NtZF9hcmcsIGNtZF9hcmcp
OworCWFyZyA9IHZhX2FyZyhkdXBfY21kX2FyZywgdm9pZCAqKTsKKwlyZXN1bHQgPSBTTUJfVkZT
X05FWFRfRkNOVEwoaGFuZGxlLCBmc3AsIGNtZCwgYXJnKTsKKwl2YV9lbmQoZHVwX2NtZF9hcmcp
OworCisJZG9fbG9nKFNNQl9WRlNfT1BfRkNOVEwsIChyZXN1bHQgPj0gMCksIGhhbmRsZSwgIiVz
IiwKKwkgICAgICAgZnNwX3N0cl9kb19sb2coZnNwKSk7CisKKwlyZXR1cm4gcmVzdWx0OworfQor
CiBzdGF0aWMgaW50IHNtYl9mdWxsX2F1ZGl0X2xpbnV4X3NldGxlYXNlKHZmc19oYW5kbGVfc3Ry
dWN0ICpoYW5kbGUsIGZpbGVzX3N0cnVjdCAqZnNwLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgaW50IGxlYXNldHlwZSkKIHsKQEAgLTI5ODEsNiArMzAwMSw3IEBAIHN0YXRpYyBz
dHJ1Y3QgdmZzX2ZuX3BvaW50ZXJzIHZmc19mdWxsX2F1ZGl0X2ZucyA9IHsKIAkuZmFsbG9jYXRl
X2ZuID0gc21iX2Z1bGxfYXVkaXRfZmFsbG9jYXRlLAogCS5sb2NrX2ZuID0gc21iX2Z1bGxfYXVk
aXRfbG9jaywKIAkua2VybmVsX2Zsb2NrX2ZuID0gc21iX2Z1bGxfYXVkaXRfa2VybmVsX2Zsb2Nr
LAorCS5mY250bF9mbiA9IHNtYl9mdWxsX2F1ZGl0X2ZjbnRsLAogCS5saW51eF9zZXRsZWFzZV9m
biA9IHNtYl9mdWxsX2F1ZGl0X2xpbnV4X3NldGxlYXNlLAogCS5nZXRsb2NrX2ZuID0gc21iX2Z1
bGxfYXVkaXRfZ2V0bG9jaywKIAkuc3ltbGlua2F0X2ZuID0gc21iX2Z1bGxfYXVkaXRfc3ltbGlu
a2F0LApkaWZmIC0tZ2l0IGEvc291cmNlMy9tb2R1bGVzL3Zmc19ub3RfaW1wbGVtZW50ZWQuYyBi
L3NvdXJjZTMvbW9kdWxlcy92ZnNfbm90X2ltcGxlbWVudGVkLmMKaW5kZXggZmZjYmE3YmQ4ZGIu
LjJiOTA2YjNjZjI4IDEwMDY0NAotLS0gYS9zb3VyY2UzL21vZHVsZXMvdmZzX25vdF9pbXBsZW1l
bnRlZC5jCisrKyBiL3NvdXJjZTMvbW9kdWxlcy92ZnNfbm90X2ltcGxlbWVudGVkLmMKQEAgLTQ0
Miw2ICs0NDIsMTQgQEAgaW50IHZmc19ub3RfaW1wbGVtZW50ZWRfa2VybmVsX2Zsb2NrKHN0cnVj
dCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCXJldHVybiAtMTsKIH0KIAoraW50IHZmc19u
b3RfaW1wbGVtZW50ZWRfZmNudGwoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCisJ
CQkgICAgICBzdHJ1Y3QgZmlsZXNfc3RydWN0ICpmc3AsIGludCBjbWQsCisJCQkgICAgICB2YV9s
aXN0IGNtZF9hcmcpCit7CisJZXJybm8gPSBFTk9TWVM7CisJcmV0dXJuIC0xOworfQorCiBpbnQg
dmZzX25vdF9pbXBsZW1lbnRlZF9saW51eF9zZXRsZWFzZShzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1
Y3QgKmhhbmRsZSwKIAkJCQkgICAgICAgc3RydWN0IGZpbGVzX3N0cnVjdCAqZnNwLCBpbnQgbGVh
c2V0eXBlKQogewpAQCAtMTA5NSw2ICsxMTAzLDcgQEAgc3RhdGljIHN0cnVjdCB2ZnNfZm5fcG9p
bnRlcnMgdmZzX25vdF9pbXBsZW1lbnRlZF9mbnMgPSB7CiAJLmZhbGxvY2F0ZV9mbiA9IHZmc19u
b3RfaW1wbGVtZW50ZWRfZmFsbG9jYXRlLAogCS5sb2NrX2ZuID0gdmZzX25vdF9pbXBsZW1lbnRl
ZF9sb2NrLAogCS5rZXJuZWxfZmxvY2tfZm4gPSB2ZnNfbm90X2ltcGxlbWVudGVkX2tlcm5lbF9m
bG9jaywKKwkuZmNudGxfZm4gPSB2ZnNfbm90X2ltcGxlbWVudGVkX2ZjbnRsLAogCS5saW51eF9z
ZXRsZWFzZV9mbiA9IHZmc19ub3RfaW1wbGVtZW50ZWRfbGludXhfc2V0bGVhc2UsCiAJLmdldGxv
Y2tfZm4gPSB2ZnNfbm90X2ltcGxlbWVudGVkX2dldGxvY2ssCiAJLnN5bWxpbmthdF9mbiA9IHZm
c19ub3RfaW1wbGVtZW50ZWRfc3ltbGlua2F0LApkaWZmIC0tZ2l0IGEvc291cmNlMy9tb2R1bGVz
L3Zmc190aW1lX2F1ZGl0LmMgYi9zb3VyY2UzL21vZHVsZXMvdmZzX3RpbWVfYXVkaXQuYwppbmRl
eCAyMTNlYTEwYjE3Zi4uN2ZhNjE2MTk0NWEgMTAwNjQ0Ci0tLSBhL3NvdXJjZTMvbW9kdWxlcy92
ZnNfdGltZV9hdWRpdC5jCisrKyBiL3NvdXJjZTMvbW9kdWxlcy92ZnNfdGltZV9hdWRpdC5jCkBA
IC0xMzQ0LDYgKzEzNDQsMzEgQEAgc3RhdGljIGludCBzbWJfdGltZV9hdWRpdF9rZXJuZWxfZmxv
Y2soc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJcmV0dXJuIHJlc3VsdDsKIH0K
IAorc3RhdGljIGludCBzbWJfdGltZV9hdWRpdF9mY250bChzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1
Y3QgKmhhbmRsZSwKKwkJCQlzdHJ1Y3QgZmlsZXNfc3RydWN0ICpmc3AsCisJCQkJaW50IGNtZCwg
dmFfbGlzdCBjbWRfYXJnKQoreworCXZvaWQgKmFyZzsKKwl2YV9saXN0IGR1cF9jbWRfYXJnOwor
CWludCByZXN1bHQ7CisJc3RydWN0IHRpbWVzcGVjIHRzMSx0czI7CisJZG91YmxlIHRpbWVkaWZm
OworCisJdmFfY29weShkdXBfY21kX2FyZywgY21kX2FyZyk7CisJYXJnID0gdmFfYXJnKGR1cF9j
bWRfYXJnLCB2b2lkICopOworCWNsb2NrX2dldHRpbWVfbW9ubygmdHMxKTsKKwlyZXN1bHQgPSBT
TUJfVkZTX05FWFRfRkNOVEwoaGFuZGxlLCBmc3AsIGNtZCwgYXJnKTsKKwljbG9ja19nZXR0aW1l
X21vbm8oJnRzMik7CisJdmFfZW5kKGR1cF9jbWRfYXJnKTsKKworCXRpbWVkaWZmID0gbnNlY190
aW1lX2RpZmYoJnRzMiwmdHMxKSoxLjBlLTk7CisJaWYgKHRpbWVkaWZmID4gYXVkaXRfdGltZW91
dCkgeworCQlzbWJfdGltZV9hdWRpdF9sb2dfZnNwKCJrZXJuZWxfZmxvY2siLCB0aW1lZGlmZiwg
ZnNwKTsKKwl9CisKKwlyZXR1cm4gcmVzdWx0OworfQorCiBzdGF0aWMgaW50IHNtYl90aW1lX2F1
ZGl0X2xpbnV4X3NldGxlYXNlKHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJCQkJCSBmaWxl
c19zdHJ1Y3QgKmZzcCwKIAkJCQkJIGludCBsZWFzZXR5cGUpCkBAIC0yODY2LDYgKzI4OTEsNyBA
QCBzdGF0aWMgc3RydWN0IHZmc19mbl9wb2ludGVycyB2ZnNfdGltZV9hdWRpdF9mbnMgPSB7CiAJ
LmZhbGxvY2F0ZV9mbiA9IHNtYl90aW1lX2F1ZGl0X2ZhbGxvY2F0ZSwKIAkubG9ja19mbiA9IHNt
Yl90aW1lX2F1ZGl0X2xvY2ssCiAJLmtlcm5lbF9mbG9ja19mbiA9IHNtYl90aW1lX2F1ZGl0X2tl
cm5lbF9mbG9jaywKKwkuZmNudGxfZm4gPSBzbWJfdGltZV9hdWRpdF9mY250bCwKIAkubGludXhf
c2V0bGVhc2VfZm4gPSBzbWJfdGltZV9hdWRpdF9saW51eF9zZXRsZWFzZSwKIAkuZ2V0bG9ja19m
biA9IHNtYl90aW1lX2F1ZGl0X2dldGxvY2ssCiAJLnN5bWxpbmthdF9mbiA9IHNtYl90aW1lX2F1
ZGl0X3N5bWxpbmthdCwKZGlmZiAtLWdpdCBhL3NvdXJjZTMvc21iZC92ZnMuYyBiL3NvdXJjZTMv
c21iZC92ZnMuYwppbmRleCBiODNjZjFlNGQ1NS4uYmVmNzllNGM2NGUgMTAwNjQ0Ci0tLSBhL3Nv
dXJjZTMvc21iZC92ZnMuYworKysgYi9zb3VyY2UzL3NtYmQvdmZzLmMKQEAgLTIxOTUsNiArMjE5
NSwyMSBAQCBpbnQgc21iX3Zmc19jYWxsX2tlcm5lbF9mbG9jayhzdHJ1Y3QgdmZzX2hhbmRsZV9z
dHJ1Y3QgKmhhbmRsZSwKIAkJCQkJIGFjY2Vzc19tYXNrKTsKIH0KIAoraW50IHNtYl92ZnNfY2Fs
bF9mY250bChzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKKwkJICAgICAgIHN0cnVj
dCBmaWxlc19zdHJ1Y3QgKmZzcCwgaW50IGNtZCwgLi4uKQoreworCWludCByZXN1bHQ7CisJdmFf
bGlzdCBjbWRfYXJnOworCisJVkZTX0ZJTkQoZmNudGwpOworCisJdmFfc3RhcnQoY21kX2FyZywg
Y21kKTsKKwlyZXN1bHQgPSBoYW5kbGUtPmZucy0+ZmNudGxfZm4oaGFuZGxlLCBmc3AsIGNtZCwg
Y21kX2FyZyk7CisJdmFfZW5kKGNtZF9hcmcpOworCisJcmV0dXJuIHJlc3VsdDsKK30KKwogaW50
IHNtYl92ZnNfY2FsbF9saW51eF9zZXRsZWFzZShzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhh
bmRsZSwKIAkJCQlzdHJ1Y3QgZmlsZXNfc3RydWN0ICpmc3AsIGludCBsZWFzZXR5cGUpCiB7CmRp
ZmYgLS1naXQgYS9zb3VyY2UzL3dzY3JpcHQgYi9zb3VyY2UzL3dzY3JpcHQKaW5kZXggZDQ1MjIy
NjI1YzQuLmUyOWJmNjU3YjVlIDEwMDY0NAotLS0gYS9zb3VyY2UzL3dzY3JpcHQKKysrIGIvc291
cmNlMy93c2NyaXB0CkBAIC0xMTE5LDYgKzExMTksMTE1IEBAIGVycjoKICAgICAgICAgICAgIGV4
ZWN1dGU9VHJ1ZSwKICAgICAgICAgICAgIG1zZz0iQ2hlY2tpbmcgd2hldGhlciBmY250bCBsb2Nr
IHN1cHBvcnRzIG9wZW4gZmlsZSBkZXNjcmlwdGlvbiBsb2NrcyIpCiAKKyAgICBjb25mLkNIRUNL
X0NPREUoJycnCisjaW5jbHVkZSA8ZmNudGwuaD4KKyNpbmNsdWRlIDx1bmlzdGQuaD4KKyNpbmNs
dWRlIDxzdGRsaWIuaD4KKyNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+CisKK2ludCBtYWluKHZvaWQp
Cit7CisgICAgICAgIGludCBzb2NrZmQsIHJldDsKKyAgICAgICAgc3RydWN0IGZfb3duZXJfZXgg
b3duZXIsIGdldF9vd25lcjsKKworICAgICAgICBzb2NrZmQgPSBzb2NrZXQoQUZfVU5JWCwgU09D
S19TVFJFQU0sIDApOworICAgICAgICBpZiAoc29ja2ZkID09IC0xKSB7CisgICAgICAgICAgICBn
b3RvIGVycjsKKyAgICAgICAgfQorCisgICAgICAgIG93bmVyLnR5cGUgPSBGX09XTkVSX1BJRDsK
KyAgICAgICAgb3duZXIucGlkID0gZ2V0cGlkKCk7CisKKyAgICAgICAgcmV0ID0gZmNudGwoc29j
a2ZkLCBGX1NFVE9XTl9FWCwgJm93bmVyKTsKKyAgICAgICAgaWYgKHJldCA9PSAtMSkgeworICAg
ICAgICAgICAgZ290byBlcnI7CisgICAgICAgIH0KKworICAgICAgICByZXQgPSBmY250bChzb2Nr
ZmQsIEZfR0VUT1dOX0VYLCAmZ2V0X293bmVyKTsKKyAgICAgICAgaWYgKHJldCA9PSAtMSkgewor
ICAgICAgICAgICAgZ290byBlcnI7CisgICAgICAgIH0KKworICAgICAgICBpZiAoZ2V0X293bmVy
LnR5cGUgIT0gRl9PV05FUl9QSUQpIHsKKyAgICAgICAgICAgIGdvdG8gZXJyOworICAgICAgICB9
CisKKyAgICAgICAgaWYgKGdldF9vd25lci5waWQgIT0gZ2V0cGlkKCkpIHsKKyAgICAgICAgICAg
IGdvdG8gZXJyOworICAgICAgICB9CisKKyAgICAgICAgY2xvc2Uoc29ja2ZkKTsKKyAgICAgICAg
ZXhpdCgwKTsKK2VycjoKKyAgICAgICAgY2xvc2Uoc29ja2ZkKTsKKyAgICAgICAgZXhpdCgxKTsK
K30nJycsCisgICAgICAgICAgICAnSEFWRV9GX09XTkVSX0VYJywKKyAgICAgICAgICAgIGFkZG1h
aW49RmFsc2UsCisgICAgICAgICAgICBleGVjdXRlPVRydWUsCisgICAgICAgICAgICBtc2c9IkNo
ZWNraW5nIHdoZXRoZXIgZmNudGwgc3VwcG9ydHMgZmxhZ3MgdG8gc2VuZCBkaXJlY3QgSS9PIGF2
YWlsYWJpbGl0eSBzaWduYWxzIikKKworICAgIGNvbmYuQ0hFQ0tfQ09ERSgnJycKKyNpbmNsdWRl
IDxmY250bC5oPgorI2luY2x1ZGUgPHVuaXN0ZC5oPgorI2luY2x1ZGUgPHN0ZGxpYi5oPgorI2lu
Y2x1ZGUgPHN0ZGludC5oPgorCisjZGVmaW5lIERBVEEgImhpbnR0ZXN0LmZjbnRsIgorCitpbnQg
bWFpbih2b2lkKQoreworICAgICAgICB1aW50NjRfdCAqaGludCwgZ2V0X2hpbnQ7CisgICAgICAg
IGludCBmZDsKKworICAgICAgICBmZCA9IG9wZW4oREFUQSwgT19SRE9OTFkgfCBPX0NSRUFUIHwg
T19FWENMKTsKKyAgICAgICAgaWYgKGZkID09IC0xKSB7CisgICAgICAgICAgICBnb3RvIGVycjsK
KyAgICAgICAgfQorCisgICAgICAgICpoaW50ID0gUldIX1dSSVRFX0xJRkVfU0hPUlQ7CisgICAg
ICAgIGludCByZXQgPSBmY250bChmZCwgRl9TRVRfUldfSElOVCwgaGludCk7CisgICAgICAgIGlm
IChyZXQgPT0gLTEpIHsKKyAgICAgICAgICAgIGdvdG8gZXJyOworICAgICAgICB9CisKKyAgICAg
ICAgcmV0ID0gZmNudGwoZmQsIEZfR0VUX1JXX0hJTlQsICZnZXRfaGludCk7CisgICAgICAgIGlm
IChyZXQgPT0gLTEpIHsKKyAgICAgICAgICAgIGdvdG8gZXJyOworICAgICAgICB9CisKKyAgICAg
ICAgaWYgKGdldF9oaW50ICE9IFJXSF9XUklURV9MSUZFX1NIT1JUKSB7CisgICAgICAgICAgICBn
b3RvIGVycjsKKyAgICAgICAgfQorCisgICAgICAgICpoaW50ID0gUldIX1dSSVRFX0xJRkVfRVhU
UkVNRTsKKyAgICAgICAgcmV0ID0gZmNudGwoZmQsIEZfU0VUX0ZJTEVfUldfSElOVCwgaGludCk7
CisgICAgICAgIGlmIChyZXQgPT0gLTEpIHsKKyAgICAgICAgICAgIGdvdG8gZXJyOworICAgICAg
ICB9CisKKyAgICAgICAgcmV0ID0gZmNudGwoZmQsIEZfR0VUX0ZJTEVfUldfSElOVCwgJmdldF9o
aW50KTsKKyAgICAgICAgaWYgKHJldCA9PSAtMSkgeworICAgICAgICAgICAgZ290byBlcnI7Cisg
ICAgICAgIH0KKworICAgICAgICBpZiAoZ2V0X2hpbnQgIT0gUldIX1dSSVRFX0xJRkVfRVhUUkVN
RSkgeworICAgICAgICAgICAgZ290byBlcnI7CisgICAgICAgIH0KKworICAgICAgICBjbG9zZShm
ZCk7CisgICAgICAgIHVubGluayhEQVRBKTsKKyAgICAgICAgZXhpdCgwKTsKK2VycjoKKyAgICAg
ICAgY2xvc2UoZmQpOworICAgICAgICB1bmxpbmsoREFUQSk7CisgICAgICAgIGV4aXQoMSk7Cit9
JycnLAorICAgICAgICAgICAgJ0hBVkVfUldfSElOVFMnLAorICAgICAgICAgICAgYWRkbWFpbj1G
YWxzZSwKKyAgICAgICAgICAgIGV4ZWN1dGU9VHJ1ZSwKKyAgICAgICAgICAgIG1zZz0iQ2hlY2tp
bmcgd2hldGhlciBmY250bCBzdXBwb3J0cyBzZXR0aW5nL2dldGluZyBoaW50cyIpCisKICAgICBj
b25mLkNIRUNLX1NUUlVDVFVSRV9NRU1CRVIoJ3N0cnVjdCBzdGF0JywgJ3N0X210aW0udHZfbnNl
YycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluZT0nSEFWRV9TVFJVQ1Rf
U1RBVF9TVF9NVElNX1RWX05TRUMnKSAjIExpbnV4LCBTb2xhcmlzCiAgICAgY29uZi5DSEVDS19T
VFJVQ1RVUkVfTUVNQkVSKCdzdHJ1Y3Qgc3RhdCcsICdzdF9tdGltZW5zZWMnLAotLSAKMi4yMS4w
Cgo=


--=-DD+aQEOCanZQ1RZ89T4q
Content-Disposition: attachment;
	filename*0=0002-s3-VFS-Use-SMB_VFS_FCNTL-to-set-fd-flags-in-open_fil.pat;
	filename*1=ch
Content-Transfer-Encoding: base64
Content-Type: text/x-patch;
	name="0002-s3-VFS-Use-SMB_VFS_FCNTL-to-set-fd-flags-in-open_fil.patch";
	charset="UTF-8"

RnJvbSA4ZTRjNGM3MTA0Y2QzYzMwMjBjNTVkMmRlODhmMjZmNjQ3ZmZiZDk2IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBBbm9vcCBDIFMgPGFub29wY3NAcmVkaGF0LmNvbT4KRGF0ZTog
RnJpLCAyNyBTZXAgMjAxOSAxMjowNzo0MCArMDUzMApTdWJqZWN0OiBbUEFUQ0ggMi8yXSBzMzog
VkZTOiBVc2UgU01CX1ZGU19GQ05UTCB0byBzZXQgZmQgZmxhZ3MgaW4gb3Blbl9maWxlKCkKClNp
Z25lZC1vZmYtYnk6IEFub29wIEMgUyA8YW5vb3Bjc0ByZWRoYXQuY29tPgotLS0KIHNvdXJjZTMv
c21iZC9vcGVuLmMgIHwgIDIgKy0KIHNvdXJjZTMvc21iZC9wcm90by5oIHwgIDEgKwogc291cmNl
My9zbWJkL3Zmcy5jICAgfCAzMCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDMgZmls
ZXMgY2hhbmdlZCwgMzIgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBh
L3NvdXJjZTMvc21iZC9vcGVuLmMgYi9zb3VyY2UzL3NtYmQvb3Blbi5jCmluZGV4IDU4NjAxNTUy
NjNiLi45NDkzMDIxYzQ4ZCAxMDA2NDQKLS0tIGEvc291cmNlMy9zbWJkL29wZW4uYworKysgYi9z
b3VyY2UzL3NtYmQvb3Blbi5jCkBAIC0xMzI3LDcgKzEzMjcsNyBAQCBzdGF0aWMgTlRTVEFUVVMg
b3Blbl9maWxlKGZpbGVzX3N0cnVjdCAqZnNwLAogCQkJICogdG9vLiBXaXRoIGJsb2NraW5nIGZp
bGUgZGVzY3JpcHRvcnMgdGhpcwogCQkJICogZG9lcyBub3QgaGFwcGVuLgogCQkJICovCi0JCQly
ZXQgPSBzZXRfYmxvY2tpbmcoZnNwLT5maC0+ZmQsIHRydWUpOworCQkJcmV0ID0gdmZzX3NldF9i
bG9ja2luZyhmc3AsIHRydWUpOwogCQkJaWYgKHJldCA9PSAtMSkgewogCQkJCXN0YXR1cyA9IG1h
cF9udF9lcnJvcl9mcm9tX3VuaXgoZXJybm8pOwogCQkJCURCR19XQVJOSU5HKCJDb3VsZCBub3Qg
c2V0IGZkIHRvIGJsb2NraW5nOiAiCmRpZmYgLS1naXQgYS9zb3VyY2UzL3NtYmQvcHJvdG8uaCBi
L3NvdXJjZTMvc21iZC9wcm90by5oCmluZGV4IDExYzlkYzBmOGIxLi5lOWQwNDQ3NGRmNiAxMDA2
NDQKLS0tIGEvc291cmNlMy9zbWJkL3Byb3RvLmgKKysrIGIvc291cmNlMy9zbWJkL3Byb3RvLmgK
QEAgLTEyMzAsNiArMTIzMCw3IEBAIGludCB2ZnNfYWxsb2NhdGVfZmlsZV9zcGFjZShmaWxlc19z
dHJ1Y3QgKmZzcCwgdWludDY0X3QgbGVuKTsKIGludCB2ZnNfc2V0X2ZpbGVsZW4oZmlsZXNfc3Ry
dWN0ICpmc3AsIG9mZl90IGxlbik7CiBpbnQgdmZzX3Nsb3dfZmFsbG9jYXRlKGZpbGVzX3N0cnVj
dCAqZnNwLCBvZmZfdCBvZmZzZXQsIG9mZl90IGxlbik7CiBpbnQgdmZzX2ZpbGxfc3BhcnNlKGZp
bGVzX3N0cnVjdCAqZnNwLCBvZmZfdCBsZW4pOworaW50IHZmc19zZXRfYmxvY2tpbmcoZmlsZXNf
c3RydWN0ICpmc3AsIGJvb2wgc2V0KTsKIG9mZl90IHZmc190cmFuc2Zlcl9maWxlKGZpbGVzX3N0
cnVjdCAqaW4sIGZpbGVzX3N0cnVjdCAqb3V0LCBvZmZfdCBuKTsKIGNvbnN0IGNoYXIgKnZmc19y
ZWFkZGlybmFtZShjb25uZWN0aW9uX3N0cnVjdCAqY29ubiwgdm9pZCAqcCwKIAkJCSAgICBTTUJf
U1RSVUNUX1NUQVQgKnNidWYsIGNoYXIgKip0YWxsb2NlZCk7CmRpZmYgLS1naXQgYS9zb3VyY2Uz
L3NtYmQvdmZzLmMgYi9zb3VyY2UzL3NtYmQvdmZzLmMKaW5kZXggYmVmNzllNGM2NGUuLmNkNmQw
ZjI1YzA0IDEwMDY0NAotLS0gYS9zb3VyY2UzL3NtYmQvdmZzLmMKKysrIGIvc291cmNlMy9zbWJk
L3Zmcy5jCkBAIC03MTEsNiArNzExLDM2IEBAIGludCB2ZnNfZmlsbF9zcGFyc2UoZmlsZXNfc3Ry
dWN0ICpmc3AsIG9mZl90IGxlbikKIAlyZXR1cm4gcmV0OwogfQogCisvKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKgorIFNldCBhIGZkIGludG8gYmxvY2tpbmcvbm9uYmxvY2tpbmcgbW9kZSB0aHJvdWdo
IFZGUworKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KKworaW50IHZmc19zZXRfYmxvY2tpbmcoZmls
ZXNfc3RydWN0ICpmc3AsIGJvb2wgc2V0KQoreworCWludCB2YWw7CisjaWZkZWYgT19OT05CTE9D
SworI2RlZmluZSBGTEFHX1RPX1NFVCBPX05PTkJMT0NLCisjZWxzZQorI2lmZGVmIFNZU1YKKyNk
ZWZpbmUgRkxBR19UT19TRVQgT19OREVMQVkKKyNlbHNlIC8qIEJTRCAqLworI2RlZmluZSBGTEFH
X1RPX1NFVCBGTkRFTEFZCisjZW5kaWYKKyNlbmRpZgorCWlmICgodmFsID0gU01CX1ZGU19GQ05U
TChmc3AsIEZfR0VURkwsIDApKSA9PSAtMSkgeworCQlyZXR1cm4gLTE7CisJfQorCisJaWYgKHNl
dCkgeworCQl2YWwgJj0gfkZMQUdfVE9fU0VUOworCX0gZWxzZSB7CisJCXZhbCB8PSBGTEFHX1RP
X1NFVDsKKwl9CisKKwlyZXR1cm4gU01CX1ZGU19GQ05UTChmc3AsIEZfU0VURkwsIHZhbCk7Cisj
dW5kZWYgRkxBR19UT19TRVQKK30KKwogLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICBUcmFuc2ZlciBz
b21lIGRhdGEgKG4gYnl0ZXMpIGJldHdlZW4gdHdvIGZpbGVfc3RydWN0J3MuCiAqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqLwotLSAKMi4yMS4wCgo=


--=-DD+aQEOCanZQ1RZ89T4q--


