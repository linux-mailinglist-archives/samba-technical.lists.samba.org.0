Return-Path: <samba-technical-bounces@lists.samba.org>
X-Original-To: lists+samba-technical@lfdr.de
Delivered-To: lists+samba-technical@lfdr.de
Received: from hr1.samba.org (hr1.samba.org [IPv6:2a01:4f8:192:486::1:0])
	by mail.lfdr.de (Postfix) with ESMTPS id 794CC962F9
	for <lists+samba-technical@lfdr.de>; Tue, 20 Aug 2019 16:49:43 +0200 (CEST)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.samba.org; s=2954282; h=Cc:From:List-Id:Date:To:Subject;
	bh=s8rZ6ZNAtoC4M5wRosB1HwsUHKRzM/jP9FLleDwmNtI=; b=Ti7nfXU3Io/7Uy2YV8Ys/QhQY9
	tSN3FYiCli8kUuZsGBTIGAV5z2KixSz1uPP2yixXbSlLvFxJed/zxh2OfX+OaMjvToT1a8H2FuLvf
	VxV5s5a+roTeVsgHUr2PQgk2jgPX6ns9qhMk8+6s6APU7f4N1OC66kHobkBdz9rytgKCmSosfEUQl
	Dieyfl2Xzlg99T+cP6bOnnoMdHifqQfI/Jnn70h3RAzv5IEqPkb0pYeGXGdIyPU3EuQWfbCrZXcOM
	VdY+tZAYtwXhTa90TswxOynBNb/2X+jxo7WAlYwWfe7pBN5NGLvbuKjdxLPyl9+HN7O/kiyoBNih2
	eSLZJAUA==;
Received: from localhost ([::1]:18114 helo=hr1.samba.org) 
	by hr1.samba.org with esmtp (Exim)
	id 1i05RH-007FWO-4P; Tue, 20 Aug 2019 14:48:47 +0000
Received: from hr2.samba.org ([2a01:4f8:192:486::2:0]:14684) 
 by hr1.samba.org with esmtps (TLS1.3:ECDHE_RSA_CHACHA20_POLY1305:256)
 (Exim) id 1i05RA-007FWH-Iv
 for samba-technical@lists.samba.org; Tue, 20 Aug 2019 14:48:43 +0000
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=samba.org; 
 s=42627210; h=Date:Message-ID:From:Cc:To;
 bh=s8rZ6ZNAtoC4M5wRosB1HwsUHKRzM/jP9FLleDwmNtI=; b=XyIuOk8EwVhpky+n2iZ/Ue7iOc
 jB2kF14+zwHlsstuuWQvvjCIeYtoXXT1osV9Dt3cAY1sdlGiphzOLexgy9hEFnqIsOwEjZ389hURV
 ATw4oiBn+kbRLjX1A/QjkgspUbmmjur4Mppc8/KUlD4umTHf+H8SPIrtygdVw5kI/ViA=;
Received: from [127.0.0.2] (localhost [127.0.0.1])
 by hr2.samba.org with esmtpsa (TLS1.3:ECDHE_RSA_CHACHA20_POLY1305:256)
 (Exim) id 1i05R8-0007dk-LC; Tue, 20 Aug 2019 14:48:39 +0000
Subject: Re: [PATCH] Add profiling to vfs_glusterfs
To: Anoop C S <anoopcs@cryptolab.net>,
 samba-technical <samba-technical@lists.samba.org>
References: <8d9bfc615b93514eeb14f9f5c028ee54f05b37d0.camel@cryptolab.net>
 <157d477c-295f-985b-eadd-06b8df3abaa4@samba.org>
Openpgp: preference=signencrypt
Message-ID: <b706dbd2-391d-9e5f-ee62-84d0db01ed64@samba.org>
Date: Tue, 20 Aug 2019 16:48:21 +0200
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <157d477c-295f-985b-eadd-06b8df3abaa4@samba.org>
Content-Type: multipart/signed; micalg=pgp-sha1;
 protocol="application/pgp-signature";
 boundary="AdJPenlYwppZzpSn4ZWuoTFD7CEeGA2KJ"
X-BeenThere: samba-technical@lists.samba.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Discussions on Samba internals. For general questions please
 subscribe to the list samba@lists.samba.org"
 <samba-technical.lists.samba.org>
List-Unsubscribe: <https://lists.samba.org/mailman/options/samba-technical>,
 <mailto:samba-technical-request@lists.samba.org?subject=unsubscribe>
List-Archive: <http://lists.samba.org/pipermail/samba-technical/>
List-Post: <mailto:samba-technical@lists.samba.org>
List-Help: <mailto:samba-technical-request@lists.samba.org?subject=help>
List-Subscribe: <https://lists.samba.org/mailman/listinfo/samba-technical>,
 <mailto:samba-technical-request@lists.samba.org?subject=subscribe>
From: =?utf-8?q?G=C3=BCnther_Deschner_via_samba-technical?=
 <samba-technical@lists.samba.org>
Reply-To: =?UTF-8?Q?G=c3=bcnther_Deschner?= <gd@samba.org>
Cc: obnox@samba.org
Errors-To: samba-technical-bounces@lists.samba.org
Sender: "samba-technical" <samba-technical-bounces@lists.samba.org>

This is an OpenPGP/MIME signed message (RFC 4880 and 3156)
--AdJPenlYwppZzpSn4ZWuoTFD7CEeGA2KJ
Content-Type: multipart/mixed; boundary="oVywm7vWdnarlWkBV5Fm3Sx2suqFXZSBX";
 protected-headers="v1"
From: =?UTF-8?Q?G=c3=bcnther_Deschner?= <gd@samba.org>
To: Anoop C S <anoopcs@cryptolab.net>,
 samba-technical <samba-technical@lists.samba.org>
Cc: obnox@samba.org
Message-ID: <b706dbd2-391d-9e5f-ee62-84d0db01ed64@samba.org>
Subject: Re: [PATCH] Add profiling to vfs_glusterfs
References: <8d9bfc615b93514eeb14f9f5c028ee54f05b37d0.camel@cryptolab.net>
 <157d477c-295f-985b-eadd-06b8df3abaa4@samba.org>
In-Reply-To: <157d477c-295f-985b-eadd-06b8df3abaa4@samba.org>

--oVywm7vWdnarlWkBV5Fm3Sx2suqFXZSBX
Content-Type: multipart/mixed;
 boundary="------------3CDBF428F9F78991563D640E"
Content-Language: en-US

This is a multi-part message in MIME format.
--------------3CDBF428F9F78991563D640E
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

Attached a new version of that patch, slightly modified and BZ added.
A 2nd review anyone?

Thanks,
Guenther

On 19/08/2019 15:04, G=C3=BCnther Deschner via samba-technical wrote:
> Thanks, Anoop,
>=20
> please add my RB+, I also created a bug
> https://bugzilla.samba.org/show_bug.cgi?id=3D14093 so we can track the
> backports for the upcoming releases.
>=20
> Another RB+ anyone please?
>=20
> Thanks,
> Guenther
>=20
>=20
> On 19/08/2019 14:19, Anoop C S wrote:
>> Hi,
>>
>> Please find the attached patch to retrieve profiling metrics from
>> vfs_glusterfs.
>>
>> Reviews are appreciated.
>>
>> -Anoop C S
>>
>=20
>=20


--=20
G=C3=BCnther Deschner                    GPG-ID: 8EE11688
Red Hat                         gdeschner@redhat.com
Samba Team                              gd@samba.org

--------------3CDBF428F9F78991563D640E
Content-Type: text/plain; charset=UTF-8;
 name="patch"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="patch"

RnJvbSAxYzE3YTY4YmRkNDlhNmYwOWY3MjhmODlkMzUzYTEyYTdkMzE2MzRiIE1vbiBTZXAg
MTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBBbm9vcCBDIFMgPGFub29wY3NAcmVkaGF0LmNvbT4K
RGF0ZTogTW9uLCA1IEF1ZyAyMDE5IDEwOjQ1OjAxICswNTMwClN1YmplY3Q6IFtQQVRDSF0g
dmZzX2dsdXN0ZXJmczogRW5hYmxlIHByb2ZpbGluZyBmb3IgZmlsZSBzeXN0ZW0gb3BlcmF0
aW9ucwoKQlVHOiBodHRwczovL2J1Z3ppbGxhLnNhbWJhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9
MTQwOTMKClNpZ25lZC1vZmYtYnk6IEFub29wIEMgUyA8YW5vb3Bjc0ByZWRoYXQuY29tPgpS
ZXZpZXdlZC1ieTogR3VlbnRoZXIgRGVzY2huZXIgPGdkQHNhbWJhLm9yZz4KLS0tCiBzb3Vy
Y2UzL21vZHVsZXMvdmZzX2dsdXN0ZXJmcy5jIHwgMzM5ICsrKysrKysrKysrKysrKysrKysr
KysrKysrKy0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMjkwIGluc2VydGlvbnMoKyksIDQ5IGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3NvdXJjZTMvbW9kdWxlcy92ZnNfZ2x1c3RlcmZz
LmMgYi9zb3VyY2UzL21vZHVsZXMvdmZzX2dsdXN0ZXJmcy5jCmluZGV4IDlhOGUzMmM4ZmE5
Li43NzMwNTI3MjA5YSAxMDA2NDQKLS0tIGEvc291cmNlMy9tb2R1bGVzL3Zmc19nbHVzdGVy
ZnMuYworKysgYi9zb3VyY2UzL21vZHVsZXMvdmZzX2dsdXN0ZXJmcy5jCkBAIC00OTIsMTIg
KzQ5MiwxNiBAQCBzdGF0aWMgRElSICp2ZnNfZ2x1c3Rlcl9vcGVuZGlyKHN0cnVjdCB2ZnNf
aGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogewogCWdsZnNfZmRfdCAqZmQ7CiAKKwlTVEFSVF9Q
Uk9GSUxFKHN5c2NhbGxfb3BlbmRpcik7CisKIAlmZCA9IGdsZnNfb3BlbmRpcihoYW5kbGUt
PmRhdGEsIHNtYl9mbmFtZS0+YmFzZV9uYW1lKTsKIAlpZiAoZmQgPT0gTlVMTCkgewogCQlE
RUJVRygwLCAoImdsZnNfb3BlbmRpciglcykgZmFpbGVkOiAlc1xuIiwKIAkJCSAgc21iX2Zu
YW1lLT5iYXNlX25hbWUsIHN0cmVycm9yKGVycm5vKSkpOwogCX0KIAorCUVORF9QUk9GSUxF
KHN5c2NhbGxfb3BlbmRpcik7CisKIAlyZXR1cm4gKERJUiAqKSBmZDsKIH0KIApAQCAtNTMy
LDcgKzUzNiwxMyBAQCBzdGF0aWMgRElSICp2ZnNfZ2x1c3Rlcl9mZG9wZW5kaXIoc3RydWN0
IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAKIHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJf
Y2xvc2VkaXIoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsIERJUiAqZGlycCkK
IHsKLQlyZXR1cm4gZ2xmc19jbG9zZWRpcigodm9pZCAqKWRpcnApOworCWludCByZXQ7CisK
KwlTVEFSVF9QUk9GSUxFKHN5c2NhbGxfY2xvc2VkaXIpOworCXJldCA9IGdsZnNfY2xvc2Vk
aXIoKHZvaWQgKilkaXJwKTsKKwlFTkRfUFJPRklMRShzeXNjYWxsX2Nsb3NlZGlyKTsKKwor
CXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZGlyZW50ICp2ZnNfZ2x1c3Rlcl9y
ZWFkZGlyKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLApAQCAtNTQzLDYgKzU1
Myw3IEBAIHN0YXRpYyBzdHJ1Y3QgZGlyZW50ICp2ZnNfZ2x1c3Rlcl9yZWFkZGlyKHN0cnVj
dCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCXN0cnVjdCBzdGF0IHN0YXQ7CiAJc3Ry
dWN0IGRpcmVudCAqZGlyZW50ID0gMDsKIAorCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9yZWFk
ZGlyKTsKIAlpZiAoc2J1ZiAhPSBOVUxMKSB7CiAJCXJldCA9IGdsZnNfcmVhZGRpcnBsdXNf
cigodm9pZCAqKWRpcnAsICZzdGF0LCAodm9pZCAqKWRpcmVudGJ1ZiwKIAkJCQkJICZkaXJl
bnQpOwpAQCAtNTUxLDYgKzU2Miw3IEBAIHN0YXRpYyBzdHJ1Y3QgZGlyZW50ICp2ZnNfZ2x1
c3Rlcl9yZWFkZGlyKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCX0KIAog
CWlmICgocmV0IDwgMCkgfHwgKGRpcmVudCA9PSBOVUxMKSkgeworCQlFTkRfUFJPRklMRShz
eXNjYWxsX3JlYWRkaXIpOwogCQlyZXR1cm4gTlVMTDsKIAl9CiAKQEAgLTU1OCwzNiArNTcw
LDU5IEBAIHN0YXRpYyBzdHJ1Y3QgZGlyZW50ICp2ZnNfZ2x1c3Rlcl9yZWFkZGlyKHN0cnVj
dCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQlzbWJfc3RhdF9leF9mcm9tX3N0YXQo
c2J1ZiwgJnN0YXQpOwogCX0KIAorCUVORF9QUk9GSUxFKHN5c2NhbGxfcmVhZGRpcik7CiAJ
cmV0dXJuIGRpcmVudDsKIH0KIAogc3RhdGljIGxvbmcgdmZzX2dsdXN0ZXJfdGVsbGRpcihz
dHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwgRElSICpkaXJwKQogewotCXJldHVy
biBnbGZzX3RlbGxkaXIoKHZvaWQgKilkaXJwKTsKKwlsb25nIHJldDsKKworCVNUQVJUX1BS
T0ZJTEUoc3lzY2FsbF90ZWxsZGlyKTsKKwlyZXQgPSBnbGZzX3RlbGxkaXIoKHZvaWQgKilk
aXJwKTsKKwlFTkRfUFJPRklMRShzeXNjYWxsX3RlbGxkaXIpOworCisJcmV0dXJuIHJldDsK
IH0KIAogc3RhdGljIHZvaWQgdmZzX2dsdXN0ZXJfc2Vla2RpcihzdHJ1Y3QgdmZzX2hhbmRs
ZV9zdHJ1Y3QgKmhhbmRsZSwgRElSICpkaXJwLAogCQkJCWxvbmcgb2Zmc2V0KQogeworCVNU
QVJUX1BST0ZJTEUoc3lzY2FsbF9zZWVrZGlyKTsKIAlnbGZzX3NlZWtkaXIoKHZvaWQgKilk
aXJwLCBvZmZzZXQpOworCUVORF9QUk9GSUxFKHN5c2NhbGxfc2Vla2Rpcik7CiB9CiAKIHN0
YXRpYyB2b2lkIHZmc19nbHVzdGVyX3Jld2luZGRpcihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1
Y3QgKmhhbmRsZSwgRElSICpkaXJwKQogeworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9yZXdp
bmRkaXIpOwogCWdsZnNfc2Vla2Rpcigodm9pZCAqKWRpcnAsIDApOworCUVORF9QUk9GSUxF
KHN5c2NhbGxfcmV3aW5kZGlyKTsKIH0KIAogc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9ta2Rp
cihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCSAgICAgY29uc3Qgc3Ry
dWN0IHNtYl9maWxlbmFtZSAqc21iX2ZuYW1lLAogCQkJICAgICBtb2RlX3QgbW9kZSkKIHsK
LQlyZXR1cm4gZ2xmc19ta2RpcihoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFzZV9uYW1l
LCBtb2RlKTsKKwlpbnQgcmV0OworCisJU1RBUlRfUFJPRklMRShzeXNjYWxsX21rZGlyKTsK
KwlyZXQgPSBnbGZzX21rZGlyKGhhbmRsZS0+ZGF0YSwgc21iX2ZuYW1lLT5iYXNlX25hbWUs
IG1vZGUpOworCUVORF9QUk9GSUxFKHN5c2NhbGxfbWtkaXIpOworCisJcmV0dXJuIHJldDsK
IH0KIAogc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9ybWRpcihzdHJ1Y3QgdmZzX2hhbmRsZV9z
dHJ1Y3QgKmhhbmRsZSwKIAkJCWNvbnN0IHN0cnVjdCBzbWJfZmlsZW5hbWUgKnNtYl9mbmFt
ZSkKIHsKLQlyZXR1cm4gZ2xmc19ybWRpcihoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFz
ZV9uYW1lKTsKKwlpbnQgcmV0OworCisJU1RBUlRfUFJPRklMRShzeXNjYWxsX3JtZGlyKTsK
KwlyZXQgPSBnbGZzX3JtZGlyKGhhbmRsZS0+ZGF0YSwgc21iX2ZuYW1lLT5iYXNlX25hbWUp
OworCUVORF9QUk9GSUxFKHN5c2NhbGxfcm1kaXIpOworCisJcmV0dXJuIHJldDsKIH0KIAog
c3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9vcGVuKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAq
aGFuZGxlLApAQCAtNTk3LDggKzYzMiwxMSBAQCBzdGF0aWMgaW50IHZmc19nbHVzdGVyX29w
ZW4oc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJZ2xmc19mZF90ICpnbGZk
OwogCWdsZnNfZmRfdCAqKnBfdG1wOwogCisJU1RBUlRfUFJPRklMRShzeXNjYWxsX29wZW4p
OworCiAJcF90bXAgPSBWRlNfQUREX0ZTUF9FWFRFTlNJT04oaGFuZGxlLCBmc3AsIGdsZnNf
ZmRfdCAqLCBOVUxMKTsKIAlpZiAocF90bXAgPT0gTlVMTCkgeworCQlFTkRfUFJPRklMRShz
eXNjYWxsX29wZW4pOwogCQllcnJubyA9IEVOT01FTTsKIAkJcmV0dXJuIC0xOwogCX0KQEAg
LTYxMywxMiArNjUxLDE1IEBAIHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJfb3BlbihzdHJ1Y3Qg
dmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAl9CiAKIAlpZiAoZ2xmZCA9PSBOVUxMKSB7
CisJCUVORF9QUk9GSUxFKHN5c2NhbGxfb3Blbik7CiAJCS8qIG5vIGV4dGVuc2lvbiBkZXN0
cm95X2ZuLCBzbyBubyBuZWVkIHRvIHNhdmUgZXJybm8gKi8KIAkJVkZTX1JFTU9WRV9GU1Bf
RVhURU5TSU9OKGhhbmRsZSwgZnNwKTsKIAkJcmV0dXJuIC0xOwogCX0KIAogCSpwX3RtcCA9
IGdsZmQ7CisKKwlFTkRfUFJPRklMRShzeXNjYWxsX29wZW4pOwogCS8qIEFuIGFyYml0cmFy
eSB2YWx1ZSBmb3IgZXJyb3IgcmVwb3J0aW5nLCBzbyB5b3Uga25vdyBpdHMgdXMuICovCiAJ
cmV0dXJuIDEzMzcxMzM3OwogfQpAQCAtNjI2LDMxICs2NjcsNTAgQEAgc3RhdGljIGludCB2
ZnNfZ2x1c3Rlcl9vcGVuKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogc3Rh
dGljIGludCB2ZnNfZ2x1c3Rlcl9jbG9zZShzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhh
bmRsZSwKIAkJCSAgICAgZmlsZXNfc3RydWN0ICpmc3ApCiB7Ci0JZ2xmc19mZF90ICpnbGZk
ID0gdmZzX2dsdXN0ZXJfZmV0Y2hfZ2xmZChoYW5kbGUsIGZzcCk7CisJaW50IHJldDsKKwln
bGZzX2ZkX3QgKmdsZmQgPSBOVUxMOworCisJU1RBUlRfUFJPRklMRShzeXNjYWxsX2Nsb3Nl
KTsKKworCWdsZmQgPSB2ZnNfZ2x1c3Rlcl9mZXRjaF9nbGZkKGhhbmRsZSwgZnNwKTsKIAlp
ZiAoZ2xmZCA9PSBOVUxMKSB7CisJCUVORF9QUk9GSUxFKHN5c2NhbGxfY2xvc2UpOwogCQlE
QkdfRVJSKCJGYWlsZWQgdG8gZmV0Y2ggZ2x1c3RlciBmZFxuIik7CiAJCXJldHVybiAtMTsK
IAl9CiAKIAlWRlNfUkVNT1ZFX0ZTUF9FWFRFTlNJT04oaGFuZGxlLCBmc3ApOwotCXJldHVy
biBnbGZzX2Nsb3NlKGdsZmQpOworCisJcmV0ID0gZ2xmc19jbG9zZShnbGZkKTsKKwlFTkRf
UFJPRklMRShzeXNjYWxsX2Nsb3NlKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBz
c2l6ZV90IHZmc19nbHVzdGVyX3ByZWFkKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFu
ZGxlLAogCQkJCSBmaWxlc19zdHJ1Y3QgKmZzcCwgdm9pZCAqZGF0YSwgc2l6ZV90IG4sCiAJ
CQkJIG9mZl90IG9mZnNldCkKIHsKLQlnbGZzX2ZkX3QgKmdsZmQgPSB2ZnNfZ2x1c3Rlcl9m
ZXRjaF9nbGZkKGhhbmRsZSwgZnNwKTsKKwlzc2l6ZV90IHJldDsKKwlnbGZzX2ZkX3QgKmds
ZmQgPSBOVUxMOworCisJU1RBUlRfUFJPRklMRV9CWVRFUyhzeXNjYWxsX3ByZWFkLCBuKTsK
KworCWdsZmQgPSB2ZnNfZ2x1c3Rlcl9mZXRjaF9nbGZkKGhhbmRsZSwgZnNwKTsKIAlpZiAo
Z2xmZCA9PSBOVUxMKSB7CisJCUVORF9QUk9GSUxFX0JZVEVTKHN5c2NhbGxfcHJlYWQpOwog
CQlEQkdfRVJSKCJGYWlsZWQgdG8gZmV0Y2ggZ2x1c3RlciBmZFxuIik7CiAJCXJldHVybiAt
MTsKIAl9CiAKICNpZmRlZiBIQVZFX0dGQVBJX1ZFUl83XzYKLQlyZXR1cm4gZ2xmc19wcmVh
ZChnbGZkLCBkYXRhLCBuLCBvZmZzZXQsIDAsIE5VTEwpOworCXJldCA9IGdsZnNfcHJlYWQo
Z2xmZCwgZGF0YSwgbiwgb2Zmc2V0LCAwLCBOVUxMKTsKICNlbHNlCi0JcmV0dXJuIGdsZnNf
cHJlYWQoZ2xmZCwgZGF0YSwgbiwgb2Zmc2V0LCAwKTsKKwlyZXQgPSBnbGZzX3ByZWFkKGds
ZmQsIGRhdGEsIG4sIG9mZnNldCwgMCk7CiAjZW5kaWYKKwlFTkRfUFJPRklMRV9CWVRFUyhz
eXNjYWxsX3ByZWFkKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0cnVjdCBnbHVzdGVyZnNf
YWlvX3N0YXRlOwpAQCAtNjY1LDYgKzcyNSw3IEBAIHN0cnVjdCBnbHVzdGVyZnNfYWlvX3N0
YXRlIHsKIAlib29sIGNhbmNlbGxlZDsKIAlzdHJ1Y3QgdmZzX2Fpb19zdGF0ZSB2ZnNfYWlv
X3N0YXRlOwogCXN0cnVjdCB0aW1lc3BlYyBzdGFydDsKKwlTTUJQUk9GSUxFX0JZVEVTX0FT
WU5DX1NUQVRFKHByb2ZpbGVfYnl0ZXMpOwogfTsKIAogc3RhdGljIGludCBhaW9fd3JhcHBl
cl9kZXN0cnVjdG9yKHN0cnVjdCBnbHVzdGVyZnNfYWlvX3dyYXBwZXIgKndyYXApCkBAIC03
MDYsNiArNzY3LDggQEAgc3RhdGljIHZvaWQgYWlvX2dsdXN0ZXJmc19kb25lKGdsZnNfZmRf
dCAqZmQsIHNzaXplX3QgcmV0LCB2b2lkICpkYXRhKQogCX0KIAlzdGF0ZS0+dmZzX2Fpb19z
dGF0ZS5kdXJhdGlvbiA9IG5zZWNfdGltZV9kaWZmKCZlbmQsICZzdGF0ZS0+c3RhcnQpOwog
CisJU01CUFJPRklMRV9CWVRFU19BU1lOQ19FTkQoc3RhdGUtPnByb2ZpbGVfYnl0ZXMpOwor
CiAJLyoKIAkgKiBXcml0ZSB0aGUgc3RhdGUgcG9pbnRlciB0byBnbHVzdGVyZnNfYWlvX3N0
YXRlIHRvIHRoZQogCSAqIHBpcGUsIHNvIHdlIGNhbiBjYWxsIHRldmVudF9yZXFfZG9uZSgp
IGZyb20gdGhlIG1haW4gdGhyZWFkLApAQCAtODc4LDYgKzk0MSw4IEBAIHN0YXRpYyBzdHJ1
Y3QgdGV2ZW50X3JlcSAqdmZzX2dsdXN0ZXJfcHJlYWRfc2VuZChzdHJ1Y3QgdmZzX2hhbmRs
ZV9zdHJ1Y3QKIAkgKi8KIAl0ZXZlbnRfcmVxX2RlZmVyX2NhbGxiYWNrKHJlcSwgZXYpOwog
CisJU01CUFJPRklMRV9CWVRFU19BU1lOQ19TVEFSVChzeXNjYWxsX2FzeXNfcHJlYWQsIHBy
b2ZpbGVfcCwKKwkJCQkgICAgIHN0YXRlLT5wcm9maWxlX2J5dGVzLCBuKTsKIAlQUk9GSUxF
X1RJTUVTVEFNUCgmc3RhdGUtPnN0YXJ0KTsKIAlyZXQgPSBnbGZzX3ByZWFkX2FzeW5jKGds
ZmQsIGRhdGEsIG4sIG9mZnNldCwgMCwgYWlvX2dsdXN0ZXJmc19kb25lLAogCQkJCXN0YXRl
KTsKQEAgLTkyNyw2ICs5OTIsOCBAQCBzdGF0aWMgc3RydWN0IHRldmVudF9yZXEgKnZmc19n
bHVzdGVyX3B3cml0ZV9zZW5kKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdAogCSAqLwogCXRl
dmVudF9yZXFfZGVmZXJfY2FsbGJhY2socmVxLCBldik7CiAKKwlTTUJQUk9GSUxFX0JZVEVT
X0FTWU5DX1NUQVJUKHN5c2NhbGxfYXN5c19wd3JpdGUsIHByb2ZpbGVfcCwKKwkJCQkgICAg
IHN0YXRlLT5wcm9maWxlX2J5dGVzLCBuKTsKIAlQUk9GSUxFX1RJTUVTVEFNUCgmc3RhdGUt
PnN0YXJ0KTsKIAlyZXQgPSBnbGZzX3B3cml0ZV9hc3luYyhnbGZkLCBkYXRhLCBuLCBvZmZz
ZXQsIDAsIGFpb19nbHVzdGVyZnNfZG9uZSwKIAkJCQlzdGF0ZSk7CkBAIC05NzIsMjkgKzEw
MzksNDcgQEAgc3RhdGljIHNzaXplX3QgdmZzX2dsdXN0ZXJfcHdyaXRlKHN0cnVjdCB2ZnNf
aGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJCSAgZmlsZXNfc3RydWN0ICpmc3AsIGNvbnN0
IHZvaWQgKmRhdGEsCiAJCQkJICBzaXplX3Qgbiwgb2ZmX3Qgb2Zmc2V0KQogewotCWdsZnNf
ZmRfdCAqZ2xmZCA9IHZmc19nbHVzdGVyX2ZldGNoX2dsZmQoaGFuZGxlLCBmc3ApOworCXNz
aXplX3QgcmV0OworCWdsZnNfZmRfdCAqZ2xmZCA9IE5VTEw7CisKKwlTVEFSVF9QUk9GSUxF
X0JZVEVTKHN5c2NhbGxfcHdyaXRlLCBuKTsKKworCWdsZmQgPSB2ZnNfZ2x1c3Rlcl9mZXRj
aF9nbGZkKGhhbmRsZSwgZnNwKTsKIAlpZiAoZ2xmZCA9PSBOVUxMKSB7CisJCUVORF9QUk9G
SUxFX0JZVEVTKHN5c2NhbGxfcHdyaXRlKTsKIAkJREJHX0VSUigiRmFpbGVkIHRvIGZldGNo
IGdsdXN0ZXIgZmRcbiIpOwogCQlyZXR1cm4gLTE7CiAJfQogCiAjaWZkZWYgSEFWRV9HRkFQ
SV9WRVJfN182Ci0JcmV0dXJuIGdsZnNfcHdyaXRlKGdsZmQsIGRhdGEsIG4sIG9mZnNldCwg
MCwgTlVMTCwgTlVMTCk7CisJcmV0ID0gZ2xmc19wd3JpdGUoZ2xmZCwgZGF0YSwgbiwgb2Zm
c2V0LCAwLCBOVUxMLCBOVUxMKTsKICNlbHNlCi0JcmV0dXJuIGdsZnNfcHdyaXRlKGdsZmQs
IGRhdGEsIG4sIG9mZnNldCwgMCk7CisJcmV0ID0gZ2xmc19wd3JpdGUoZ2xmZCwgZGF0YSwg
biwgb2Zmc2V0LCAwKTsKICNlbmRpZgorCUVORF9QUk9GSUxFX0JZVEVTKHN5c2NhbGxfcHdy
aXRlKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBvZmZfdCB2ZnNfZ2x1c3Rlcl9s
c2VlayhzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCSAgICAgICBmaWxl
c19zdHJ1Y3QgKmZzcCwgb2ZmX3Qgb2Zmc2V0LCBpbnQgd2hlbmNlKQogewotCWdsZnNfZmRf
dCAqZ2xmZCA9IHZmc19nbHVzdGVyX2ZldGNoX2dsZmQoaGFuZGxlLCBmc3ApOworCW9mZl90
IHJldCA9IDA7CisJZ2xmc19mZF90ICpnbGZkID0gTlVMTDsKKworCVNUQVJUX1BST0ZJTEUo
c3lzY2FsbF9sc2Vlayk7CisKKwlnbGZkID0gdmZzX2dsdXN0ZXJfZmV0Y2hfZ2xmZChoYW5k
bGUsIGZzcCk7CiAJaWYgKGdsZmQgPT0gTlVMTCkgeworCQlFTkRfUFJPRklMRShzeXNjYWxs
X2xzZWVrKTsKIAkJREJHX0VSUigiRmFpbGVkIHRvIGZldGNoIGdsdXN0ZXIgZmRcbiIpOwog
CQlyZXR1cm4gLTE7CiAJfQogCi0JcmV0dXJuIGdsZnNfbHNlZWsoZ2xmZCwgb2Zmc2V0LCB3
aGVuY2UpOworCXJldCA9IGdsZnNfbHNlZWsoZ2xmZCwgb2Zmc2V0LCB3aGVuY2UpOworCUVO
RF9QUk9GSUxFKHN5c2NhbGxfbHNlZWspOworCisJcmV0dXJuIHJldDsKIH0KIAogc3RhdGlj
IHNzaXplX3QgdmZzX2dsdXN0ZXJfc2VuZGZpbGUoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0
ICpoYW5kbGUsIGludCB0b2ZkLApAQCAtMTAyMCw4ICsxMTA1LDE0IEBAIHN0YXRpYyBpbnQg
dmZzX2dsdXN0ZXJfcmVuYW1lYXQoc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUs
CiAJCQlmaWxlc19zdHJ1Y3QgKmRzdGZzcCwKIAkJCWNvbnN0IHN0cnVjdCBzbWJfZmlsZW5h
bWUgKnNtYl9mbmFtZV9kc3QpCiB7Ci0JcmV0dXJuIGdsZnNfcmVuYW1lKGhhbmRsZS0+ZGF0
YSwgc21iX2ZuYW1lX3NyYy0+YmFzZV9uYW1lLAotCQkJICAgc21iX2ZuYW1lX2RzdC0+YmFz
ZV9uYW1lKTsKKwlpbnQgcmV0OworCisJU1RBUlRfUFJPRklMRShzeXNjYWxsX3JlbmFtZWF0
KTsKKwlyZXQgPSBnbGZzX3JlbmFtZShoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZV9zcmMtPmJh
c2VfbmFtZSwKKwkJCSAgc21iX2ZuYW1lX2RzdC0+YmFzZV9uYW1lKTsKKwlFTkRfUFJPRklM
RShzeXNjYWxsX3JlbmFtZWF0KTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBzdHJ1
Y3QgdGV2ZW50X3JlcSAqdmZzX2dsdXN0ZXJfZnN5bmNfc2VuZChzdHJ1Y3QgdmZzX2hhbmRs
ZV9zdHJ1Y3QKQEAgLTEwNjAsNiArMTE1MSw4IEBAIHN0YXRpYyBzdHJ1Y3QgdGV2ZW50X3Jl
cSAqdmZzX2dsdXN0ZXJfZnN5bmNfc2VuZChzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QKIAkg
Ki8KIAl0ZXZlbnRfcmVxX2RlZmVyX2NhbGxiYWNrKHJlcSwgZXYpOwogCisJU01CUFJPRklM
RV9CWVRFU19BU1lOQ19TVEFSVChzeXNjYWxsX2FzeXNfZnN5bmMsIHByb2ZpbGVfcCwKKwkJ
CQkgICAgIHN0YXRlLT5wcm9maWxlX2J5dGVzLCAwKTsKIAlQUk9GSUxFX1RJTUVTVEFNUCgm
c3RhdGUtPnN0YXJ0KTsKIAlyZXQgPSBnbGZzX2ZzeW5jX2FzeW5jKGdsZmQsIGFpb19nbHVz
dGVyZnNfZG9uZSwgc3RhdGUpOwogCWlmIChyZXQgPCAwKSB7CkBAIC0xMDg0LDYgKzExNzcs
NyBAQCBzdGF0aWMgaW50IHZmc19nbHVzdGVyX3N0YXQoc3RydWN0IHZmc19oYW5kbGVfc3Ry
dWN0ICpoYW5kbGUsCiAJc3RydWN0IHN0YXQgc3Q7CiAJaW50IHJldDsKIAorCVNUQVJUX1BS
T0ZJTEUoc3lzY2FsbF9zdGF0KTsKIAlyZXQgPSBnbGZzX3N0YXQoaGFuZGxlLT5kYXRhLCBz
bWJfZm5hbWUtPmJhc2VfbmFtZSwgJnN0KTsKIAlpZiAocmV0ID09IDApIHsKIAkJc21iX3N0
YXRfZXhfZnJvbV9zdGF0KCZzbWJfZm5hbWUtPnN0LCAmc3QpOwpAQCAtMTA5Miw2ICsxMTg2
LDggQEAgc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9zdGF0KHN0cnVjdCB2ZnNfaGFuZGxlX3N0
cnVjdCAqaGFuZGxlLAogCQlERUJVRygwLCAoImdsZnNfc3RhdCglcykgZmFpbGVkOiAlc1xu
IiwKIAkJCSAgc21iX2ZuYW1lLT5iYXNlX25hbWUsIHN0cmVycm9yKGVycm5vKSkpOwogCX0K
KwlFTkRfUFJPRklMRShzeXNjYWxsX3N0YXQpOworCiAJcmV0dXJuIHJldDsKIH0KIApAQCAt
MTEwMCw5ICsxMTk2LDEzIEBAIHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJfZnN0YXQoc3RydWN0
IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiB7CiAJc3RydWN0IHN0YXQgc3Q7CiAJaW50
IHJldDsKLQlnbGZzX2ZkX3QgKmdsZmQgPSB2ZnNfZ2x1c3Rlcl9mZXRjaF9nbGZkKGhhbmRs
ZSwgZnNwKTsKKwlnbGZzX2ZkX3QgKmdsZmQgPSBOVUxMOwogCisJU1RBUlRfUFJPRklMRShz
eXNjYWxsX2ZzdGF0KTsKKworCWdsZmQgPSB2ZnNfZ2x1c3Rlcl9mZXRjaF9nbGZkKGhhbmRs
ZSwgZnNwKTsKIAlpZiAoZ2xmZCA9PSBOVUxMKSB7CisJCUVORF9QUk9GSUxFKHN5c2NhbGxf
ZnN0YXQpOwogCQlEQkdfRVJSKCJGYWlsZWQgdG8gZmV0Y2ggZ2x1c3RlciBmZFxuIik7CiAJ
CXJldHVybiAtMTsKIAl9CkBAIC0xMTE1LDYgKzEyMTUsOCBAQCBzdGF0aWMgaW50IHZmc19n
bHVzdGVyX2ZzdGF0KHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQlERUJV
RygwLCAoImdsZnNfZnN0YXQoJWQpIGZhaWxlZDogJXNcbiIsCiAJCQkgIGZzcC0+ZmgtPmZk
LCBzdHJlcnJvcihlcnJubykpKTsKIAl9CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9mc3RhdCk7
CisKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0xMTI0LDYgKzEyMjYsNyBAQCBzdGF0aWMgaW50
IHZmc19nbHVzdGVyX2xzdGF0KHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAog
CXN0cnVjdCBzdGF0IHN0OwogCWludCByZXQ7CiAKKwlTVEFSVF9QUk9GSUxFKHN5c2NhbGxf
bHN0YXQpOwogCXJldCA9IGdsZnNfbHN0YXQoaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWUtPmJh
c2VfbmFtZSwgJnN0KTsKIAlpZiAocmV0ID09IDApIHsKIAkJc21iX3N0YXRfZXhfZnJvbV9z
dGF0KCZzbWJfZm5hbWUtPnN0LCAmc3QpOwpAQCAtMTEzMiw2ICsxMjM1LDggQEAgc3RhdGlj
IGludCB2ZnNfZ2x1c3Rlcl9sc3RhdChzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRs
ZSwKIAkJREVCVUcoMCwgKCJnbGZzX2xzdGF0KCVzKSBmYWlsZWQ6ICVzXG4iLAogCQkJICBz
bWJfZm5hbWUtPmJhc2VfbmFtZSwgc3RyZXJyb3IoZXJybm8pKSk7CiAJfQorCUVORF9QUk9G
SUxFKHN5c2NhbGxfbHN0YXQpOworCiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMTEzOSwzMyAr
MTI0NCw1OSBAQCBzdGF0aWMgdWludDY0X3QgdmZzX2dsdXN0ZXJfZ2V0X2FsbG9jX3NpemUo
c3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCiAJCQkJCSAgIGZpbGVzX3N0cnVj
dCAqZnNwLAogCQkJCQkgICBjb25zdCBTTUJfU1RSVUNUX1NUQVQgKnNidWYpCiB7Ci0JcmV0
dXJuIHNidWYtPnN0X2V4X2Jsb2NrcyAqIDUxMjsKKwl1aW50NjRfdCByZXQ7CisKKwlTVEFS
VF9QUk9GSUxFKHN5c2NhbGxfZ2V0X2FsbG9jX3NpemUpOworCXJldCA9IHNidWYtPnN0X2V4
X2Jsb2NrcyAqIDUxMjsKKwlFTkRfUFJPRklMRShzeXNjYWxsX2dldF9hbGxvY19zaXplKTsK
KworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJfdW5saW5rKHN0
cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJICAgICAgY29uc3Qgc3RydWN0
IHNtYl9maWxlbmFtZSAqc21iX2ZuYW1lKQogewotCXJldHVybiBnbGZzX3VubGluayhoYW5k
bGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFzZV9uYW1lKTsKKwlpbnQgcmV0OworCisJU1RBUlRf
UFJPRklMRShzeXNjYWxsX3VubGluayk7CisJcmV0ID0gZ2xmc191bmxpbmsoaGFuZGxlLT5k
YXRhLCBzbWJfZm5hbWUtPmJhc2VfbmFtZSk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF91bmxp
bmspOworCisJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9jaG1v
ZChzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCQljb25zdCBzdHJ1Y3Qg
c21iX2ZpbGVuYW1lICpzbWJfZm5hbWUsCiAJCQkJbW9kZV90IG1vZGUpCiB7Ci0JcmV0dXJu
IGdsZnNfY2htb2QoaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWUtPmJhc2VfbmFtZSwgbW9kZSk7
CisJaW50IHJldDsKKworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9jaG1vZCk7CisJcmV0ID0g
Z2xmc19jaG1vZChoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFzZV9uYW1lLCBtb2RlKTsK
KwlFTkRfUFJPRklMRShzeXNjYWxsX2NobW9kKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0
YXRpYyBpbnQgdmZzX2dsdXN0ZXJfZmNobW9kKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAq
aGFuZGxlLAogCQkJICAgICAgZmlsZXNfc3RydWN0ICpmc3AsIG1vZGVfdCBtb2RlKQogewot
CWdsZnNfZmRfdCAqZ2xmZCA9IHZmc19nbHVzdGVyX2ZldGNoX2dsZmQoaGFuZGxlLCBmc3Ap
OworCWludCByZXQ7CisJZ2xmc19mZF90ICpnbGZkID0gTlVMTDsKKworCVNUQVJUX1BST0ZJ
TEUoc3lzY2FsbF9mY2htb2QpOwogCisJZ2xmZCA9IHZmc19nbHVzdGVyX2ZldGNoX2dsZmQo
aGFuZGxlLCBmc3ApOwogCWlmIChnbGZkID09IE5VTEwpIHsKKwkJRU5EX1BST0ZJTEUoc3lz
Y2FsbF9mY2htb2QpOwogCQlEQkdfRVJSKCJGYWlsZWQgdG8gZmV0Y2ggZ2x1c3RlciBmZFxu
Iik7CiAJCXJldHVybiAtMTsKIAl9CiAKLQlyZXR1cm4gZ2xmc19mY2htb2QoZ2xmZCwgbW9k
ZSk7CisJcmV0ID0gZ2xmc19mY2htb2QoZ2xmZCwgbW9kZSk7CisJRU5EX1BST0ZJTEUoc3lz
Y2FsbF9mY2htb2QpOworCisJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCB2ZnNfZ2x1
c3Rlcl9jaG93bihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKQEAgLTExNzMs
MTkgKzEzMDQsMzQgQEAgc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9jaG93bihzdHJ1Y3QgdmZz
X2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCXVpZF90IHVpZCwKIAkJCWdpZF90IGdpZCkK
IHsKLQlyZXR1cm4gZ2xmc19jaG93bihoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFzZV9u
YW1lLCB1aWQsIGdpZCk7CisJaW50IHJldDsKKworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9j
aG93bik7CisJcmV0ID0gZ2xmc19jaG93bihoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFz
ZV9uYW1lLCB1aWQsIGdpZCk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9jaG93bik7CisKKwly
ZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHZmc19nbHVzdGVyX2ZjaG93bihzdHJ1Y3Qg
dmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCSAgICAgIGZpbGVzX3N0cnVjdCAqZnNw
LCB1aWRfdCB1aWQsIGdpZF90IGdpZCkKIHsKLQlnbGZzX2ZkX3QgKmdsZmQgPSB2ZnNfZ2x1
c3Rlcl9mZXRjaF9nbGZkKGhhbmRsZSwgZnNwKTsKKwlpbnQgcmV0OworCWdsZnNfZmRfdCAq
Z2xmZCA9IE5VTEw7CisKKwlTVEFSVF9QUk9GSUxFKHN5c2NhbGxfZmNob3duKTsKKworCWds
ZmQgPSB2ZnNfZ2x1c3Rlcl9mZXRjaF9nbGZkKGhhbmRsZSwgZnNwKTsKIAlpZiAoZ2xmZCA9
PSBOVUxMKSB7CisJCUVORF9QUk9GSUxFKHN5c2NhbGxfZmNob3duKTsKIAkJREJHX0VSUigi
RmFpbGVkIHRvIGZldGNoIGdsdXN0ZXIgZmRcbiIpOwogCQlyZXR1cm4gLTE7CiAJfQogCi0J
cmV0dXJuIGdsZnNfZmNob3duKGdsZmQsIHVpZCwgZ2lkKTsKKwlyZXQgPSBnbGZzX2ZjaG93
bihnbGZkLCB1aWQsIGdpZCk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9mY2hvd24pOworCisJ
cmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9sY2hvd24oc3RydWN0
IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCkBAIC0xMTkzLDEzICsxMzM5LDI1IEBAIHN0
YXRpYyBpbnQgdmZzX2dsdXN0ZXJfbGNob3duKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAq
aGFuZGxlLAogCQkJdWlkX3QgdWlkLAogCQkJZ2lkX3QgZ2lkKQogewotCXJldHVybiBnbGZz
X2xjaG93bihoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFzZV9uYW1lLCB1aWQsIGdpZCk7
CisJaW50IHJldDsKKworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9sY2hvd24pOworCXJldCA9
IGdsZnNfbGNob3duKGhhbmRsZS0+ZGF0YSwgc21iX2ZuYW1lLT5iYXNlX25hbWUsIHVpZCwg
Z2lkKTsKKwlFTkRfUFJPRklMRShzeXNjYWxsX2xjaG93bik7CisKKwlyZXR1cm4gcmV0Owog
fQogCiBzdGF0aWMgaW50IHZmc19nbHVzdGVyX2NoZGlyKHN0cnVjdCB2ZnNfaGFuZGxlX3N0
cnVjdCAqaGFuZGxlLAogCQkJY29uc3Qgc3RydWN0IHNtYl9maWxlbmFtZSAqc21iX2ZuYW1l
KQogewotCXJldHVybiBnbGZzX2NoZGlyKGhhbmRsZS0+ZGF0YSwgc21iX2ZuYW1lLT5iYXNl
X25hbWUpOworCWludCByZXQ7CisKKwlTVEFSVF9QUk9GSUxFKHN5c2NhbGxfY2hkaXIpOwor
CXJldCA9IGdsZnNfY2hkaXIoaGFuZGxlLT5kYXRhLCBzbWJfZm5hbWUtPmJhc2VfbmFtZSk7
CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9jaGRpcik7CisKKwlyZXR1cm4gcmV0OwogfQogCiBz
dGF0aWMgc3RydWN0IHNtYl9maWxlbmFtZSAqdmZzX2dsdXN0ZXJfZ2V0d2Qoc3RydWN0IHZm
c19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCkBAIC0xMjA5LDEyICsxMzY3LDE3IEBAIHN0YXRp
YyBzdHJ1Y3Qgc21iX2ZpbGVuYW1lICp2ZnNfZ2x1c3Rlcl9nZXR3ZChzdHJ1Y3QgdmZzX2hh
bmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAljaGFyICpyZXQ7CiAJc3RydWN0IHNtYl9maWxlbmFt
ZSAqc21iX2ZuYW1lID0gTlVMTDsKIAorCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9nZXR3ZCk7
CisKIAljd2QgPSBTTUJfQ0FMTE9DX0FSUkFZKGNoYXIsIFBBVEhfTUFYKTsKIAlpZiAoY3dk
ID09IE5VTEwpIHsKKwkJRU5EX1BST0ZJTEUoc3lzY2FsbF9nZXR3ZCk7CiAJCXJldHVybiBO
VUxMOwogCX0KIAogCXJldCA9IGdsZnNfZ2V0Y3dkKGhhbmRsZS0+ZGF0YSwgY3dkLCBQQVRI
X01BWCAtIDEpOworCUVORF9QUk9GSUxFKHN5c2NhbGxfZ2V0d2QpOworCiAJaWYgKHJldCA9
PSBOVUxMKSB7CiAJCVNBRkVfRlJFRShjd2QpOwogCQlyZXR1cm4gTlVMTDsKQEAgLTEyMzIs
OCArMTM5NSwxMSBAQCBzdGF0aWMgaW50IHZmc19nbHVzdGVyX250aW1lcyhzdHJ1Y3QgdmZz
X2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCSAgICAgIGNvbnN0IHN0cnVjdCBzbWJfZmls
ZW5hbWUgKnNtYl9mbmFtZSwKIAkJCSAgICAgIHN0cnVjdCBzbWJfZmlsZV90aW1lICpmdCkK
IHsKKwlpbnQgcmV0ID0gLTE7CiAJc3RydWN0IHRpbWVzcGVjIHRpbWVzWzJdOwogCisJU1RB
UlRfUFJPRklMRShzeXNjYWxsX250aW1lcyk7CisKIAlpZiAobnVsbF90aW1lc3BlYyhmdC0+
YXRpbWUpKSB7CiAJCXRpbWVzWzBdLnR2X3NlYyA9IHNtYl9mbmFtZS0+c3Quc3RfZXhfYXRp
bWUudHZfc2VjOwogCQl0aW1lc1swXS50dl9uc2VjID0gc21iX2ZuYW1lLT5zdC5zdF9leF9h
dGltZS50dl9uc2VjOwpAQCAtMTI1NCwyNiArMTQyMCwzOSBAQCBzdGF0aWMgaW50IHZmc19n
bHVzdGVyX250aW1lcyhzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCSAg
ICAgICZzbWJfZm5hbWUtPnN0LnN0X2V4X2F0aW1lKSA9PSAwKSAmJgogCSAgICAodGltZXNw
ZWNfY29tcGFyZSgmdGltZXNbMV0sCiAJCQkgICAgICAmc21iX2ZuYW1lLT5zdC5zdF9leF9t
dGltZSkgPT0gMCkpIHsKKwkJRU5EX1BST0ZJTEUoc3lzY2FsbF9udGltZXMpOwogCQlyZXR1
cm4gMDsKIAl9CiAKLQlyZXR1cm4gZ2xmc191dGltZW5zKGhhbmRsZS0+ZGF0YSwgc21iX2Zu
YW1lLT5iYXNlX25hbWUsIHRpbWVzKTsKKwlyZXQgPSBnbGZzX3V0aW1lbnMoaGFuZGxlLT5k
YXRhLCBzbWJfZm5hbWUtPmJhc2VfbmFtZSwgdGltZXMpOworCUVORF9QUk9GSUxFKHN5c2Nh
bGxfbnRpbWVzKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdmZzX2dsdXN0
ZXJfZnRydW5jYXRlKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJCSBm
aWxlc19zdHJ1Y3QgKmZzcCwgb2ZmX3Qgb2Zmc2V0KQogewotCWdsZnNfZmRfdCAqZ2xmZCA9
IHZmc19nbHVzdGVyX2ZldGNoX2dsZmQoaGFuZGxlLCBmc3ApOworCWludCByZXQ7CisJZ2xm
c19mZF90ICpnbGZkID0gTlVMTDsKKworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9mdHJ1bmNh
dGUpOworCisJZ2xmZCA9IHZmc19nbHVzdGVyX2ZldGNoX2dsZmQoaGFuZGxlLCBmc3ApOwog
CWlmIChnbGZkID09IE5VTEwpIHsKKwkJRU5EX1BST0ZJTEUoc3lzY2FsbF9mdHJ1bmNhdGUp
OwogCQlEQkdfRVJSKCJGYWlsZWQgdG8gZmV0Y2ggZ2x1c3RlciBmZFxuIik7CiAJCXJldHVy
biAtMTsKIAl9CiAKICNpZmRlZiBIQVZFX0dGQVBJX1ZFUl83XzYKLQlyZXR1cm4gZ2xmc19m
dHJ1bmNhdGUoZ2xmZCwgb2Zmc2V0LCBOVUxMLCBOVUxMKTsKKwlyZXQgPSBnbGZzX2Z0cnVu
Y2F0ZShnbGZkLCBvZmZzZXQsIE5VTEwsIE5VTEwpOwogI2Vsc2UKLQlyZXR1cm4gZ2xmc19m
dHJ1bmNhdGUoZ2xmZCwgb2Zmc2V0KTsKKwlyZXQgPSBnbGZzX2Z0cnVuY2F0ZShnbGZkLCBv
ZmZzZXQpOwogI2VuZGlmCisJRU5EX1BST0ZJTEUoc3lzY2FsbF9mdHJ1bmNhdGUpOworCisJ
cmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCB2ZnNfZ2x1c3Rlcl9mYWxsb2NhdGUoc3Ry
dWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCkBAIC0xMjgxLDEwICsxNDYwLDE3IEBA
IHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJfZmFsbG9jYXRlKHN0cnVjdCB2ZnNfaGFuZGxlX3N0
cnVjdCAqaGFuZGxlLAogCQkJCSB1aW50MzJfdCBtb2RlLAogCQkJCSBvZmZfdCBvZmZzZXQs
IG9mZl90IGxlbikKIHsKKwlpbnQgcmV0OworCWdsZnNfZmRfdCAqZ2xmZCA9IE5VTEw7CisK
ICNpZmRlZiBIQVZFX0dGQVBJX1ZFUl82CiAJaW50IGtlZXBfc2l6ZSwgcHVuY2hfaG9sZTsK
LQlnbGZzX2ZkX3QgKmdsZmQgPSB2ZnNfZ2x1c3Rlcl9mZXRjaF9nbGZkKGhhbmRsZSwgZnNw
KTsKKworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9mYWxsb2NhdGUpOworCisJZ2xmZCA9IHZm
c19nbHVzdGVyX2ZldGNoX2dsZmQoaGFuZGxlLCBmc3ApOwogCWlmIChnbGZkID09IE5VTEwp
IHsKKwkJRU5EX1BST0ZJTEUoc3lzY2FsbF9mYWxsb2NhdGUpOwogCQlEQkdfRVJSKCJGYWls
ZWQgdG8gZmV0Y2ggZ2x1c3RlciBmZFxuIik7CiAJCXJldHVybiAtMTsKIAl9CkBAIC0xMjk0
LDE5ICsxNDgwLDIzIEBAIHN0YXRpYyBpbnQgdmZzX2dsdXN0ZXJfZmFsbG9jYXRlKHN0cnVj
dCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCiAJbW9kZSAmPSB+KFZGU19GQUxMT0NB
VEVfRkxfS0VFUF9TSVpFfFZGU19GQUxMT0NBVEVfRkxfUFVOQ0hfSE9MRSk7CiAJaWYgKG1v
ZGUgIT0gMCkgeworCQlFTkRfUFJPRklMRShzeXNjYWxsX2ZhbGxvY2F0ZSk7CiAJCWVycm5v
ID0gRU5PVFNVUDsKIAkJcmV0dXJuIC0xOwogCX0KIAogCWlmIChwdW5jaF9ob2xlKSB7Ci0J
CXJldHVybiBnbGZzX2Rpc2NhcmQoZ2xmZCwgb2Zmc2V0LCBsZW4pOworCQlyZXQgPSBnbGZz
X2Rpc2NhcmQoZ2xmZCwgb2Zmc2V0LCBsZW4pOwogCX0KIAotCXJldHVybiBnbGZzX2ZhbGxv
Y2F0ZShnbGZkLCBrZWVwX3NpemUsIG9mZnNldCwgbGVuKTsKKwlyZXQgPSBnbGZzX2ZhbGxv
Y2F0ZShnbGZkLCBrZWVwX3NpemUsIG9mZnNldCwgbGVuKTsKICNlbHNlCiAJZXJybm8gPSBF
Tk9UU1VQOwotCXJldHVybiAtMTsKKwlyZXQgPSAtMTsKICNlbmRpZgorCUVORF9QUk9GSUxF
KHN5c2NhbGxfZmFsbG9jYXRlKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBzdHJ1
Y3Qgc21iX2ZpbGVuYW1lICp2ZnNfZ2x1c3Rlcl9yZWFscGF0aChzdHJ1Y3QgdmZzX2hhbmRs
ZV9zdHJ1Y3QgKmhhbmRsZSwKQEAgLTEzMTUsOSArMTUwNSwxMyBAQCBzdGF0aWMgc3RydWN0
IHNtYl9maWxlbmFtZSAqdmZzX2dsdXN0ZXJfcmVhbHBhdGgoc3RydWN0IHZmc19oYW5kbGVf
c3RydWN0ICpoYW5kbAogewogCWNoYXIgKnJlc3VsdCA9IE5VTEw7CiAJc3RydWN0IHNtYl9m
aWxlbmFtZSAqcmVzdWx0X2ZuYW1lID0gTlVMTDsKLQljaGFyICpyZXNvbHZlZF9wYXRoID0g
U01CX01BTExPQ19BUlJBWShjaGFyLCBQQVRIX01BWCsxKTsKKwljaGFyICpyZXNvbHZlZF9w
YXRoID0gTlVMTDsKIAorCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9yZWFscGF0aCk7CisKKwly
ZXNvbHZlZF9wYXRoID0gU01CX01BTExPQ19BUlJBWShjaGFyLCBQQVRIX01BWCsxKTsKIAlp
ZiAocmVzb2x2ZWRfcGF0aCA9PSBOVUxMKSB7CisJCUVORF9QUk9GSUxFKHN5c2NhbGxfcmVh
bHBhdGgpOwogCQllcnJubyA9IEVOT01FTTsKIAkJcmV0dXJuIE5VTEw7CiAJfQpAQCAtMTMz
MCw2ICsxNTI0LDggQEAgc3RhdGljIHN0cnVjdCBzbWJfZmlsZW5hbWUgKnZmc19nbHVzdGVy
X3JlYWxwYXRoKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGwKIAl9CiAKIAlTQUZF
X0ZSRUUocmVzb2x2ZWRfcGF0aCk7CisJRU5EX1BST0ZJTEUoc3lzY2FsbF9yZWFscGF0aCk7
CisKIAlyZXR1cm4gcmVzdWx0X2ZuYW1lOwogfQogCkBAIC0xMzM5LDEwICsxNTM1LDE2IEBA
IHN0YXRpYyBib29sIHZmc19nbHVzdGVyX2xvY2soc3RydWN0IHZmc19oYW5kbGVfc3RydWN0
ICpoYW5kbGUsCiB7CiAJc3RydWN0IGZsb2NrIGZsb2NrID0geyAwLCB9OwogCWludCByZXQ7
Ci0JZ2xmc19mZF90ICpnbGZkID0gdmZzX2dsdXN0ZXJfZmV0Y2hfZ2xmZChoYW5kbGUsIGZz
cCk7CisJZ2xmc19mZF90ICpnbGZkID0gTlVMTDsKKwlib29sIG9rID0gZmFsc2U7CisKKwlT
VEFSVF9QUk9GSUxFKHN5c2NhbGxfZmNudGxfbG9jayk7CisKKwlnbGZkID0gdmZzX2dsdXN0
ZXJfZmV0Y2hfZ2xmZChoYW5kbGUsIGZzcCk7CiAJaWYgKGdsZmQgPT0gTlVMTCkgewogCQlE
QkdfRVJSKCJGYWlsZWQgdG8gZmV0Y2ggZ2x1c3RlciBmZFxuIik7Ci0JCXJldHVybiBmYWxz
ZTsKKwkJb2sgPSBmYWxzZTsKKwkJZ290byBvdXQ7CiAJfQogCiAJZmxvY2subF90eXBlID0g
dHlwZTsKQEAgLTEzNTcsMTcgKzE1NTksMjUgQEAgc3RhdGljIGJvb2wgdmZzX2dsdXN0ZXJf
bG9jayhzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJLyogbG9jayBxdWVy
eSwgdHJ1ZSBpZiBzb21lb25lIGVsc2UgaGFzIGxvY2tlZCAqLwogCQlpZiAoKHJldCAhPSAt
MSkgJiYKIAkJICAgIChmbG9jay5sX3R5cGUgIT0gRl9VTkxDSykgJiYKLQkJICAgIChmbG9j
ay5sX3BpZCAhPSAwKSAmJiAoZmxvY2subF9waWQgIT0gZ2V0cGlkKCkpKQotCQkJcmV0dXJu
IHRydWU7CisJCSAgICAoZmxvY2subF9waWQgIT0gMCkgJiYgKGZsb2NrLmxfcGlkICE9IGdl
dHBpZCgpKSkgeworCQkJb2sgPSB0cnVlOworCQkJZ290byBvdXQ7CisJCX0KIAkJLyogbm90
IG1lICovCi0JCXJldHVybiBmYWxzZTsKKwkJb2sgPSBmYWxzZTsKKwkJZ290byBvdXQ7CiAJ
fQogCiAJaWYgKHJldCA9PSAtMSkgewotCQlyZXR1cm4gZmFsc2U7CisJCW9rID0gZmFsc2U7
CisJCWdvdG8gb3V0OwogCX0KIAotCXJldHVybiB0cnVlOworCW9rID0gdHJ1ZTsKK291dDoK
KwlFTkRfUFJPRklMRShzeXNjYWxsX2ZjbnRsX2xvY2spOworCisJcmV0dXJuIG9rOwogfQog
CiBzdGF0aWMgaW50IHZmc19nbHVzdGVyX2tlcm5lbF9mbG9jayhzdHJ1Y3QgdmZzX2hhbmRs
ZV9zdHJ1Y3QgKmhhbmRsZSwKQEAgLTEzOTEsOCArMTYwMSwxMyBAQCBzdGF0aWMgYm9vbCB2
ZnNfZ2x1c3Rlcl9nZXRsb2NrKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAog
ewogCXN0cnVjdCBmbG9jayBmbG9jayA9IHsgMCwgfTsKIAlpbnQgcmV0OwotCWdsZnNfZmRf
dCAqZ2xmZCA9IHZmc19nbHVzdGVyX2ZldGNoX2dsZmQoaGFuZGxlLCBmc3ApOworCWdsZnNf
ZmRfdCAqZ2xmZCA9IE5VTEw7CisKKwlTVEFSVF9QUk9GSUxFKHN5c2NhbGxfZmNudGxfZ2V0
bG9jayk7CisKKwlnbGZkID0gdmZzX2dsdXN0ZXJfZmV0Y2hfZ2xmZChoYW5kbGUsIGZzcCk7
CiAJaWYgKGdsZmQgPT0gTlVMTCkgeworCQlFTkRfUFJPRklMRShzeXNjYWxsX2ZjbnRsX2dl
dGxvY2spOwogCQlEQkdfRVJSKCJGYWlsZWQgdG8gZmV0Y2ggZ2x1c3RlciBmZFxuIik7CiAJ
CXJldHVybiBmYWxzZTsKIAl9CkBAIC0xNDA2LDYgKzE2MjEsNyBAQCBzdGF0aWMgYm9vbCB2
ZnNfZ2x1c3Rlcl9nZXRsb2NrKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAog
CXJldCA9IGdsZnNfcG9zaXhfbG9jayhnbGZkLCBGX0dFVExLLCAmZmxvY2spOwogCiAJaWYg
KHJldCA9PSAtMSkgeworCQlFTkRfUFJPRklMRShzeXNjYWxsX2ZjbnRsX2dldGxvY2spOwog
CQlyZXR1cm4gZmFsc2U7CiAJfQogCkBAIC0xNDEzLDYgKzE2MjksNyBAQCBzdGF0aWMgYm9v
bCB2ZnNfZ2x1c3Rlcl9nZXRsb2NrKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxl
LAogCSpwb2Zmc2V0ID0gZmxvY2subF9zdGFydDsKIAkqcGNvdW50ID0gZmxvY2subF9sZW47
CiAJKnBwaWQgPSBmbG9jay5sX3BpZDsKKwlFTkRfUFJPRklMRShzeXNjYWxsX2ZjbnRsX2dl
dGxvY2spOwogCiAJcmV0dXJuIHRydWU7CiB9CkBAIC0xNDIxLDkgKzE2MzgsMTUgQEAgc3Rh
dGljIGludCB2ZnNfZ2x1c3Rlcl9zeW1saW5rKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAq
aGFuZGxlLAogCQkJCWNvbnN0IGNoYXIgKmxpbmtfdGFyZ2V0LAogCQkJCWNvbnN0IHN0cnVj
dCBzbWJfZmlsZW5hbWUgKm5ld19zbWJfZm5hbWUpCiB7Ci0JcmV0dXJuIGdsZnNfc3ltbGlu
ayhoYW5kbGUtPmRhdGEsCisJaW50IHJldDsKKworCVNUQVJUX1BST0ZJTEUoc3lzY2FsbF9z
eW1saW5rKTsKKwlyZXQgPSBnbGZzX3N5bWxpbmsoaGFuZGxlLT5kYXRhLAogCQkJbGlua190
YXJnZXQsCiAJCQluZXdfc21iX2ZuYW1lLT5iYXNlX25hbWUpOworCUVORF9QUk9GSUxFKHN5
c2NhbGxfc3ltbGluayk7CisKKwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHZmc19n
bHVzdGVyX3JlYWRsaW5rKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLApAQCAt
MTQzMSwxNiArMTY1NCwyOCBAQCBzdGF0aWMgaW50IHZmc19nbHVzdGVyX3JlYWRsaW5rKHN0
cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJCWNoYXIgKmJ1ZiwKIAkJCQlz
aXplX3QgYnVmc2l6KQogewotCXJldHVybiBnbGZzX3JlYWRsaW5rKGhhbmRsZS0+ZGF0YSwg
c21iX2ZuYW1lLT5iYXNlX25hbWUsIGJ1ZiwgYnVmc2l6KTsKKwlpbnQgcmV0OworCisJU1RB
UlRfUFJPRklMRShzeXNjYWxsX3JlYWRsaW5rKTsKKwlyZXQgPSBnbGZzX3JlYWRsaW5rKGhh
bmRsZS0+ZGF0YSwgc21iX2ZuYW1lLT5iYXNlX25hbWUsIGJ1ZiwgYnVmc2l6KTsKKwlFTkRf
UFJPRklMRShzeXNjYWxsX3JlYWRsaW5rKTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRp
YyBpbnQgdmZzX2dsdXN0ZXJfbGluayhzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRs
ZSwKIAkJCQljb25zdCBzdHJ1Y3Qgc21iX2ZpbGVuYW1lICpvbGRfc21iX2ZuYW1lLAogCQkJ
CWNvbnN0IHN0cnVjdCBzbWJfZmlsZW5hbWUgKm5ld19zbWJfZm5hbWUpCiB7Ci0JcmV0dXJu
IGdsZnNfbGluayhoYW5kbGUtPmRhdGEsCisJaW50IHJldDsKKworCVNUQVJUX1BST0ZJTEUo
c3lzY2FsbF9saW5rKTsKKwlyZXQgPSBnbGZzX2xpbmsoaGFuZGxlLT5kYXRhLAogCQkJb2xk
X3NtYl9mbmFtZS0+YmFzZV9uYW1lLAogCQkJbmV3X3NtYl9mbmFtZS0+YmFzZV9uYW1lKTsK
KwlFTkRfUFJPRklMRShzeXNjYWxsX2xpbmspOworCisJcmV0dXJuIHJldDsKIH0KIAogc3Rh
dGljIGludCB2ZnNfZ2x1c3Rlcl9ta25vZChzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhh
bmRsZSwKQEAgLTE0NDgsNyArMTY4MywxMyBAQCBzdGF0aWMgaW50IHZmc19nbHVzdGVyX21r
bm9kKHN0cnVjdCB2ZnNfaGFuZGxlX3N0cnVjdCAqaGFuZGxlLAogCQkJCW1vZGVfdCBtb2Rl
LAogCQkJCVNNQl9ERVZfVCBkZXYpCiB7Ci0JcmV0dXJuIGdsZnNfbWtub2QoaGFuZGxlLT5k
YXRhLCBzbWJfZm5hbWUtPmJhc2VfbmFtZSwgbW9kZSwgZGV2KTsKKwlpbnQgcmV0OworCisJ
U1RBUlRfUFJPRklMRShzeXNjYWxsX21rbm9kKTsKKwlyZXQgPSBnbGZzX21rbm9kKGhhbmRs
ZS0+ZGF0YSwgc21iX2ZuYW1lLT5iYXNlX25hbWUsIG1vZGUsIGRldik7CisJRU5EX1BST0ZJ
TEUoc3lzY2FsbF9ta25vZCk7CisKKwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHZm
c19nbHVzdGVyX2NoZmxhZ3Moc3RydWN0IHZmc19oYW5kbGVfc3RydWN0ICpoYW5kbGUsCkBA
IC0xNTA3LDcgKzE3NDgsNyBAQCBzdGF0aWMgc3NpemVfdCB2ZnNfZ2x1c3Rlcl9nZXR4YXR0
cihzdHJ1Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKIAkJCQlzaXplX3Qgc2l6ZSkK
IHsKIAlyZXR1cm4gZ2xmc19nZXR4YXR0cihoYW5kbGUtPmRhdGEsIHNtYl9mbmFtZS0+YmFz
ZV9uYW1lLAotCQkJbmFtZSwgdmFsdWUsIHNpemUpOworCQkJICAgICBuYW1lLCB2YWx1ZSwg
c2l6ZSk7CiB9CiAKIHN0YXRpYyBzc2l6ZV90IHZmc19nbHVzdGVyX2ZnZXR4YXR0cihzdHJ1
Y3QgdmZzX2hhbmRsZV9zdHJ1Y3QgKmhhbmRsZSwKLS0gCjIuMjEuMAoK
--------------3CDBF428F9F78991563D640E--

--oVywm7vWdnarlWkBV5Fm3Sx2suqFXZSBX--

--AdJPenlYwppZzpSn4ZWuoTFD7CEeGA2KJ
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: OpenPGP digital signature
Content-Disposition: attachment; filename="signature.asc"

-----BEGIN PGP SIGNATURE-----

iF0EARECAB0WIQQi7xTdNz0EbkNwwhJI6TdojuEWiAUCXVwINQAKCRBI6TdojuEW
iMLqAJ9SeRYstsbsqlB5L0OVWfr5HhWK1ACeN3W4YOIh3JeeiWqgUr2qKLdCMZA=
=1wcc
-----END PGP SIGNATURE-----

--AdJPenlYwppZzpSn4ZWuoTFD7CEeGA2KJ--

